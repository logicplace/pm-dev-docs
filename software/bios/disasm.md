# BIOS disassembly

<pre><code class="language-s1c88 hljs"><span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-meta" color="#005cc5">DEFSECT</span> <span class="hljs-string" color="#032f62">&quot;.ram&quot;</span>, <span>DATA AT 14E0H</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-meta" color="#005cc5">SECT</span> <span class="hljs-string" color="#032f62">&quot;.ram&quot;</span></span>
<a name="user-content-14E0" href="#user-content-14E0" color="#6e7781" class="line-number">$14E0</a>  <span class="line-content" id="user-content-RemainingPlays">    <a href="#user-content-RemainingPlays" class="hljs-symbol" color="#e36209">RemainingPlays</a>:         <span class="hljs-meta" color="#005cc5">DS</span> <span class="hljs-number" color="#005cc5">1</span></span>
<a name="user-content-14E1" href="#user-content-14E1" color="#6e7781" class="line-number">$14E1</a>  <span class="line-content" id="user-content-KeyPad">    <a href="#user-content-KeyPad" class="hljs-symbol" color="#e36209">KeyPad</a>:                 <span class="hljs-meta" color="#005cc5">DS</span> <span class="hljs-number" color="#005cc5">1</span></span>
<a name="user-content-14E2" href="#user-content-14E2" color="#6e7781" class="line-number">$14E2</a>  <span class="line-content" id="user-content-NumGameStructs">    <a href="#user-content-NumGameStructs" class="hljs-symbol" color="#e36209">NumGameStructs</a>:         <span class="hljs-meta" color="#005cc5">DS</span> <span class="hljs-number" color="#005cc5">1</span></span>
<a name="user-content-14E3" href="#user-content-14E3" color="#6e7781" class="line-number">$14E3</a>  <span class="line-content" id="user-content-LoopN">    <a href="#user-content-LoopN" class="hljs-symbol" color="#e36209">LoopN</a>:                  <span class="hljs-meta" color="#005cc5">DS</span> <span class="hljs-number" color="#005cc5">1</span></span>
<a name="user-content-14E4" href="#user-content-14E4" color="#6e7781" class="line-number">$14E4</a>  <span class="line-content" id="user-content-GameStructs">    <a href="#user-content-GameStructs" class="hljs-symbol" color="#e36209">GameStructs</a>:            <span class="hljs-meta" color="#005cc5">DS</span> <span class="hljs-number" color="#005cc5">64</span>  <span class="hljs-comment" color="#6a737d">; array of 8-byte structures</span></span>
<a name="user-content-1524" href="#user-content-1524" color="#6e7781" class="line-number">$1524</a>  <span class="line-content" id="user-content-NextGameStruct">    <a href="#user-content-NextGameStruct" class="hljs-symbol" color="#e36209">NextGameStruct</a>:         <span class="hljs-meta" color="#005cc5">DS</span> <span class="hljs-number" color="#005cc5">2</span></span>
<a name="user-content-1526" href="#user-content-1526" color="#6e7781" class="line-number">$1526</a>  <span class="line-content" id="user-content-NextTilePos">    <a href="#user-content-NextTilePos" class="hljs-symbol" color="#e36209">NextTilePos</a>:            <span class="hljs-meta" color="#005cc5">DS</span> <span class="hljs-number" color="#005cc5">2</span></span>
<a name="user-content-1528" href="#user-content-1528" color="#6e7781" class="line-number">$1528</a>  <span class="line-content" id="user-content-CurrentRowStart">    <a href="#user-content-CurrentRowStart" class="hljs-symbol" color="#e36209">CurrentRowStart</a>:        <span class="hljs-meta" color="#005cc5">DS</span> <span class="hljs-number" color="#005cc5">1</span></span>
<a name="user-content-1529" href="#user-content-1529" color="#6e7781" class="line-number">$1529</a>  <span class="line-content" id="user-content-FinalNameRowStartMin48">    <a href="#user-content-FinalNameRowStartMin48" class="hljs-symbol" color="#e36209">FinalNameRowStartMin48</a>: <span class="hljs-meta" color="#005cc5">DS</span> <span class="hljs-number" color="#005cc5">1</span></span>
<a name="user-content-152A" href="#user-content-152A" color="#6e7781" class="line-number">$152A</a>  <span class="line-content" id="user-content-FinalNameRowStart">    <a href="#user-content-FinalNameRowStart" class="hljs-symbol" color="#e36209">FinalNameRowStart</a>:      <span class="hljs-meta" color="#005cc5">DS</span> <span class="hljs-number" color="#005cc5">1</span></span>
<a name="user-content-152B" href="#user-content-152B" color="#6e7781" class="line-number">$152B</a>  <span class="line-content" id="user-content-MoveCooldown">    <a href="#user-content-MoveCooldown" class="hljs-symbol" color="#e36209">MoveCooldown</a>:           <span class="hljs-meta" color="#005cc5">DS</span> <span class="hljs-number" color="#005cc5">1</span></span>
<a name="user-content-152C" href="#user-content-152C" color="#6e7781" class="line-number">$152C</a>  <span class="line-content" id="user-content-KeyHistory">    <a href="#user-content-KeyHistory" class="hljs-symbol" color="#e36209">KeyHistory</a>:             <span class="hljs-meta" color="#005cc5">DS</span> <span class="hljs-number" color="#005cc5">1</span></span>
<a name="user-content-152D" href="#user-content-152D" color="#6e7781" class="line-number">$152D</a>  <span class="line-content" id="user-content-TotalAnimFrames">    <a href="#user-content-TotalAnimFrames" class="hljs-symbol" color="#e36209">TotalAnimFrames</a>:        <span class="hljs-meta" color="#005cc5">DS</span> <span class="hljs-number" color="#005cc5">2</span></span>
<a name="user-content-152F" href="#user-content-152F" color="#6e7781" class="line-number">$152F</a>  <span class="line-content" id="user-content-FramesRemaining">    <a href="#user-content-FramesRemaining" class="hljs-symbol" color="#e36209">FramesRemaining</a>:        <span class="hljs-meta" color="#005cc5">DS</span> <span class="hljs-number" color="#005cc5">1</span>   <span class="hljs-comment" color="#6a737d">; &quot;rendered frames&quot; remaining for a frame</span></span>
<a name="user-content-1530" href="#user-content-1530" color="#6e7781" class="line-number">$1530</a>  <span class="line-content" id="user-content-BlankTilemap">    <a href="#user-content-BlankTilemap" class="hljs-symbol" color="#e36209">BlankTilemap</a>:           <span class="hljs-meta" color="#005cc5">DS</span> <span class="hljs-number" color="#005cc5">96</span></span>
<a name="user-content-1590" href="#user-content-1590" color="#6e7781" class="line-number">$1590</a>  <span class="line-content" id="user-content-GameSelectMap">    <a href="#user-content-GameSelectMap" class="hljs-symbol" color="#e36209">GameSelectMap</a>:          <span class="hljs-meta" color="#005cc5">DS</span> <span class="hljs-number" color="#005cc5">96</span></span>
<a name="user-content-15F0" href="#user-content-15F0" color="#6e7781" class="line-number">$15F0</a>  <span class="line-content" id="user-content-GameNamesMap">    <a href="#user-content-GameNamesMap" class="hljs-symbol" color="#e36209">GameNamesMap</a>:           <span class="hljs-meta" color="#005cc5">DS</span> <span class="hljs-number" color="#005cc5">96</span></span>
<a name="user-content-1650" href="#user-content-1650" color="#6e7781" class="line-number">$1650</a>  <span class="line-content" id="user-content-InsertCartMaps">    <a href="#user-content-InsertCartMaps" class="hljs-symbol" color="#e36209">InsertCartMaps</a>:         <span class="hljs-meta" color="#005cc5">DS</span> <span class="hljs-number" color="#005cc5">180</span></span>
<a name="user-content-1704" href="#user-content-1704" color="#6e7781" class="line-number">$1704</a>  <span class="line-content" id="user-content-LowBatteryMaps">    <a href="#user-content-LowBatteryMaps" class="hljs-symbol" color="#e36209">LowBatteryMaps</a>:         <span class="hljs-meta" color="#005cc5">DS</span> <span class="hljs-number" color="#005cc5">300</span></span>
<a name="user-content-1830" href="#user-content-1830" color="#6e7781" class="line-number">$1830</a>  <span class="line-content" id="user-content-TilesetBase">    <a href="#user-content-TilesetBase" class="hljs-symbol" color="#e36209">TilesetBase</a>:            <span class="hljs-meta" color="#005cc5">DS</span> <span class="hljs-number" color="#005cc5">328</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <a href="#user-content-VFlipStart" class="hljs-variable" color="#005cc5">VFlipStart</a>  <span class="hljs-meta" color="#005cc5">EQU</span>  <span class="hljs-number" color="#005cc5">1920h</span></span>
<a name="user-content-1978" href="#user-content-1978" color="#6e7781" class="line-number">$1978</a>  <span class="line-content" id="user-content-VFlippedTiles">    <a href="#user-content-VFlippedTiles" class="hljs-symbol" color="#e36209">VFlippedTiles</a>:          <span class="hljs-meta" color="#005cc5">DS</span> <span class="hljs-number" color="#005cc5">88</span></span>
<a name="user-content-19D0" href="#user-content-19D0" color="#6e7781" class="line-number">$19D0</a>  <span class="line-content" id="user-content-GameNameTiles">    <a href="#user-content-GameNameTiles" class="hljs-symbol" color="#e36209">GameNameTiles</a>:          <span class="hljs-meta" color="#005cc5">DS</span> <span class="hljs-number" color="#005cc5">576</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-meta" color="#005cc5">DEFSECT</span> <span class="hljs-string" color="#032f62">&quot;.bios&quot;</span>, <span>CODE AT 0000H</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-meta" color="#005cc5">SECT</span> <span class="hljs-string" color="#032f62">&quot;.bios&quot;</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_reset_vector">    <span class="hljs-comment" color="#6a737d">; Vector table</span></span>
<a name="user-content-0000" href="#user-content-0000" color="#6e7781" class="line-number">$0000</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_reset_vector" class="hljs-variable" color="#005cc5">_reset_vector</a></span>
<a name="user-content-0002" href="#user-content-0002" color="#6e7781" class="line-number">$0002</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_reset2" class="hljs-variable" color="#005cc5">_reset2</a></span>
<a name="user-content-0004" href="#user-content-0004" color="#6e7781" class="line-number">$0004</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_reset2" class="hljs-variable" color="#005cc5">_reset2</a></span>
<a name="user-content-0006" href="#user-content-0006" color="#6e7781" class="line-number">$0006</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_prc_frame_copy_irq" class="hljs-variable" color="#005cc5">_prc_frame_copy_irq</a></span>
<a name="user-content-0008" href="#user-content-0008" color="#6e7781" class="line-number">$0008</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_prc_render_irq" class="hljs-variable" color="#005cc5">_prc_render_irq</a></span>
<a name="user-content-000A" href="#user-content-000A" color="#6e7781" class="line-number">$000A</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_timer_2h_underflow_irq" class="hljs-variable" color="#005cc5">_timer_2h_underflow_irq</a></span>
<a name="user-content-000C" href="#user-content-000C" color="#6e7781" class="line-number">$000C</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_timer_2l_underflow_irq" class="hljs-variable" color="#005cc5">_timer_2l_underflow_irq</a></span>
<a name="user-content-000E" href="#user-content-000E" color="#6e7781" class="line-number">$000E</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_timer_1h_underflow_irq" class="hljs-variable" color="#005cc5">_timer_1h_underflow_irq</a></span>
<a name="user-content-0010" href="#user-content-0010" color="#6e7781" class="line-number">$0010</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_timer_1l_underflow_irq" class="hljs-variable" color="#005cc5">_timer_1l_underflow_irq</a></span>
<a name="user-content-0012" href="#user-content-0012" color="#6e7781" class="line-number">$0012</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_timer_3h_underflow_irq" class="hljs-variable" color="#005cc5">_timer_3h_underflow_irq</a></span>
<a name="user-content-0014" href="#user-content-0014" color="#6e7781" class="line-number">$0014</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_timer_3_cmp_irq" class="hljs-variable" color="#005cc5">_timer_3_cmp_irq</a></span>
<a name="user-content-0016" href="#user-content-0016" color="#6e7781" class="line-number">$0016</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_timer_32hz_irq" class="hljs-variable" color="#005cc5">_timer_32hz_irq</a></span>
<a name="user-content-0018" href="#user-content-0018" color="#6e7781" class="line-number">$0018</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_timer_8hz_irq" class="hljs-variable" color="#005cc5">_timer_8hz_irq</a></span>
<a name="user-content-001A" href="#user-content-001A" color="#6e7781" class="line-number">$001A</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_timer_2hz_irq" class="hljs-variable" color="#005cc5">_timer_2hz_irq</a></span>
<a name="user-content-001C" href="#user-content-001C" color="#6e7781" class="line-number">$001C</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_timer_1hz_irq" class="hljs-variable" color="#005cc5">_timer_1hz_irq</a></span>
<a name="user-content-001E" href="#user-content-001E" color="#6e7781" class="line-number">$001E</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_ir_rx_irq" class="hljs-variable" color="#005cc5">_ir_rx_irq</a></span>
<a name="user-content-0020" href="#user-content-0020" color="#6e7781" class="line-number">$0020</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_shake_irq" class="hljs-variable" color="#005cc5">_shake_irq</a></span>
<a name="user-content-0022" href="#user-content-0022" color="#6e7781" class="line-number">$0022</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_reset2" class="hljs-variable" color="#005cc5">_reset2</a></span>
<a name="user-content-0024" href="#user-content-0024" color="#6e7781" class="line-number">$0024</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_reset2" class="hljs-variable" color="#005cc5">_reset2</a></span>
<a name="user-content-0026" href="#user-content-0026" color="#6e7781" class="line-number">$0026</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_cart_eject_irq" class="hljs-variable" color="#005cc5">_cart_eject_irq</a></span>
<a name="user-content-0028" href="#user-content-0028" color="#6e7781" class="line-number">$0028</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_cartridge_irq" class="hljs-variable" color="#005cc5">_cartridge_irq</a></span>
<a name="user-content-002A" href="#user-content-002A" color="#6e7781" class="line-number">$002A</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_key_power_irq" class="hljs-variable" color="#005cc5">_key_power_irq</a></span>
<a name="user-content-002C" href="#user-content-002C" color="#6e7781" class="line-number">$002C</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_key_right_irq" class="hljs-variable" color="#005cc5">_key_right_irq</a></span>
<a name="user-content-002E" href="#user-content-002E" color="#6e7781" class="line-number">$002E</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_key_left_irq" class="hljs-variable" color="#005cc5">_key_left_irq</a></span>
<a name="user-content-0030" href="#user-content-0030" color="#6e7781" class="line-number">$0030</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_key_down_irq" class="hljs-variable" color="#005cc5">_key_down_irq</a></span>
<a name="user-content-0032" href="#user-content-0032" color="#6e7781" class="line-number">$0032</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_key_up_irq" class="hljs-variable" color="#005cc5">_key_up_irq</a></span>
<a name="user-content-0034" href="#user-content-0034" color="#6e7781" class="line-number">$0034</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_key_c_irq" class="hljs-variable" color="#005cc5">_key_c_irq</a></span>
<a name="user-content-0036" href="#user-content-0036" color="#6e7781" class="line-number">$0036</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_key_b_irq" class="hljs-variable" color="#005cc5">_key_b_irq</a></span>
<a name="user-content-0038" href="#user-content-0038" color="#6e7781" class="line-number">$0038</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_key_a_irq" class="hljs-variable" color="#005cc5">_key_a_irq</a></span>
<a name="user-content-003A" href="#user-content-003A" color="#6e7781" class="line-number">$003A</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_unknown_irq0" class="hljs-variable" color="#005cc5">_unknown_irq0</a></span>
<a name="user-content-003C" href="#user-content-003C" color="#6e7781" class="line-number">$003C</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_unknown_irq1" class="hljs-variable" color="#005cc5">_unknown_irq1</a></span>
<a name="user-content-003E" href="#user-content-003E" color="#6e7781" class="line-number">$003E</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_unknown_irq2" class="hljs-variable" color="#005cc5">_unknown_irq2</a></span>
<a name="user-content-0040" href="#user-content-0040" color="#6e7781" class="line-number">$0040</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <span class="hljs-number" color="#005cc5">0FFF1h</span></span>
<a name="user-content-0042" href="#user-content-0042" color="#6e7781" class="line-number">$0042</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_suspend_system" class="hljs-variable" color="#005cc5">_suspend_system</a></span>
<a name="user-content-0044" href="#user-content-0044" color="#6e7781" class="line-number">$0044</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_sleep" class="hljs-variable" color="#005cc5">_sleep</a></span>
<a name="user-content-0046" href="#user-content-0046" color="#6e7781" class="line-number">$0046</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_sleep_with_display" class="hljs-variable" color="#005cc5">_sleep_with_display</a></span>
<a name="user-content-0048" href="#user-content-0048" color="#6e7781" class="line-number">$0048</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_shutdown" class="hljs-variable" color="#005cc5">_shutdown</a></span>
<a name="user-content-004A" href="#user-content-004A" color="#6e7781" class="line-number">$004A</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_sleep2" class="hljs-variable" color="#005cc5">_sleep2</a></span>
<a name="user-content-004C" href="#user-content-004C" color="#6e7781" class="line-number">$004C</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_default_contrast" class="hljs-variable" color="#005cc5">_default_contrast</a></span>
<a name="user-content-004E" href="#user-content-004E" color="#6e7781" class="line-number">$004E</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_change_contrast" class="hljs-variable" color="#005cc5">_change_contrast</a></span>
<a name="user-content-0050" href="#user-content-0050" color="#6e7781" class="line-number">$0050</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_apply_default_contrast" class="hljs-variable" color="#005cc5">_apply_default_contrast</a></span>
<a name="user-content-0052" href="#user-content-0052" color="#6e7781" class="line-number">$0052</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_get_default_contrast" class="hljs-variable" color="#005cc5">_get_default_contrast</a></span>
<a name="user-content-0054" href="#user-content-0054" color="#6e7781" class="line-number">$0054</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_set_temp_contrast" class="hljs-variable" color="#005cc5">_set_temp_contrast</a></span>
<a name="user-content-0056" href="#user-content-0056" color="#6e7781" class="line-number">$0056</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_lcd_on" class="hljs-variable" color="#005cc5">_lcd_on</a></span>
<a name="user-content-0058" href="#user-content-0058" color="#6e7781" class="line-number">$0058</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_init_lcd" class="hljs-variable" color="#005cc5">_init_lcd</a></span>
<a name="user-content-005A" href="#user-content-005A" color="#6e7781" class="line-number">$005A</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_lcd_off" class="hljs-variable" color="#005cc5">_lcd_off</a></span>
<a name="user-content-005C" href="#user-content-005C" color="#6e7781" class="line-number">$005C</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_ena_ram_vec" class="hljs-variable" color="#005cc5">_ena_ram_vec</a></span>
<a name="user-content-005E" href="#user-content-005E" color="#6e7781" class="line-number">$005E</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_dis_ram_vec" class="hljs-variable" color="#005cc5">_dis_ram_vec</a></span>
<a name="user-content-0060" href="#user-content-0060" color="#6e7781" class="line-number">$0060</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_disable_cart_eject_irq_if" class="hljs-variable" color="#005cc5">_disable_cart_eject_irq_if</a></span>
<a name="user-content-0062" href="#user-content-0062" color="#6e7781" class="line-number">$0062</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_enable_cart_eject_irq_if" class="hljs-variable" color="#005cc5">_enable_cart_eject_irq_if</a></span>
<a name="user-content-0064" href="#user-content-0064" color="#6e7781" class="line-number">$0064</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_unknown_eject1" class="hljs-variable" color="#005cc5">_unknown_eject1</a></span>
<a name="user-content-0066" href="#user-content-0066" color="#6e7781" class="line-number">$0066</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_unknown_eject2" class="hljs-variable" color="#005cc5">_unknown_eject2</a></span>
<a name="user-content-0068" href="#user-content-0068" color="#6e7781" class="line-number">$0068</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_dev_card0" class="hljs-variable" color="#005cc5">_dev_card0</a></span>
<a name="user-content-006A" href="#user-content-006A" color="#6e7781" class="line-number">$006A</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_dev_card1" class="hljs-variable" color="#005cc5">_dev_card1</a></span>
<a name="user-content-006C" href="#user-content-006C" color="#6e7781" class="line-number">$006C</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_enable_cart_eject_irq" class="hljs-variable" color="#005cc5">_enable_cart_eject_irq</a></span>
<a name="user-content-006E" href="#user-content-006E" color="#6e7781" class="line-number">$006E</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_disable_cart_eject_irq" class="hljs-variable" color="#005cc5">_disable_cart_eject_irq</a></span>
<a name="user-content-0070" href="#user-content-0070" color="#6e7781" class="line-number">$0070</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_unknown_eject4" class="hljs-variable" color="#005cc5">_unknown_eject4</a></span>
<a name="user-content-0072" href="#user-content-0072" color="#6e7781" class="line-number">$0072</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_enter_high_speed_operation" class="hljs-variable" color="#005cc5">_enter_high_speed_operation</a></span>
<a name="user-content-0074" href="#user-content-0074" color="#6e7781" class="line-number">$0074</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_enter_low_speed_operation" class="hljs-variable" color="#005cc5">_enter_low_speed_operation</a></span>
<a name="user-content-0076" href="#user-content-0076" color="#6e7781" class="line-number">$0076</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_cart_slot_off" class="hljs-variable" color="#005cc5">_cart_slot_off</a></span>
<a name="user-content-0078" href="#user-content-0078" color="#6e7781" class="line-number">$0078</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_cart_slot_on" class="hljs-variable" color="#005cc5">_cart_slot_on</a></span>
<a name="user-content-007A" href="#user-content-007A" color="#6e7781" class="line-number">$007A</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_cart_detect" class="hljs-variable" color="#005cc5">_cart_detect</a></span>
<a name="user-content-007C" href="#user-content-007C" color="#6e7781" class="line-number">$007C</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_read_structure" class="hljs-variable" color="#005cc5">_read_structure</a></span>
<a name="user-content-007E" href="#user-content-007E" color="#6e7781" class="line-number">$007E</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_set_prc_rate" class="hljs-variable" color="#005cc5">_set_prc_rate</a></span>
<a name="user-content-0080" href="#user-content-0080" color="#6e7781" class="line-number">$0080</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_get_prc_rate" class="hljs-variable" color="#005cc5">_get_prc_rate</a></span>
<a name="user-content-0082" href="#user-content-0082" color="#6e7781" class="line-number">$0082</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_game_id_valid" class="hljs-variable" color="#005cc5">_game_id_valid</a></span>
<a name="user-content-0084" href="#user-content-0084" color="#6e7781" class="line-number">$0084</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_flash_read_ids" class="hljs-variable" color="#005cc5">_flash_read_ids</a></span>
<a name="user-content-0086" href="#user-content-0086" color="#6e7781" class="line-number">$0086</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_flash_reset" class="hljs-variable" color="#005cc5">_flash_reset</a></span>
<a name="user-content-0088" href="#user-content-0088" color="#6e7781" class="line-number">$0088</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_flash_program_byte" class="hljs-variable" color="#005cc5">_flash_program_byte</a></span>
<a name="user-content-008A" href="#user-content-008A" color="#6e7781" class="line-number">$008A</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_flash_erase_sector" class="hljs-variable" color="#005cc5">_flash_erase_sector</a></span>
<a name="user-content-008C" href="#user-content-008C" color="#6e7781" class="line-number">$008C</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_flash_enter_bank_select_mode" class="hljs-variable" color="#005cc5">_flash_enter_bank_select_mode</a></span>
<a name="user-content-008E" href="#user-content-008E" color="#6e7781" class="line-number">$008E</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_flash_select_bank" class="hljs-variable" color="#005cc5">_flash_select_bank</a></span>
<a name="user-content-0090" href="#user-content-0090" color="#6e7781" class="line-number">$0090</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_flash_allow_remapping_page_0" class="hljs-variable" color="#005cc5">_flash_allow_remapping_page_0</a></span>
<a name="user-content-0092" href="#user-content-0092" color="#6e7781" class="line-number">$0092</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_flash_remap_ids" class="hljs-variable" color="#005cc5">_flash_remap_ids</a></span>
<a name="user-content-0094" href="#user-content-0094" color="#6e7781" class="line-number">$0094</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_flash_prepare_game" class="hljs-variable" color="#005cc5">_flash_prepare_game</a></span>
<a name="user-content-0096" href="#user-content-0096" color="#6e7781" class="line-number">$0096</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <span class="hljs-number" color="#005cc5">0000h</span></span>
<a name="user-content-0098" href="#user-content-0098" color="#6e7781" class="line-number">$0098</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DW</span> <a href="#user-content-_ir_pulse" class="hljs-variable" color="#005cc5">_ir_pulse</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <a href="#user-content-hdr_nintendo" class="hljs-variable" color="#005cc5">hdr_nintendo</a> <span class="hljs-meta" color="#005cc5">EQU</span> <span class="hljs-number" color="#005cc5">21A4h</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_reset_vector" class="hljs-symbol" color="#e36209">_reset_vector</a>:</span>
<a name="user-content-009A" href="#user-content-009A" color="#6e7781" class="line-number">$009A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span>                         <span class="hljs-comment" color="#6a737d">; address hardware registers</span></span>
<a name="user-content-009D" href="#user-content-009D" color="#6e7781" class="line-number">$009D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-number" color="#005cc5">#20h</span>                         <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-009F" href="#user-content-009F" color="#6e7781" class="line-number">$009F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:08h]</span>, <span class="hljs-number" color="#005cc5">#02h</span>                   <span class="hljs-comment" color="#6a737d">; reset seconds timer</span></span>
<a name="user-content-00A2" href="#user-content-00A2" color="#6e7781" class="line-number">$00A2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:08h]</span>, <span class="hljs-number" color="#005cc5">#01h</span>                   <span class="hljs-comment" color="#6a737d">; start seconds timer</span></span>
<a name="user-content-00A5" href="#user-content-00A5" color="#6e7781" class="line-number">$00A5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:00h]</span>, <span class="hljs-number" color="#005cc5">#7Ch</span>                   <span class="hljs-comment" color="#6a737d">; set default contrast to 31 (~50%)</span></span>
<a name="user-content-00A8" href="#user-content-00A8" color="#6e7781" class="line-number">$00A8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#00h</span>                   <span class="hljs-comment" color="#6a737d">; initialize to 0</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_reset2"><a href="#user-content-_reset2" class="hljs-symbol" color="#e36209">_reset2</a>:</span>
<a name="user-content-00AB" href="#user-content-00AB" color="#6e7781" class="line-number">$00AB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-00AD" href="#user-content-00AD" color="#6e7781" class="line-number">$00AD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SP</span>, <span class="hljs-number" color="#005cc5">#2000h</span>                       <span class="hljs-comment" color="#6a737d">; initial stack location (end of RAM)</span></span>
<a name="user-content-00B1" href="#user-content-00B1" color="#6e7781" class="line-number">$00B1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-initregs" class="hljs-variable" color="#005cc5">initregs</a>                       <span class="hljs-comment" color="#6a737d">; initialize registers for BIOS&#x27;s sake</span></span>
<a name="user-content-00B4" href="#user-content-00B4" color="#6e7781" class="line-number">$00B4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:80h]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                      <span class="hljs-comment" color="#6a737d">; disable LCD controller (A=0)</span></span>
<a name="user-content-00B6" href="#user-content-00B6" color="#6e7781" class="line-number">$00B6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-enter_high_speed_operation" class="hljs-variable" color="#005cc5">enter_high_speed_operation</a>     <span class="hljs-comment" color="#6a737d">; clock CPU with OSC3</span></span>
<a name="user-content-00B9" href="#user-content-00B9" color="#6e7781" class="line-number">$00B9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">NB</span>, <span class="hljs-number" color="#005cc5">#01h</span>                         <span class="hljs-comment" color="#6a737d">; set default NB</span></span>
<a name="user-content-00BC" href="#user-content-00BC" color="#6e7781" class="line-number">$00BC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <a href="#user-content-copy_nb_to_cb" class="hljs-variable" color="#005cc5">copy_nb_to_cb</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-copy_nb_to_cb"><a href="#user-content-copy_nb_to_cb" class="hljs-symbol" color="#e36209">copy_nb_to_cb</a>:</span>
<a name="user-content-00BE" href="#user-content-00BE" color="#6e7781" class="line-number">$00BE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[BR:52h]</span>                      <span class="hljs-comment" color="#6a737d">; store initial keypad state</span></span>
<a name="user-content-00C0" href="#user-content-00C0" color="#6e7781" class="line-number">$00C0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[KeyPad]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                      <span class="hljs-comment" color="#6a737d">; to $14E1</span></span>
<a name="user-content-00C4" href="#user-content-00C4" color="#6e7781" class="line-number">$00C4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:00h]</span>, <span class="hljs-number" color="#005cc5">#03h</span>                   <span class="hljs-comment" color="#6a737d">; send Chip Enable (CE) signals</span></span>
<a name="user-content-00C7" href="#user-content-00C7" color="#6e7781" class="line-number">$00C7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#30h</span>                   <span class="hljs-comment" color="#6a737d">; ??</span></span>
<a name="user-content-00CA" href="#user-content-00CA" color="#6e7781" class="line-number">$00CA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                  <span class="hljs-comment" color="#6a737d">; ??</span></span>
<a name="user-content-00CD" href="#user-content-00CD" color="#6e7781" class="line-number">$00CD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-init_io" class="hljs-variable" color="#005cc5">init_io</a></span>
<a name="user-content-00D0" href="#user-content-00D0" color="#6e7781" class="line-number">$00D0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:80h]</span>, <span class="hljs-number" color="#005cc5">#02h</span>                   <span class="hljs-comment" color="#6a737d">; enable tilemap (for BIOS screens)</span></span>
<a name="user-content-00D3" href="#user-content-00D3" color="#6e7781" class="line-number">$00D3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:81h]</span>, <span class="hljs-number" color="#005cc5">#09h</span>                   <span class="hljs-comment" color="#6a737d">; set frame divider to 2 and ?</span></span>
<a name="user-content-00D6" href="#user-content-00D6" color="#6e7781" class="line-number">$00D6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-number" color="#005cc5">#TilesetBase</span>                 <span class="hljs-comment" color="#6a737d">; tileset base for the screens</span></span>
<a name="user-content-00D9" href="#user-content-00D9" color="#6e7781" class="line-number">$00D9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[02082h]</span>, <span class="hljs-variable language_" color="#d73a49">IX</span>                     <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-00DC" href="#user-content-00DC" color="#6e7781" class="line-number">$00DC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:84h]</span>, <span class="hljs-number" color="#005cc5">#00h</span>                   <span class="hljs-comment" color="#6a737d">; ... (why not B? macro?)</span></span>
<a name="user-content-00DF" href="#user-content-00DF" color="#6e7781" class="line-number">$00DF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:85h]</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                      <span class="hljs-comment" color="#6a737d">; init map scroll to 0</span></span>
<a name="user-content-00E1" href="#user-content-00E1" color="#6e7781" class="line-number">$00E1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:86h]</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                      <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-00E3" href="#user-content-00E3" color="#6e7781" class="line-number">$00E3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:87h]</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                      <span class="hljs-comment" color="#6a737d">; init sprite set base to 0</span></span>
<a name="user-content-00E5" href="#user-content-00E5" color="#6e7781" class="line-number">$00E5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:88h]</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                      <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-00E7" href="#user-content-00E7" color="#6e7781" class="line-number">$00E7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:89h]</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                      <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-00E9" href="#user-content-00E9" color="#6e7781" class="line-number">$00E9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-power_cart" class="hljs-variable" color="#005cc5">power_cart</a>                     <span class="hljs-comment" color="#6a737d">; power the cartridge</span></span>
<a name="user-content-00EC" href="#user-content-00EC" color="#6e7781" class="line-number">$00EC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-wait_8000_cycles" class="hljs-variable" color="#005cc5">wait_8000_cycles</a></span>
<a name="user-content-00EF" href="#user-content-00EF" color="#6e7781" class="line-number">$00EF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:28h]</span>, <span class="hljs-number" color="#005cc5">#02h</span>                   <span class="hljs-comment" color="#6a737d">; enable cart eject IRQ</span></span>
<a name="user-content-00F2" href="#user-content-00F2" color="#6e7781" class="line-number">$00F2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#80h</span>                         <span class="hljs-comment" color="#6a737d">; interrupt flags to IRQ3+</span></span>
<a name="user-content-00F4" href="#user-content-00F4" color="#6e7781" class="line-number">$00F4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:0FEh]</span>, <span class="hljs-number" color="#005cc5">#0E3h</span>                 <span class="hljs-comment" color="#6a737d">; send NOP command to LCD driver</span></span>
<a name="user-content-00F7" href="#user-content-00F7" color="#6e7781" class="line-number">$00F7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">H</span>, <span class="hljs-number" color="#005cc5">#0B0h</span>                         <span class="hljs-comment" color="#6a737d">; set page 0 command</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-loop_from_B0_to_B8"><a href="#user-content-loop_from_B0_to_B8" class="hljs-symbol" color="#e36209">loop_from_B0_to_B8</a>:                     <span class="hljs-comment" color="#6a737d">; loop through all display pages</span></span>
<a name="user-content-00F9" href="#user-content-00F9" color="#6e7781" class="line-number">$00F9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span class="hljs-number" color="#005cc5">#60h</span>                          <span class="hljs-comment" color="#6a737d">; 96 columns (screen width)</span></span>
<a name="user-content-00FB" href="#user-content-00FB" color="#6e7781" class="line-number">$00FB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:0FEh]</span>, <span class="hljs-variable language_" color="#d73a49">H</span>                     <span class="hljs-comment" color="#6a737d">; send set page command</span></span>
<a name="user-content-00FD" href="#user-content-00FD" color="#6e7781" class="line-number">$00FD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:0FEh]</span>, <span class="hljs-number" color="#005cc5">#10h</span>                  <span class="hljs-comment" color="#6a737d">; send set column 0 command</span></span>
<a name="user-content-0100" href="#user-content-0100" color="#6e7781" class="line-number">$0100</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:0FEh]</span>, <span class="hljs-number" color="#005cc5">#00h</span>                  <span class="hljs-comment" color="#6a737d">; ...</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-clear_96_vertical_lines"><a href="#user-content-clear_96_vertical_lines" class="hljs-symbol" color="#e36209">clear_96_vertical_lines</a>:</span>
<a name="user-content-0103" href="#user-content-0103" color="#6e7781" class="line-number">$0103</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:0FFh]</span>, <span class="hljs-number" color="#005cc5">#00h</span>                  <span class="hljs-comment" color="#6a737d">; clear column (and increment cursor)</span></span>
<a name="user-content-0106" href="#user-content-0106" color="#6e7781" class="line-number">$0106</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DJR</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-clear_96_vertical_lines" class="hljs-variable" color="#005cc5">clear_96_vertical_lines</a></span>
<a name="user-content-0108" href="#user-content-0108" color="#6e7781" class="line-number">$0108</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">H</span>                               <span class="hljs-comment" color="#6a737d">; next page</span></span>
<a name="user-content-0109" href="#user-content-0109" color="#6e7781" class="line-number">$0109</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">H</span>, <span class="hljs-number" color="#005cc5">#0B8h</span>                         <span class="hljs-comment" color="#6a737d">; stop at last display page</span></span>
<a name="user-content-010C" href="#user-content-010C" color="#6e7781" class="line-number">$010C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-loop_from_B0_to_B8" class="hljs-variable" color="#005cc5">loop_from_B0_to_B8</a></span>
<a name="user-content-010E" href="#user-content-010E" color="#6e7781" class="line-number">$010E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-apply_default_contrast1" class="hljs-variable" color="#005cc5">apply_default_contrast1</a></span>
<a name="user-content-0111" href="#user-content-0111" color="#6e7781" class="line-number">$0111</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">XOR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                            <span class="hljs-comment" color="#6a737d">; delay between setup and display on</span></span>
<a name="user-content-0112" href="#user-content-0112" color="#6e7781" class="line-number">$0112</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-init_display" class="hljs-variable" color="#005cc5">init_display</a></span>
<a name="user-content-0115" href="#user-content-0115" color="#6e7781" class="line-number">$0115</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-decode_picture" class="hljs-variable" color="#005cc5">decode_picture</a>                 <span class="hljs-comment" color="#6a737d">; load tiles/maps into RAM</span></span>
<a name="user-content-0118" href="#user-content-0118" color="#6e7781" class="line-number">$0118</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:53h]</span>, <span class="hljs-number" color="#005cc5">#02h</span>                  <span class="hljs-comment" color="#6a737d">; check if cart is inserted</span></span>
<a name="user-content-011B" href="#user-content-011B" color="#6e7781" class="line-number">$011B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-check_voltage" class="hljs-variable" color="#005cc5">check_voltage</a>                <span class="hljs-comment" color="#6a737d">; 0=cart is inserted</span></span>
<a name="user-content-011D" href="#user-content-011D" color="#6e7781" class="line-number">$011D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <a href="#user-content-insert_cart_screen" class="hljs-variable" color="#005cc5">insert_cart_screen</a>              <span class="hljs-comment" color="#6a737d">; if no cart is inserted...</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-check_voltage"><a href="#user-content-check_voltage" class="hljs-symbol" color="#e36209">check_voltage</a>:</span>
<a name="user-content-0120" href="#user-content-0120" color="#6e7781" class="line-number">$0120</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:10h]</span>, <span class="hljs-number" color="#005cc5">#10h</span>                   <span class="hljs-comment" color="#6a737d">; write 1 to SVDON</span></span>
<a name="user-content-0123" href="#user-content-0123" color="#6e7781" class="line-number">$0123</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span class="hljs-number" color="#005cc5">#32h</span>                          <span class="hljs-comment" color="#6a737d">; wait 202 cycles</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-cv__wait_200"><a href="#user-content-cv__wait_200" class="hljs-symbol" color="#e36209">cv__wait_200</a>:</span>
<a name="user-content-0125" href="#user-content-0125" color="#6e7781" class="line-number">$0125</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DJR</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-cv__wait_200" class="hljs-variable" color="#005cc5">cv__wait_200</a></span>
<a name="user-content-0127" href="#user-content-0127" color="#6e7781" class="line-number">$0127</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:10h]</span>, <span class="hljs-number" color="#005cc5">#~10h</span>                 <span class="hljs-comment" color="#6a737d">; write 0 to SVDON</span></span>
<a name="user-content-012A" href="#user-content-012A" color="#6e7781" class="line-number">$012A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:10h]</span>, <span class="hljs-number" color="#005cc5">#20h</span>                  <span class="hljs-comment" color="#6a737d">; check battery level</span></span>
<a name="user-content-012D" href="#user-content-012D" color="#6e7781" class="line-number">$012D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-cv__sufficient" class="hljs-variable" color="#005cc5">cv__sufficient</a>               <span class="hljs-comment" color="#6a737d">; 0 = sufficient voltage supply</span></span>
<a name="user-content-012F" href="#user-content-012F" color="#6e7781" class="line-number">$012F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-low_battery_screen" class="hljs-variable" color="#005cc5">low_battery_screen</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-cv__sufficient"><a href="#user-content-cv__sufficient" class="hljs-symbol" color="#e36209">cv__sufficient</a>:</span>
<a name="user-content-0132" href="#user-content-0132" color="#6e7781" class="line-number">$0132</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <a href="#user-content-check_cart_type" class="hljs-variable" color="#005cc5">check_cart_type</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-nintendo_check"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-nintendo_check" class="hljs-symbol" color="#e36209">nintendo_check</a>:</span>
<a name="user-content-0135" href="#user-content-0135" color="#6e7781" class="line-number">$0135</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SP</span>, <span class="hljs-number" color="#005cc5">#2000h</span></span>
<a name="user-content-0139" href="#user-content-0139" color="#6e7781" class="line-number">$0139</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span class="hljs-number" color="#005cc5">#08h</span>                          <span class="hljs-comment" color="#6a737d">; 8 letters in &#x27;NINTENDO&#x27;</span></span>
<a name="user-content-013B" href="#user-content-013B" color="#6e7781" class="line-number">$013B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-number" color="#005cc5">#hdr_nintendo</span>                <span class="hljs-comment" color="#6a737d">; offset: start of &#x27;NINTENDO&#x27; signature in game header</span></span>
<a name="user-content-013E" href="#user-content-013E" color="#6e7781" class="line-number">$013E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IY</span>, <span class="hljs-number" color="#005cc5">#nintendo_string</span>             <span class="hljs-comment" color="#6a737d">; offset 0E1Ah: start of &#x27;NINTENDO&#x27; field in BIOS, used for checking header</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-nc__loop"><a href="#user-content-nc__loop" class="hljs-symbol" color="#e36209">nc__loop</a>:</span>
<a name="user-content-0141" href="#user-content-0141" color="#6e7781" class="line-number">$0141</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[IX]</span>                          <span class="hljs-comment" color="#6a737d">; compare byte at IX with byte at IY</span></span>
<a name="user-content-0142" href="#user-content-0142" color="#6e7781" class="line-number">$0142</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[IY]</span>                          <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0143" href="#user-content-0143" color="#6e7781" class="line-number">$0143</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-insert_cart_screen" class="hljs-variable" color="#005cc5">insert_cart_screen</a>          <span class="hljs-comment" color="#6a737d">; if they&#x27;re not the same, jump down to insert_cart_screen</span></span>
<a name="user-content-0146" href="#user-content-0146" color="#6e7781" class="line-number">$0146</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">IX</span>                              <span class="hljs-comment" color="#6a737d">; else, increment IX and IY to point to the next part of the &#x27;NINTENDO&#x27; string</span></span>
<a name="user-content-0147" href="#user-content-0147" color="#6e7781" class="line-number">$0147</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">IY</span>                              <span class="hljs-comment" color="#6a737d">; ..</span></span>
<a name="user-content-0148" href="#user-content-0148" color="#6e7781" class="line-number">$0148</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DJR</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-nc__loop" class="hljs-variable" color="#005cc5">nc__loop</a>                    <span class="hljs-comment" color="#6a737d">; and JDBNZ back to the start of the loop</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-prepare_boot"><a href="#user-content-prepare_boot" class="hljs-symbol" color="#e36209">prepare_boot</a>:</span>
<a name="user-content-014A" href="#user-content-014A" color="#6e7781" class="line-number">$014A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">XOR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                            <span class="hljs-comment" color="#6a737d">; set A to 0</span></span>
<a name="user-content-014B" href="#user-content-014B" color="#6e7781" class="line-number">$014B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:80h]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                      <span class="hljs-comment" color="#6a737d">; set PRC_MODE to 0</span></span>
<a name="user-content-014D" href="#user-content-014D" color="#6e7781" class="line-number">$014D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:81h]</span>, <span class="hljs-number" color="#005cc5">#07h</span>                   <span class="hljs-comment" color="#6a737d">; set PRC_RATE to 7</span></span>
<a name="user-content-0150" href="#user-content-0150" color="#6e7781" class="line-number">$0150</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:82h]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                      <span class="hljs-comment" color="#6a737d">; set PRC_MAP LO and MID to 0</span></span>
<a name="user-content-0152" href="#user-content-0152" color="#6e7781" class="line-number">$0152</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:83h]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                      <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0154" href="#user-content-0154" color="#6e7781" class="line-number">$0154</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#~10h</span>                 <span class="hljs-comment" color="#6a737d">; ??</span></span>
<a name="user-content-0157" href="#user-content-0157" color="#6e7781" class="line-number">$0157</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <a href="#user-content-initregs" class="hljs-variable" color="#005cc5">initregs</a>                       <span class="hljs-comment" color="#6a737d">; reset registers</span></span>
<a name="user-content-0159" href="#user-content-0159" color="#6e7781" class="line-number">$0159</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">H</span>, <span>[KeyPad]</span>                      <span class="hljs-comment" color="#6a737d">; load KEY_PAD into H (loaded into 0x14E1 by _reset_vector)</span></span>
<a name="user-content-015D" href="#user-content-015D" color="#6e7781" class="line-number">$015D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">L</span>, <span>[RemainingPlays]</span>              <span class="hljs-comment" color="#6a737d">; load cart type into L</span></span>
<a name="user-content-0161" href="#user-content-0161" color="#6e7781" class="line-number">$0161</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-number" color="#005cc5">#1000h</span>                       <span class="hljs-comment" color="#6a737d">; clear RAM</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-pb__loop"><a href="#user-content-pb__loop" class="hljs-symbol" color="#e36209">pb__loop</a>:                               <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0164" href="#user-content-0164" color="#6e7781" class="line-number">$0164</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[IX]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                          <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0165" href="#user-content-0165" color="#6e7781" class="line-number">$0165</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">IX</span>                              <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0166" href="#user-content-0166" color="#6e7781" class="line-number">$0166</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-number" color="#005cc5">#2000h</span>                       <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0169" href="#user-content-0169" color="#6e7781" class="line-number">$0169</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-pb__loop" class="hljs-variable" color="#005cc5">pb__loop</a>                    <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-016B" href="#user-content-016B" color="#6e7781" class="line-number">$016B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-variable language_" color="#d73a49">BA</span>                           <span class="hljs-comment" color="#6a737d">; clear registers</span></span>
<a name="user-content-016D" href="#user-content-016D" color="#6e7781" class="line-number">$016D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                            <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-016F" href="#user-content-016F" color="#6e7781" class="line-number">$016F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BA</span>, <span class="hljs-variable language_" color="#d73a49">HL</span>                           <span class="hljs-comment" color="#6a737d">; ...except forward info in BA</span></span>
<a name="user-content-0171" href="#user-content-0171" color="#6e7781" class="line-number">$0171</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">HL</span>, <span class="hljs-variable language_" color="#d73a49">IX</span>                           <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0173" href="#user-content-0173" color="#6e7781" class="line-number">$0173</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                       <span class="hljs-comment" color="#6a737d">; keep only interrupt flags</span></span>
<a name="user-content-0175" href="#user-content-0175" color="#6e7781" class="line-number">$0175</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-number" color="#005cc5">2102h</span>                           <span class="hljs-comment" color="#6a737d">; jump to game entrypoint</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-initregs"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Returns:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   BR: $20</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   BA, EP, XP, YP, HL, IX, IY: 0</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-initregs" class="hljs-symbol" color="#e36209">initregs</a>:</span>
<a name="user-content-0178" href="#user-content-0178" color="#6e7781" class="line-number">$0178</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-number" color="#005cc5">#20h</span>                         <span class="hljs-comment" color="#6a737d">; set BR to 20 for hardware register area</span></span>
<a name="user-content-017A" href="#user-content-017A" color="#6e7781" class="line-number">$017A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">XOR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                            <span class="hljs-comment" color="#6a737d">; set all other general purpose registers to 0</span></span>
<a name="user-content-017B" href="#user-content-017B" color="#6e7781" class="line-number">$017B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                             <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-017C" href="#user-content-017C" color="#6e7781" class="line-number">$017C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                            <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-017E" href="#user-content-017E" color="#6e7781" class="line-number">$017E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">XP</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                            <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0180" href="#user-content-0180" color="#6e7781" class="line-number">$0180</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">YP</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                            <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0182" href="#user-content-0182" color="#6e7781" class="line-number">$0182</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">HL</span>, <span class="hljs-variable language_" color="#d73a49">BA</span>                           <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0184" href="#user-content-0184" color="#6e7781" class="line-number">$0184</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-variable language_" color="#d73a49">BA</span>                           <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0186" href="#user-content-0186" color="#6e7781" class="line-number">$0186</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IY</span>, <span class="hljs-variable language_" color="#d73a49">BA</span>                           <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0188" href="#user-content-0188" color="#6e7781" class="line-number">$0188</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-init_io"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Returns:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   B: 0</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Clobbers: A</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-init_io" class="hljs-symbol" color="#e36209">init_io</a>:</span>
<a name="user-content-0189" href="#user-content-0189" color="#6e7781" class="line-number">$0189</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-018B" href="#user-content-018B" color="#6e7781" class="line-number">$018B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:10h]</span>, <span class="hljs-number" color="#005cc5">#08h</span>                   <span class="hljs-comment" color="#6a737d">; set SYS_BATT to 8</span></span>
<a name="user-content-018E" href="#user-content-018E" color="#6e7781" class="line-number">$018E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:19h]</span>, <span class="hljs-number" color="#005cc5">#~30h</span>                 <span class="hljs-comment" color="#6a737d">; disable OSC1/OSC3 for timer use</span></span>
<a name="user-content-0191" href="#user-content-0191" color="#6e7781" class="line-number">$0191</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:20h]</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                      <span class="hljs-comment" color="#6a737d">; set IRQ priorities to none (don&#x27;t fire)</span></span>
<a name="user-content-0193" href="#user-content-0193" color="#6e7781" class="line-number">$0193</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:21h]</span>, <span class="hljs-number" color="#005cc5">#30h</span>                   <span class="hljs-comment" color="#6a737d">; ...except set cartridge IRQs to 3</span></span>
<a name="user-content-0196" href="#user-content-0196" color="#6e7781" class="line-number">$0196</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:22h]</span>, <span class="hljs-number" color="#005cc5">#02h</span>                   <span class="hljs-comment" color="#6a737d">; ...except set IR/shock to 2</span></span>
<a name="user-content-0199" href="#user-content-0199" color="#6e7781" class="line-number">$0199</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:23h]</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                      <span class="hljs-comment" color="#6a737d">; disable IRQs</span></span>
<a name="user-content-019B" href="#user-content-019B" color="#6e7781" class="line-number">$019B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:24h]</span>, <span class="hljs-number" color="#005cc5">#02h</span>                   <span class="hljs-comment" color="#6a737d">; ...except cart eject IRQ</span></span>
<a name="user-content-019E" href="#user-content-019E" color="#6e7781" class="line-number">$019E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:25h]</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                      <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-01A0" href="#user-content-01A0" color="#6e7781" class="line-number">$01A0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:26h]</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                      <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-01A2" href="#user-content-01A2" color="#6e7781" class="line-number">$01A2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:40h]</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                      <span class="hljs-comment" color="#6a737d">; disable clock timer</span></span>
<a name="user-content-01A4" href="#user-content-01A4" color="#6e7781" class="line-number">$01A4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:44h]</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                      <span class="hljs-comment" color="#6a737d">; ??</span></span>
<a name="user-content-01A6" href="#user-content-01A6" color="#6e7781" class="line-number">$01A6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:50h]</span>, <span class="hljs-number" color="#005cc5">#0FFh</span>                  <span class="hljs-comment" color="#6a737d">; set keypad IRQs to falling edge detection (on press)</span></span>
<a name="user-content-01A9" href="#user-content-01A9" color="#6e7781" class="line-number">$01A9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:51h]</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                      <span class="hljs-comment" color="#6a737d">; set cart eject and ? IRQs to rising edge (ejected)</span></span>
<a name="user-content-01AB" href="#user-content-01AB" color="#6e7781" class="line-number">$01AB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[BR:54h]</span>                      <span class="hljs-comment" color="#6a737d">; set input level check time for ?? to 4ms?</span></span>
<a name="user-content-01AD" href="#user-content-01AD" color="#6e7781" class="line-number">$01AD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#~07h</span>                        <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-01AF" href="#user-content-01AF" color="#6e7781" class="line-number">$01AF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#01h</span>                          <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-01B1" href="#user-content-01B1" color="#6e7781" class="line-number">$01B1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:54h]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                      <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-01B3" href="#user-content-01B3" color="#6e7781" class="line-number">$01B3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:55h]</span>, <span class="hljs-number" color="#005cc5">#01h</span>                   <span class="hljs-comment" color="#6a737d">; set input level check time for ?? to 4ms?</span></span>
<a name="user-content-01B6" href="#user-content-01B6" color="#6e7781" class="line-number">$01B6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:60h]</span>, <span class="hljs-number" color="#005cc5">#0Ch</span>                   <span class="hljs-comment" color="#6a737d">; set EEPROM data/clock directions to output</span></span>
<a name="user-content-01B9" href="#user-content-01B9" color="#6e7781" class="line-number">$01B9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:61h]</span>, <span class="hljs-number" color="#005cc5">#~04h</span>                 <span class="hljs-comment" color="#6a737d">; set EEPROM data bit low</span></span>
<a name="user-content-01BC" href="#user-content-01BC" color="#6e7781" class="line-number">$01BC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:61h]</span>, <span class="hljs-number" color="#005cc5">#08h</span>                   <span class="hljs-comment" color="#6a737d">; set EEPROM clock bit high</span></span>
<a name="user-content-01BF" href="#user-content-01BF" color="#6e7781" class="line-number">$01BF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:61h]</span>, <span class="hljs-number" color="#005cc5">#04h</span>                   <span class="hljs-comment" color="#6a737d">; set EEPROM data bit high</span></span>
<a name="user-content-01C2" href="#user-content-01C2" color="#6e7781" class="line-number">$01C2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:61h]</span>, <span class="hljs-number" color="#005cc5">#20h</span>                   <span class="hljs-comment" color="#6a737d">; set all ports low except IR disable(?)</span></span>
<a name="user-content-01C5" href="#user-content-01C5" color="#6e7781" class="line-number">$01C5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:60h]</span>, <span class="hljs-number" color="#005cc5">#32h</span>                   <span class="hljs-comment" color="#6a737d">; IR disable(?), rumble, IR rx set to output</span></span>
<a name="user-content-01C8" href="#user-content-01C8" color="#6e7781" class="line-number">$01C8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:62h]</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                      <span class="hljs-comment" color="#6a737d">; ??</span></span>
<a name="user-content-01CA" href="#user-content-01CA" color="#6e7781" class="line-number">$01CA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:70h]</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                      <span class="hljs-comment" color="#6a737d">; ??</span></span>
<a name="user-content-01CC" href="#user-content-01CC" color="#6e7781" class="line-number">$01CC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:71h]</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                      <span class="hljs-comment" color="#6a737d">; ??</span></span>
<a name="user-content-01CE" href="#user-content-01CE" color="#6e7781" class="line-number">$01CE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_prc_frame_copy_irq"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_prc_frame_copy_irq" class="hljs-symbol" color="#e36209">_prc_frame_copy_irq</a>:</span>
<a name="user-content-01CF" href="#user-content-01CF" color="#6e7781" class="line-number">$01CF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-01D0" href="#user-content-01D0" color="#6e7781" class="line-number">$01D0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-01D1" href="#user-content-01D1" color="#6e7781" class="line-number">$01D1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-01D4" href="#user-content-01D4" color="#6e7781" class="line-number">$01D4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-01D6" href="#user-content-01D6" color="#6e7781" class="line-number">$01D6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#20h</span>                  <span class="hljs-comment" color="#6a737d">; if cart interrupts are not enabled,</span></span>
<a name="user-content-01D9" href="#user-content-01D9" color="#6e7781" class="line-number">$01D9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-jrl1_intstuff" class="hljs-variable" color="#005cc5">jrl1_intstuff</a>               <span class="hljs-comment" color="#6a737d">; do something</span></span>
<a name="user-content-01DB" href="#user-content-01DB" color="#6e7781" class="line-number">$01DB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-01DC" href="#user-content-01DC" color="#6e7781" class="line-number">$01DC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-01DD" href="#user-content-01DD" color="#6e7781" class="line-number">$01DD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-number" color="#005cc5">2108h</span>                           <span class="hljs-comment" color="#6a737d">; jump to software handler</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_prc_render_irq"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_prc_render_irq" class="hljs-symbol" color="#e36209">_prc_render_irq</a>:</span>
<a name="user-content-01E0" href="#user-content-01E0" color="#6e7781" class="line-number">$01E0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-01E1" href="#user-content-01E1" color="#6e7781" class="line-number">$01E1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-01E2" href="#user-content-01E2" color="#6e7781" class="line-number">$01E2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-01E5" href="#user-content-01E5" color="#6e7781" class="line-number">$01E5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-01E7" href="#user-content-01E7" color="#6e7781" class="line-number">$01E7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-01EA" href="#user-content-01EA" color="#6e7781" class="line-number">$01EA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-jrl1_intstuff" class="hljs-variable" color="#005cc5">jrl1_intstuff</a>               <span class="hljs-comment" color="#6a737d">; same thing here</span></span>
<a name="user-content-01EC" href="#user-content-01EC" color="#6e7781" class="line-number">$01EC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-01ED" href="#user-content-01ED" color="#6e7781" class="line-number">$01ED</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-01EE" href="#user-content-01EE" color="#6e7781" class="line-number">$01EE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-number" color="#005cc5">210Eh</span>                           <span class="hljs-comment" color="#6a737d">; jump to software handler</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_timer_2h_underflow_irq"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_timer_2h_underflow_irq" class="hljs-symbol" color="#e36209">_timer_2h_underflow_irq</a>:</span>
<a name="user-content-01F1" href="#user-content-01F1" color="#6e7781" class="line-number">$01F1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-01F2" href="#user-content-01F2" color="#6e7781" class="line-number">$01F2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-01F3" href="#user-content-01F3" color="#6e7781" class="line-number">$01F3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-01F6" href="#user-content-01F6" color="#6e7781" class="line-number">$01F6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-01F8" href="#user-content-01F8" color="#6e7781" class="line-number">$01F8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-01FB" href="#user-content-01FB" color="#6e7781" class="line-number">$01FB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-jrl1_intstuff" class="hljs-variable" color="#005cc5">jrl1_intstuff</a>               <span class="hljs-comment" color="#6a737d">; and here</span></span>
<a name="user-content-01FD" href="#user-content-01FD" color="#6e7781" class="line-number">$01FD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-01FE" href="#user-content-01FE" color="#6e7781" class="line-number">$01FE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-01FF" href="#user-content-01FF" color="#6e7781" class="line-number">$01FF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-number" color="#005cc5">2114h</span>                           <span class="hljs-comment" color="#6a737d">; jump to software handler</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_timer_2l_underflow_irq"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_timer_2l_underflow_irq" class="hljs-symbol" color="#e36209">_timer_2l_underflow_irq</a>:</span>
<a name="user-content-0202" href="#user-content-0202" color="#6e7781" class="line-number">$0202</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0203" href="#user-content-0203" color="#6e7781" class="line-number">$0203</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0204" href="#user-content-0204" color="#6e7781" class="line-number">$0204</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-0207" href="#user-content-0207" color="#6e7781" class="line-number">$0207</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-0209" href="#user-content-0209" color="#6e7781" class="line-number">$0209</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-020C" href="#user-content-020C" color="#6e7781" class="line-number">$020C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-jrl1_intstuff" class="hljs-variable" color="#005cc5">jrl1_intstuff</a></span>
<a name="user-content-020E" href="#user-content-020E" color="#6e7781" class="line-number">$020E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-020F" href="#user-content-020F" color="#6e7781" class="line-number">$020F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0210" href="#user-content-0210" color="#6e7781" class="line-number">$0210</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-number" color="#005cc5">211Ah</span>                           <span class="hljs-comment" color="#6a737d">; jump to software handler</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_timer_1h_underflow_irq"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_timer_1h_underflow_irq" class="hljs-symbol" color="#e36209">_timer_1h_underflow_irq</a>:</span>
<a name="user-content-0213" href="#user-content-0213" color="#6e7781" class="line-number">$0213</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0214" href="#user-content-0214" color="#6e7781" class="line-number">$0214</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0215" href="#user-content-0215" color="#6e7781" class="line-number">$0215</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-0218" href="#user-content-0218" color="#6e7781" class="line-number">$0218</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-021A" href="#user-content-021A" color="#6e7781" class="line-number">$021A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-021D" href="#user-content-021D" color="#6e7781" class="line-number">$021D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-jrl1_intstuff" class="hljs-variable" color="#005cc5">jrl1_intstuff</a>               <span class="hljs-comment" color="#6a737d">; these all do the same thing</span></span>
<a name="user-content-021F" href="#user-content-021F" color="#6e7781" class="line-number">$021F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0220" href="#user-content-0220" color="#6e7781" class="line-number">$0220</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0221" href="#user-content-0221" color="#6e7781" class="line-number">$0221</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-number" color="#005cc5">2120h</span>                           <span class="hljs-comment" color="#6a737d">; jump to software handler</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_timer_1l_underflow_irq"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_timer_1l_underflow_irq" class="hljs-symbol" color="#e36209">_timer_1l_underflow_irq</a>:</span>
<a name="user-content-0224" href="#user-content-0224" color="#6e7781" class="line-number">$0224</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0225" href="#user-content-0225" color="#6e7781" class="line-number">$0225</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0226" href="#user-content-0226" color="#6e7781" class="line-number">$0226</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-0229" href="#user-content-0229" color="#6e7781" class="line-number">$0229</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-022B" href="#user-content-022B" color="#6e7781" class="line-number">$022B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-022E" href="#user-content-022E" color="#6e7781" class="line-number">$022E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-jrl1_intstuff" class="hljs-variable" color="#005cc5">jrl1_intstuff</a></span>
<a name="user-content-0230" href="#user-content-0230" color="#6e7781" class="line-number">$0230</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0231" href="#user-content-0231" color="#6e7781" class="line-number">$0231</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0232" href="#user-content-0232" color="#6e7781" class="line-number">$0232</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-number" color="#005cc5">2126h</span>                           <span class="hljs-comment" color="#6a737d">; jump to software handler</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_timer_3h_underflow_irq"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_timer_3h_underflow_irq" class="hljs-symbol" color="#e36209">_timer_3h_underflow_irq</a>:</span>
<a name="user-content-0235" href="#user-content-0235" color="#6e7781" class="line-number">$0235</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0236" href="#user-content-0236" color="#6e7781" class="line-number">$0236</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0237" href="#user-content-0237" color="#6e7781" class="line-number">$0237</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-023A" href="#user-content-023A" color="#6e7781" class="line-number">$023A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-023C" href="#user-content-023C" color="#6e7781" class="line-number">$023C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-023F" href="#user-content-023F" color="#6e7781" class="line-number">$023F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-jrl1_intstuff" class="hljs-variable" color="#005cc5">jrl1_intstuff</a></span>
<a name="user-content-0241" href="#user-content-0241" color="#6e7781" class="line-number">$0241</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0242" href="#user-content-0242" color="#6e7781" class="line-number">$0242</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0243" href="#user-content-0243" color="#6e7781" class="line-number">$0243</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-number" color="#005cc5">212Ch</span>                           <span class="hljs-comment" color="#6a737d">; jump to software handler</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_timer_3_cmp_irq"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_timer_3_cmp_irq" class="hljs-symbol" color="#e36209">_timer_3_cmp_irq</a>:</span>
<a name="user-content-0246" href="#user-content-0246" color="#6e7781" class="line-number">$0246</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0247" href="#user-content-0247" color="#6e7781" class="line-number">$0247</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0248" href="#user-content-0248" color="#6e7781" class="line-number">$0248</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-024B" href="#user-content-024B" color="#6e7781" class="line-number">$024B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-024D" href="#user-content-024D" color="#6e7781" class="line-number">$024D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-0250" href="#user-content-0250" color="#6e7781" class="line-number">$0250</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-jrl1_intstuff" class="hljs-variable" color="#005cc5">jrl1_intstuff</a></span>
<a name="user-content-0252" href="#user-content-0252" color="#6e7781" class="line-number">$0252</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0253" href="#user-content-0253" color="#6e7781" class="line-number">$0253</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0254" href="#user-content-0254" color="#6e7781" class="line-number">$0254</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-number" color="#005cc5">2132h</span>                           <span class="hljs-comment" color="#6a737d">; jump to software handler</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-jrl1_intstuff"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-jrl1_intstuff" class="hljs-symbol" color="#e36209">jrl1_intstuff</a>:</span>
<a name="user-content-0257" href="#user-content-0257" color="#6e7781" class="line-number">$0257</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <a href="#user-content-intstuff" class="hljs-variable" color="#005cc5">intstuff</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_timer_32hz_irq"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_timer_32hz_irq" class="hljs-symbol" color="#e36209">_timer_32hz_irq</a>:</span>
<a name="user-content-025A" href="#user-content-025A" color="#6e7781" class="line-number">$025A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-025B" href="#user-content-025B" color="#6e7781" class="line-number">$025B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-025C" href="#user-content-025C" color="#6e7781" class="line-number">$025C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-025F" href="#user-content-025F" color="#6e7781" class="line-number">$025F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-0261" href="#user-content-0261" color="#6e7781" class="line-number">$0261</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-0264" href="#user-content-0264" color="#6e7781" class="line-number">$0264</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-jrl1_intstuff" class="hljs-variable" color="#005cc5">jrl1_intstuff</a></span>
<a name="user-content-0266" href="#user-content-0266" color="#6e7781" class="line-number">$0266</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0267" href="#user-content-0267" color="#6e7781" class="line-number">$0267</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0268" href="#user-content-0268" color="#6e7781" class="line-number">$0268</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-number" color="#005cc5">2138h</span>                           <span class="hljs-comment" color="#6a737d">; jump to software handler</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_timer_8hz_irq"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_timer_8hz_irq" class="hljs-symbol" color="#e36209">_timer_8hz_irq</a>:</span>
<a name="user-content-026B" href="#user-content-026B" color="#6e7781" class="line-number">$026B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-026C" href="#user-content-026C" color="#6e7781" class="line-number">$026C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-026D" href="#user-content-026D" color="#6e7781" class="line-number">$026D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-0270" href="#user-content-0270" color="#6e7781" class="line-number">$0270</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-0272" href="#user-content-0272" color="#6e7781" class="line-number">$0272</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-0275" href="#user-content-0275" color="#6e7781" class="line-number">$0275</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-jrl1_intstuff" class="hljs-variable" color="#005cc5">jrl1_intstuff</a></span>
<a name="user-content-0277" href="#user-content-0277" color="#6e7781" class="line-number">$0277</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0278" href="#user-content-0278" color="#6e7781" class="line-number">$0278</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0279" href="#user-content-0279" color="#6e7781" class="line-number">$0279</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-number" color="#005cc5">213Eh</span>                           <span class="hljs-comment" color="#6a737d">; jump to software handler</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_timer_2hz_irq"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_timer_2hz_irq" class="hljs-symbol" color="#e36209">_timer_2hz_irq</a>:</span>
<a name="user-content-027C" href="#user-content-027C" color="#6e7781" class="line-number">$027C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-027D" href="#user-content-027D" color="#6e7781" class="line-number">$027D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-027E" href="#user-content-027E" color="#6e7781" class="line-number">$027E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-0281" href="#user-content-0281" color="#6e7781" class="line-number">$0281</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-0283" href="#user-content-0283" color="#6e7781" class="line-number">$0283</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-0286" href="#user-content-0286" color="#6e7781" class="line-number">$0286</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-jrl1_intstuff" class="hljs-variable" color="#005cc5">jrl1_intstuff</a></span>
<a name="user-content-0288" href="#user-content-0288" color="#6e7781" class="line-number">$0288</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0289" href="#user-content-0289" color="#6e7781" class="line-number">$0289</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-028A" href="#user-content-028A" color="#6e7781" class="line-number">$028A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-number" color="#005cc5">2144h</span>                           <span class="hljs-comment" color="#6a737d">; jump to software handler</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_timer_1hz_irq"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_timer_1hz_irq" class="hljs-symbol" color="#e36209">_timer_1hz_irq</a>:</span>
<a name="user-content-028D" href="#user-content-028D" color="#6e7781" class="line-number">$028D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-028E" href="#user-content-028E" color="#6e7781" class="line-number">$028E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-028F" href="#user-content-028F" color="#6e7781" class="line-number">$028F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-0292" href="#user-content-0292" color="#6e7781" class="line-number">$0292</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-0294" href="#user-content-0294" color="#6e7781" class="line-number">$0294</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-0297" href="#user-content-0297" color="#6e7781" class="line-number">$0297</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-jrl1_intstuff" class="hljs-variable" color="#005cc5">jrl1_intstuff</a></span>
<a name="user-content-0299" href="#user-content-0299" color="#6e7781" class="line-number">$0299</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-029A" href="#user-content-029A" color="#6e7781" class="line-number">$029A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-029B" href="#user-content-029B" color="#6e7781" class="line-number">$029B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-number" color="#005cc5">214Ah</span>                           <span class="hljs-comment" color="#6a737d">; jump to software handler</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_ir_rx_irq"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_ir_rx_irq" class="hljs-symbol" color="#e36209">_ir_rx_irq</a>:</span>
<a name="user-content-029E" href="#user-content-029E" color="#6e7781" class="line-number">$029E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-029F" href="#user-content-029F" color="#6e7781" class="line-number">$029F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-02A0" href="#user-content-02A0" color="#6e7781" class="line-number">$02A0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-02A3" href="#user-content-02A3" color="#6e7781" class="line-number">$02A3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-02A5" href="#user-content-02A5" color="#6e7781" class="line-number">$02A5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-02A8" href="#user-content-02A8" color="#6e7781" class="line-number">$02A8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-jrl1_intstuff" class="hljs-variable" color="#005cc5">jrl1_intstuff</a></span>
<a name="user-content-02AA" href="#user-content-02AA" color="#6e7781" class="line-number">$02AA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-02AB" href="#user-content-02AB" color="#6e7781" class="line-number">$02AB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-02AC" href="#user-content-02AC" color="#6e7781" class="line-number">$02AC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-number" color="#005cc5">2150h</span>                           <span class="hljs-comment" color="#6a737d">; jump to software handler</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_shake_irq"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_shake_irq" class="hljs-symbol" color="#e36209">_shake_irq</a>:</span>
<a name="user-content-02AF" href="#user-content-02AF" color="#6e7781" class="line-number">$02AF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-02B0" href="#user-content-02B0" color="#6e7781" class="line-number">$02B0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-02B1" href="#user-content-02B1" color="#6e7781" class="line-number">$02B1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-02B4" href="#user-content-02B4" color="#6e7781" class="line-number">$02B4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-02B6" href="#user-content-02B6" color="#6e7781" class="line-number">$02B6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-02B9" href="#user-content-02B9" color="#6e7781" class="line-number">$02B9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-jrl1_intstuff" class="hljs-variable" color="#005cc5">jrl1_intstuff</a></span>
<a name="user-content-02BB" href="#user-content-02BB" color="#6e7781" class="line-number">$02BB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-02BC" href="#user-content-02BC" color="#6e7781" class="line-number">$02BC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-02BD" href="#user-content-02BD" color="#6e7781" class="line-number">$02BD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-number" color="#005cc5">2156h</span>                           <span class="hljs-comment" color="#6a737d">; jump to software handler</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_cartridge_irq"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_cartridge_irq" class="hljs-symbol" color="#e36209">_cartridge_irq</a>:</span>
<a name="user-content-02C0" href="#user-content-02C0" color="#6e7781" class="line-number">$02C0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-02C1" href="#user-content-02C1" color="#6e7781" class="line-number">$02C1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-02C2" href="#user-content-02C2" color="#6e7781" class="line-number">$02C2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-02C5" href="#user-content-02C5" color="#6e7781" class="line-number">$02C5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-02C7" href="#user-content-02C7" color="#6e7781" class="line-number">$02C7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-02CA" href="#user-content-02CA" color="#6e7781" class="line-number">$02CA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-jrl1_intstuff" class="hljs-variable" color="#005cc5">jrl1_intstuff</a></span>
<a name="user-content-02CC" href="#user-content-02CC" color="#6e7781" class="line-number">$02CC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-02CD" href="#user-content-02CD" color="#6e7781" class="line-number">$02CD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-02CE" href="#user-content-02CE" color="#6e7781" class="line-number">$02CE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-number" color="#005cc5">219Eh</span>                           <span class="hljs-comment" color="#6a737d">; jump to software handler</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_key_right_irq"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_key_right_irq" class="hljs-symbol" color="#e36209">_key_right_irq</a>:</span>
<a name="user-content-02D1" href="#user-content-02D1" color="#6e7781" class="line-number">$02D1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-02D2" href="#user-content-02D2" color="#6e7781" class="line-number">$02D2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-02D3" href="#user-content-02D3" color="#6e7781" class="line-number">$02D3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-02D6" href="#user-content-02D6" color="#6e7781" class="line-number">$02D6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-02D8" href="#user-content-02D8" color="#6e7781" class="line-number">$02D8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-02DB" href="#user-content-02DB" color="#6e7781" class="line-number">$02DB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-jrl2_intstuff" class="hljs-variable" color="#005cc5">jrl2_intstuff</a></span>
<a name="user-content-02DD" href="#user-content-02DD" color="#6e7781" class="line-number">$02DD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-02DE" href="#user-content-02DE" color="#6e7781" class="line-number">$02DE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-02DF" href="#user-content-02DF" color="#6e7781" class="line-number">$02DF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-number" color="#005cc5">2162h</span>                           <span class="hljs-comment" color="#6a737d">; jump to software handler</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_key_left_irq"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_key_left_irq" class="hljs-symbol" color="#e36209">_key_left_irq</a>:</span>
<a name="user-content-02E2" href="#user-content-02E2" color="#6e7781" class="line-number">$02E2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-02E3" href="#user-content-02E3" color="#6e7781" class="line-number">$02E3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-02E4" href="#user-content-02E4" color="#6e7781" class="line-number">$02E4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-02E7" href="#user-content-02E7" color="#6e7781" class="line-number">$02E7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-02E9" href="#user-content-02E9" color="#6e7781" class="line-number">$02E9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-02EC" href="#user-content-02EC" color="#6e7781" class="line-number">$02EC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-jrl2_intstuff" class="hljs-variable" color="#005cc5">jrl2_intstuff</a></span>
<a name="user-content-02EE" href="#user-content-02EE" color="#6e7781" class="line-number">$02EE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-02EF" href="#user-content-02EF" color="#6e7781" class="line-number">$02EF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-02F0" href="#user-content-02F0" color="#6e7781" class="line-number">$02F0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-number" color="#005cc5">2168h</span>                           <span class="hljs-comment" color="#6a737d">; jump to software handler</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_key_down_irq"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_key_down_irq" class="hljs-symbol" color="#e36209">_key_down_irq</a>:</span>
<a name="user-content-02F3" href="#user-content-02F3" color="#6e7781" class="line-number">$02F3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-02F4" href="#user-content-02F4" color="#6e7781" class="line-number">$02F4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-02F5" href="#user-content-02F5" color="#6e7781" class="line-number">$02F5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-02F8" href="#user-content-02F8" color="#6e7781" class="line-number">$02F8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-02FA" href="#user-content-02FA" color="#6e7781" class="line-number">$02FA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-02FD" href="#user-content-02FD" color="#6e7781" class="line-number">$02FD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-jrl2_intstuff" class="hljs-variable" color="#005cc5">jrl2_intstuff</a></span>
<a name="user-content-02FF" href="#user-content-02FF" color="#6e7781" class="line-number">$02FF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0300" href="#user-content-0300" color="#6e7781" class="line-number">$0300</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0301" href="#user-content-0301" color="#6e7781" class="line-number">$0301</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-number" color="#005cc5">216Eh</span>                           <span class="hljs-comment" color="#6a737d">; jump to software handler</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_key_up_irq"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_key_up_irq" class="hljs-symbol" color="#e36209">_key_up_irq</a>:</span>
<a name="user-content-0304" href="#user-content-0304" color="#6e7781" class="line-number">$0304</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0305" href="#user-content-0305" color="#6e7781" class="line-number">$0305</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0306" href="#user-content-0306" color="#6e7781" class="line-number">$0306</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-0309" href="#user-content-0309" color="#6e7781" class="line-number">$0309</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-030B" href="#user-content-030B" color="#6e7781" class="line-number">$030B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-030E" href="#user-content-030E" color="#6e7781" class="line-number">$030E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-jrl2_intstuff" class="hljs-variable" color="#005cc5">jrl2_intstuff</a></span>
<a name="user-content-0310" href="#user-content-0310" color="#6e7781" class="line-number">$0310</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0311" href="#user-content-0311" color="#6e7781" class="line-number">$0311</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0312" href="#user-content-0312" color="#6e7781" class="line-number">$0312</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-number" color="#005cc5">2174h</span>                           <span class="hljs-comment" color="#6a737d">; jump to software handler</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_key_c_irq"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_key_c_irq" class="hljs-symbol" color="#e36209">_key_c_irq</a>:</span>
<a name="user-content-0315" href="#user-content-0315" color="#6e7781" class="line-number">$0315</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0316" href="#user-content-0316" color="#6e7781" class="line-number">$0316</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0317" href="#user-content-0317" color="#6e7781" class="line-number">$0317</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-031A" href="#user-content-031A" color="#6e7781" class="line-number">$031A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-031C" href="#user-content-031C" color="#6e7781" class="line-number">$031C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-031F" href="#user-content-031F" color="#6e7781" class="line-number">$031F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-jrl2_intstuff" class="hljs-variable" color="#005cc5">jrl2_intstuff</a></span>
<a name="user-content-0321" href="#user-content-0321" color="#6e7781" class="line-number">$0321</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0322" href="#user-content-0322" color="#6e7781" class="line-number">$0322</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0323" href="#user-content-0323" color="#6e7781" class="line-number">$0323</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-number" color="#005cc5">217Ah</span>                           <span class="hljs-comment" color="#6a737d">; jump to software handler</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_key_b_irq"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_key_b_irq" class="hljs-symbol" color="#e36209">_key_b_irq</a>:</span>
<a name="user-content-0326" href="#user-content-0326" color="#6e7781" class="line-number">$0326</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0327" href="#user-content-0327" color="#6e7781" class="line-number">$0327</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0328" href="#user-content-0328" color="#6e7781" class="line-number">$0328</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-032B" href="#user-content-032B" color="#6e7781" class="line-number">$032B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-032D" href="#user-content-032D" color="#6e7781" class="line-number">$032D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-0330" href="#user-content-0330" color="#6e7781" class="line-number">$0330</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-jrl2_intstuff" class="hljs-variable" color="#005cc5">jrl2_intstuff</a></span>
<a name="user-content-0332" href="#user-content-0332" color="#6e7781" class="line-number">$0332</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0333" href="#user-content-0333" color="#6e7781" class="line-number">$0333</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0334" href="#user-content-0334" color="#6e7781" class="line-number">$0334</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-number" color="#005cc5">2180h</span>                           <span class="hljs-comment" color="#6a737d">; jump to software handler</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_key_a_irq"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_key_a_irq" class="hljs-symbol" color="#e36209">_key_a_irq</a>:</span>
<a name="user-content-0337" href="#user-content-0337" color="#6e7781" class="line-number">$0337</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0338" href="#user-content-0338" color="#6e7781" class="line-number">$0338</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0339" href="#user-content-0339" color="#6e7781" class="line-number">$0339</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-033C" href="#user-content-033C" color="#6e7781" class="line-number">$033C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-033E" href="#user-content-033E" color="#6e7781" class="line-number">$033E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-0341" href="#user-content-0341" color="#6e7781" class="line-number">$0341</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-jrl2_intstuff" class="hljs-variable" color="#005cc5">jrl2_intstuff</a></span>
<a name="user-content-0343" href="#user-content-0343" color="#6e7781" class="line-number">$0343</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0344" href="#user-content-0344" color="#6e7781" class="line-number">$0344</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0345" href="#user-content-0345" color="#6e7781" class="line-number">$0345</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-number" color="#005cc5">2186h</span>                           <span class="hljs-comment" color="#6a737d">; jump to software handler</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_unknown_irq0"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_unknown_irq0" class="hljs-symbol" color="#e36209">_unknown_irq0</a>:</span>
<a name="user-content-0348" href="#user-content-0348" color="#6e7781" class="line-number">$0348</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0349" href="#user-content-0349" color="#6e7781" class="line-number">$0349</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-034A" href="#user-content-034A" color="#6e7781" class="line-number">$034A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-034D" href="#user-content-034D" color="#6e7781" class="line-number">$034D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-034F" href="#user-content-034F" color="#6e7781" class="line-number">$034F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-0352" href="#user-content-0352" color="#6e7781" class="line-number">$0352</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-jrl2_intstuff" class="hljs-variable" color="#005cc5">jrl2_intstuff</a></span>
<a name="user-content-0354" href="#user-content-0354" color="#6e7781" class="line-number">$0354</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0355" href="#user-content-0355" color="#6e7781" class="line-number">$0355</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0356" href="#user-content-0356" color="#6e7781" class="line-number">$0356</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-number" color="#005cc5">218Ch</span>                           <span class="hljs-comment" color="#6a737d">; jump to software handler</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-jrl2_intstuff"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-jrl2_intstuff" class="hljs-symbol" color="#e36209">jrl2_intstuff</a>:</span>
<a name="user-content-0359" href="#user-content-0359" color="#6e7781" class="line-number">$0359</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <a href="#user-content-intstuff" class="hljs-variable" color="#005cc5">intstuff</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_unknown_irq1"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_unknown_irq1" class="hljs-symbol" color="#e36209">_unknown_irq1</a>:</span>
<a name="user-content-035C" href="#user-content-035C" color="#6e7781" class="line-number">$035C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-035D" href="#user-content-035D" color="#6e7781" class="line-number">$035D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-035E" href="#user-content-035E" color="#6e7781" class="line-number">$035E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-0361" href="#user-content-0361" color="#6e7781" class="line-number">$0361</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-0363" href="#user-content-0363" color="#6e7781" class="line-number">$0363</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-0366" href="#user-content-0366" color="#6e7781" class="line-number">$0366</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-jrl2_intstuff" class="hljs-variable" color="#005cc5">jrl2_intstuff</a></span>
<a name="user-content-0368" href="#user-content-0368" color="#6e7781" class="line-number">$0368</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0369" href="#user-content-0369" color="#6e7781" class="line-number">$0369</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-036A" href="#user-content-036A" color="#6e7781" class="line-number">$036A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-number" color="#005cc5">2192h</span>                           <span class="hljs-comment" color="#6a737d">; jump to software handler</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_unknown_irq2"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_unknown_irq2" class="hljs-symbol" color="#e36209">_unknown_irq2</a>:</span>
<a name="user-content-036D" href="#user-content-036D" color="#6e7781" class="line-number">$036D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-036E" href="#user-content-036E" color="#6e7781" class="line-number">$036E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-036F" href="#user-content-036F" color="#6e7781" class="line-number">$036F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-0372" href="#user-content-0372" color="#6e7781" class="line-number">$0372</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-0374" href="#user-content-0374" color="#6e7781" class="line-number">$0374</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-0377" href="#user-content-0377" color="#6e7781" class="line-number">$0377</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-jrl2_intstuff" class="hljs-variable" color="#005cc5">jrl2_intstuff</a></span>
<a name="user-content-0379" href="#user-content-0379" color="#6e7781" class="line-number">$0379</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-037A" href="#user-content-037A" color="#6e7781" class="line-number">$037A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-037B" href="#user-content-037B" color="#6e7781" class="line-number">$037B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-number" color="#005cc5">2198h</span>                           <span class="hljs-comment" color="#6a737d">; jump to software handler</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-intstuff"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; If you intend to wake the unit from something</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; other than pressing the power key, write a JRL</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; instruction to $1FFD before sleeping!</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-intstuff" class="hljs-symbol" color="#e36209">intstuff</a>:</span>
<a name="user-content-037E" href="#user-content-037E" color="#6e7781" class="line-number">$037E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#08h</span>                  <span class="hljs-comment" color="#6a737d">; if clocking CPU with OSC3,</span></span>
<a name="user-content-0381" href="#user-content-0381" color="#6e7781" class="line-number">$0381</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-already_fast0" class="hljs-variable" color="#005cc5">already_fast0</a>               <span class="hljs-comment" color="#6a737d">; no need to start it up again</span></span>
<a name="user-content-0383" href="#user-content-0383" color="#6e7781" class="line-number">$0383</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<a name="user-content-0384" href="#user-content-0384" color="#6e7781" class="line-number">$0384</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-0386" href="#user-content-0386" color="#6e7781" class="line-number">$0386</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-enter_high_speed_operation" class="hljs-variable" color="#005cc5">enter_high_speed_operation</a></span>
<a name="user-content-0389" href="#user-content-0389" color="#6e7781" class="line-number">$0389</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-already_fast0"><a href="#user-content-already_fast0" class="hljs-symbol" color="#e36209">already_fast0</a>:</span>
<a name="user-content-038A" href="#user-content-038A" color="#6e7781" class="line-number">$038A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:71h]</span>, <span class="hljs-number" color="#005cc5">#04h</span>                  <span class="hljs-comment" color="#6a737d">; if cart is powered,</span></span>
<a name="user-content-038D" href="#user-content-038D" color="#6e7781" class="line-number">$038D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-loc_0x03A2" class="hljs-variable" color="#005cc5">loc_0x03A2</a>                   <span class="hljs-comment" color="#6a737d">;</span></span>
<a name="user-content-038F" href="#user-content-038F" color="#6e7781" class="line-number">$038F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#40h</span>                  <span class="hljs-comment" color="#6a737d">; if ??,</span></span>
<a name="user-content-0392" href="#user-content-0392" color="#6e7781" class="line-number">$0392</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-loc_0x03A2" class="hljs-variable" color="#005cc5">loc_0x03A2</a>                   <span class="hljs-comment" color="#6a737d">;</span></span>
<a name="user-content-0394" href="#user-content-0394" color="#6e7781" class="line-number">$0394</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<a name="user-content-0395" href="#user-content-0395" color="#6e7781" class="line-number">$0395</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-0397" href="#user-content-0397" color="#6e7781" class="line-number">$0397</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-power_cart" class="hljs-variable" color="#005cc5">power_cart</a></span>
<a name="user-content-039A" href="#user-content-039A" color="#6e7781" class="line-number">$039A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#40h</span>                  <span class="hljs-comment" color="#6a737d">; if ??,</span></span>
<a name="user-content-039D" href="#user-content-039D" color="#6e7781" class="line-number">$039D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-loc_0x03A1" class="hljs-variable" color="#005cc5">loc_0x03A1</a>                   <span class="hljs-comment" color="#6a737d">;</span></span>
<a name="user-content-039F" href="#user-content-039F" color="#6e7781" class="line-number">$039F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <a href="#user-content-prepare_selected_game" class="hljs-variable" color="#005cc5">prepare_selected_game</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-loc_0x03A1"><a href="#user-content-loc_0x03A1" class="hljs-symbol" color="#e36209">loc_0x03A1</a>:</span>
<a name="user-content-03A1" href="#user-content-03A1" color="#6e7781" class="line-number">$03A1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-loc_0x03A2"><a href="#user-content-loc_0x03A2" class="hljs-symbol" color="#e36209">loc_0x03A2</a>:</span>
<a name="user-content-03A2" href="#user-content-03A2" color="#6e7781" class="line-number">$03A2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#80h</span>                  <span class="hljs-comment" color="#6a737d">; if ??,</span></span>
<a name="user-content-03A5" href="#user-content-03A5" color="#6e7781" class="line-number">$03A5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-loc_0x03B0" class="hljs-variable" color="#005cc5">loc_0x03B0</a>                   <span class="hljs-comment" color="#6a737d">;</span></span>
<a name="user-content-03A7" href="#user-content-03A7" color="#6e7781" class="line-number">$03A7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">ADD</span> <span class="hljs-variable language_" color="#d73a49">SP</span>, <span class="hljs-number" color="#005cc5">#0003h</span>                      <span class="hljs-comment" color="#6a737d">; remove the call to this one</span></span>
<a name="user-content-03AB" href="#user-content-03AB" color="#6e7781" class="line-number">$03AB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span>                              <span class="hljs-comment" color="#6a737d">; restore BR/EP from interrupt&#x27;s pushes</span></span>
<a name="user-content-03AC" href="#user-content-03AC" color="#6e7781" class="line-number">$03AC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span>                              <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-03AD" href="#user-content-03AD" color="#6e7781" class="line-number">$03AD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-number" color="#005cc5">1FFDh</span>                           <span class="hljs-comment" color="#6a737d">; jump to RAM, hope it&#x27;s another JRL!</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-loc_0x03B0"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-loc_0x03B0" class="hljs-symbol" color="#e36209">loc_0x03B0</a>:</span>
<a name="user-content-03B0" href="#user-content-03B0" color="#6e7781" class="line-number">$03B0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<a name="user-content-03B1" href="#user-content-03B1" color="#6e7781" class="line-number">$03B1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-03B3" href="#user-content-03B3" color="#6e7781" class="line-number">$03B3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <a href="#user-content-prepare_selected_game" class="hljs-variable" color="#005cc5">prepare_selected_game</a></span>
<a name="user-content-03B5" href="#user-content-03B5" color="#6e7781" class="line-number">$03B5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-03B8" href="#user-content-03B8" color="#6e7781" class="line-number">$03B8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<a name="user-content-03B9" href="#user-content-03B9" color="#6e7781" class="line-number">$03B9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_key_power_irq"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_key_power_irq" class="hljs-symbol" color="#e36209">_key_power_irq</a>:</span>
<a name="user-content-03BA" href="#user-content-03BA" color="#6e7781" class="line-number">$03BA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-03BB" href="#user-content-03BB" color="#6e7781" class="line-number">$03BB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-03BC" href="#user-content-03BC" color="#6e7781" class="line-number">$03BC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-03BF" href="#user-content-03BF" color="#6e7781" class="line-number">$03BF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-03C1" href="#user-content-03C1" color="#6e7781" class="line-number">$03C1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-03C4" href="#user-content-03C4" color="#6e7781" class="line-number">$03C4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-loc_0x0413" class="hljs-variable" color="#005cc5">loc_0x0413</a></span>
<a name="user-content-03C6" href="#user-content-03C6" color="#6e7781" class="line-number">$03C6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#10h</span></span>
<a name="user-content-03C9" href="#user-content-03C9" color="#6e7781" class="line-number">$03C9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-_reset2" class="hljs-variable" color="#005cc5">_reset2</a></span>
<a name="user-content-03CC" href="#user-content-03CC" color="#6e7781" class="line-number">$03CC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#08h</span></span>
<a name="user-content-03CF" href="#user-content-03CF" color="#6e7781" class="line-number">$03CF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-already_fast1" class="hljs-variable" color="#005cc5">already_fast1</a></span>
<a name="user-content-03D1" href="#user-content-03D1" color="#6e7781" class="line-number">$03D1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<a name="user-content-03D2" href="#user-content-03D2" color="#6e7781" class="line-number">$03D2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-03D4" href="#user-content-03D4" color="#6e7781" class="line-number">$03D4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-enter_high_speed_operation" class="hljs-variable" color="#005cc5">enter_high_speed_operation</a></span>
<a name="user-content-03D7" href="#user-content-03D7" color="#6e7781" class="line-number">$03D7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-already_fast1"><a href="#user-content-already_fast1" class="hljs-symbol" color="#e36209">already_fast1</a>:</span>
<a name="user-content-03D8" href="#user-content-03D8" color="#6e7781" class="line-number">$03D8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:71h]</span>, <span class="hljs-number" color="#005cc5">#04h</span>                  <span class="hljs-comment" color="#6a737d">; if cartidge is powered,</span></span>
<a name="user-content-03DB" href="#user-content-03DB" color="#6e7781" class="line-number">$03DB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-loc_0x03F0" class="hljs-variable" color="#005cc5">loc_0x03F0</a>                   <span class="hljs-comment" color="#6a737d">; go to cart&#x27;s handler</span></span>
<a name="user-content-03DD" href="#user-content-03DD" color="#6e7781" class="line-number">$03DD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#40h</span>                  <span class="hljs-comment" color="#6a737d">; if ??,</span></span>
<a name="user-content-03E0" href="#user-content-03E0" color="#6e7781" class="line-number">$03E0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-loc_0x03F0" class="hljs-variable" color="#005cc5">loc_0x03F0</a>                   <span class="hljs-comment" color="#6a737d">; go to cart&#x27;s handler</span></span>
<a name="user-content-03E2" href="#user-content-03E2" color="#6e7781" class="line-number">$03E2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<a name="user-content-03E3" href="#user-content-03E3" color="#6e7781" class="line-number">$03E3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-03E5" href="#user-content-03E5" color="#6e7781" class="line-number">$03E5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-power_cart" class="hljs-variable" color="#005cc5">power_cart</a></span>
<a name="user-content-03E8" href="#user-content-03E8" color="#6e7781" class="line-number">$03E8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#40h</span></span>
<a name="user-content-03EB" href="#user-content-03EB" color="#6e7781" class="line-number">$03EB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-loc_0x03EF" class="hljs-variable" color="#005cc5">loc_0x03EF</a></span>
<a name="user-content-03ED" href="#user-content-03ED" color="#6e7781" class="line-number">$03ED</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <a href="#user-content-prepare_selected_game" class="hljs-variable" color="#005cc5">prepare_selected_game</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-loc_0x03EF"><a href="#user-content-loc_0x03EF" class="hljs-symbol" color="#e36209">loc_0x03EF</a>:</span>
<a name="user-content-03EF" href="#user-content-03EF" color="#6e7781" class="line-number">$03EF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-loc_0x03F0"><a href="#user-content-loc_0x03F0" class="hljs-symbol" color="#e36209">loc_0x03F0</a>:</span>
<a name="user-content-03F0" href="#user-content-03F0" color="#6e7781" class="line-number">$03F0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#80h</span></span>
<a name="user-content-03F3" href="#user-content-03F3" color="#6e7781" class="line-number">$03F3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-loc_0x03FF" class="hljs-variable" color="#005cc5">loc_0x03FF</a></span>
<a name="user-content-03F5" href="#user-content-03F5" color="#6e7781" class="line-number">$03F5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-03F8" href="#user-content-03F8" color="#6e7781" class="line-number">$03F8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-loc_0x040D" class="hljs-variable" color="#005cc5">loc_0x040D</a></span>
<a name="user-content-03FA" href="#user-content-03FA" color="#6e7781" class="line-number">$03FA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-03FB" href="#user-content-03FB" color="#6e7781" class="line-number">$03FB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-03FC" href="#user-content-03FC" color="#6e7781" class="line-number">$03FC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-number" color="#005cc5">1FFDh</span>                           <span class="hljs-comment" color="#6a737d">; jump to RAM, hope it&#x27;s another JRL!</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-loc_0x03FF"><a href="#user-content-loc_0x03FF" class="hljs-symbol" color="#e36209">loc_0x03FF</a>:</span>
<a name="user-content-03FF" href="#user-content-03FF" color="#6e7781" class="line-number">$03FF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<a name="user-content-0400" href="#user-content-0400" color="#6e7781" class="line-number">$0400</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-0402" href="#user-content-0402" color="#6e7781" class="line-number">$0402</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <a href="#user-content-prepare_selected_game" class="hljs-variable" color="#005cc5">prepare_selected_game</a></span>
<a name="user-content-0404" href="#user-content-0404" color="#6e7781" class="line-number">$0404</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-0407" href="#user-content-0407" color="#6e7781" class="line-number">$0407</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<a name="user-content-0408" href="#user-content-0408" color="#6e7781" class="line-number">$0408</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-040B" href="#user-content-040B" color="#6e7781" class="line-number">$040B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-loc_0x0413" class="hljs-variable" color="#005cc5">loc_0x0413</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-loc_0x040D"><a href="#user-content-loc_0x040D" class="hljs-symbol" color="#e36209">loc_0x040D</a>:</span>
<a name="user-content-040D" href="#user-content-040D" color="#6e7781" class="line-number">$040D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:29h]</span>, <span class="hljs-number" color="#005cc5">#80h</span></span>
<a name="user-content-0410" href="#user-content-0410" color="#6e7781" class="line-number">$0410</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0411" href="#user-content-0411" color="#6e7781" class="line-number">$0411</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0412" href="#user-content-0412" color="#6e7781" class="line-number">$0412</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-loc_0x0413"><a href="#user-content-loc_0x0413" class="hljs-symbol" color="#e36209">loc_0x0413</a>:</span>
<a name="user-content-0413" href="#user-content-0413" color="#6e7781" class="line-number">$0413</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0414" href="#user-content-0414" color="#6e7781" class="line-number">$0414</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0415" href="#user-content-0415" color="#6e7781" class="line-number">$0415</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-number" color="#005cc5">215Ch</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-prepare_selected_game"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Clobbers: XP</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-prepare_selected_game" class="hljs-symbol" color="#e36209">prepare_selected_game</a>:</span>
<a name="user-content-0418" href="#user-content-0418" color="#6e7781" class="line-number">$0418</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">IP</span></span>
<a name="user-content-0419" href="#user-content-0419" color="#6e7781" class="line-number">$0419</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BA</span></span>
<a name="user-content-041A" href="#user-content-041A" color="#6e7781" class="line-number">$041A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-041B" href="#user-content-041B" color="#6e7781" class="line-number">$041B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#08h</span>                  <span class="hljs-comment" color="#6a737d">; if game ID is valid,</span></span>
<a name="user-content-041E" href="#user-content-041E" color="#6e7781" class="line-number">$041E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-psg__use_game_id" class="hljs-variable" color="#005cc5">psg__use_game_id</a>            <span class="hljs-comment" color="#6a737d">; use it</span></span>
<a name="user-content-0420" href="#user-content-0420" color="#6e7781" class="line-number">$0420</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#01h</span>                  <span class="hljs-comment" color="#6a737d">; otherwise, if used startup action 2,</span></span>
<a name="user-content-0423" href="#user-content-0423" color="#6e7781" class="line-number">$0423</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-psg__return" class="hljs-variable" color="#005cc5">psg__return</a></span>
<a name="user-content-0425" href="#user-content-0425" color="#6e7781" class="line-number">$0425</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">L</span>, <span class="hljs-number" color="#005cc5">#00h</span>                          <span class="hljs-comment" color="#6a737d">; select game 0</span></span>
<a name="user-content-0427" href="#user-content-0427" color="#6e7781" class="line-number">$0427</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <a href="#user-content-psg__prepare_banks" class="hljs-variable" color="#005cc5">psg__prepare_banks</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-psg__use_game_id"><a href="#user-content-psg__use_game_id" class="hljs-symbol" color="#e36209">psg__use_game_id</a>:</span>
<a name="user-content-0429" href="#user-content-0429" color="#6e7781" class="line-number">$0429</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">L</span>, <span>[BR:01h]</span>                      <span class="hljs-comment" color="#6a737d">; load game ID into L</span></span>
<a name="user-content-042B" href="#user-content-042B" color="#6e7781" class="line-number">$042B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span class="hljs-variable language_" color="#d73a49">L</span>, <span class="hljs-number" color="#005cc5">#07h</span>                         <span class="hljs-comment" color="#6a737d">; ...</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-psg__prepare_banks"><a href="#user-content-psg__prepare_banks" class="hljs-symbol" color="#e36209">psg__prepare_banks</a>:</span>
<a name="user-content-042E" href="#user-content-042E" color="#6e7781" class="line-number">$042E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">XP</span>, <span class="hljs-number" color="#005cc5">#07h</span>                         <span class="hljs-comment" color="#6a737d">; set external page 1 to load bank 0</span></span>
<a name="user-content-0431" href="#user-content-0431" color="#6e7781" class="line-number">$0431</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#00h</span>                          <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0433" href="#user-content-0433" color="#6e7781" class="line-number">$0433</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-flash_select_bank" class="hljs-variable" color="#005cc5">flash_select_bank</a>              <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0436" href="#user-content-0436" color="#6e7781" class="line-number">$0436</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">L</span>                             <span class="hljs-comment" color="#6a737d">; prepare select game&#x27;s bank selections</span></span>
<a name="user-content-0437" href="#user-content-0437" color="#6e7781" class="line-number">$0437</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-flash_prepare_game" class="hljs-variable" color="#005cc5">flash_prepare_game</a>             <span class="hljs-comment" color="#6a737d">; ...</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-psg__return"><a href="#user-content-psg__return" class="hljs-symbol" color="#e36209">psg__return</a>:</span>
<a name="user-content-043A" href="#user-content-043A" color="#6e7781" class="line-number">$043A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-043B" href="#user-content-043B" color="#6e7781" class="line-number">$043B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BA</span></span>
<a name="user-content-043C" href="#user-content-043C" color="#6e7781" class="line-number">$043C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">IP</span></span>
<a name="user-content-043D" href="#user-content-043D" color="#6e7781" class="line-number">$043D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_cart_eject_irq"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_cart_eject_irq" class="hljs-symbol" color="#e36209">_cart_eject_irq</a>:</span>
<a name="user-content-043E" href="#user-content-043E" color="#6e7781" class="line-number">$043E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-043F" href="#user-content-043F" color="#6e7781" class="line-number">$043F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0440" href="#user-content-0440" color="#6e7781" class="line-number">$0440</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-0443" href="#user-content-0443" color="#6e7781" class="line-number">$0443</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-0445" href="#user-content-0445" color="#6e7781" class="line-number">$0445</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#30h</span></span>
<a name="user-content-0448" href="#user-content-0448" color="#6e7781" class="line-number">$0448</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-_reset2" class="hljs-variable" color="#005cc5">_reset2</a></span>
<a name="user-content-044B" href="#user-content-044B" color="#6e7781" class="line-number">$044B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#08h</span></span>
<a name="user-content-044E" href="#user-content-044E" color="#6e7781" class="line-number">$044E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-already_fast2" class="hljs-variable" color="#005cc5">already_fast2</a></span>
<a name="user-content-0450" href="#user-content-0450" color="#6e7781" class="line-number">$0450</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<a name="user-content-0451" href="#user-content-0451" color="#6e7781" class="line-number">$0451</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-0453" href="#user-content-0453" color="#6e7781" class="line-number">$0453</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-enter_high_speed_operation" class="hljs-variable" color="#005cc5">enter_high_speed_operation</a></span>
<a name="user-content-0456" href="#user-content-0456" color="#6e7781" class="line-number">$0456</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-already_fast2"><a href="#user-content-already_fast2" class="hljs-symbol" color="#e36209">already_fast2</a>:</span>
<a name="user-content-0457" href="#user-content-0457" color="#6e7781" class="line-number">$0457</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#80h</span></span>
<a name="user-content-045A" href="#user-content-045A" color="#6e7781" class="line-number">$045A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-loc_0x0461" class="hljs-variable" color="#005cc5">loc_0x0461</a></span>
<a name="user-content-045C" href="#user-content-045C" color="#6e7781" class="line-number">$045C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#40h</span></span>
<a name="user-content-045F" href="#user-content-045F" color="#6e7781" class="line-number">$045F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-loc_0x0464" class="hljs-variable" color="#005cc5">loc_0x0464</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-loc_0x0461"><a href="#user-content-loc_0x0461" class="hljs-symbol" color="#e36209">loc_0x0461</a>:</span>
<a name="user-content-0461" href="#user-content-0461" color="#6e7781" class="line-number">$0461</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <a href="#user-content-_shutdown" class="hljs-variable" color="#005cc5">_shutdown</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-loc_0x0464"><a href="#user-content-loc_0x0464" class="hljs-symbol" color="#e36209">loc_0x0464</a>:</span>
<a name="user-content-0464" href="#user-content-0464" color="#6e7781" class="line-number">$0464</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:71h]</span>, <span class="hljs-number" color="#005cc5">#04h</span></span>
<a name="user-content-0467" href="#user-content-0467" color="#6e7781" class="line-number">$0467</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-loc_0x0475" class="hljs-variable" color="#005cc5">loc_0x0475</a></span>
<a name="user-content-0469" href="#user-content-0469" color="#6e7781" class="line-number">$0469</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#40h</span></span>
<a name="user-content-046C" href="#user-content-046C" color="#6e7781" class="line-number">$046C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-loc_0x0475" class="hljs-variable" color="#005cc5">loc_0x0475</a></span>
<a name="user-content-046E" href="#user-content-046E" color="#6e7781" class="line-number">$046E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<a name="user-content-046F" href="#user-content-046F" color="#6e7781" class="line-number">$046F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-0471" href="#user-content-0471" color="#6e7781" class="line-number">$0471</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-power_cart" class="hljs-variable" color="#005cc5">power_cart</a></span>
<a name="user-content-0474" href="#user-content-0474" color="#6e7781" class="line-number">$0474</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-loc_0x0475"><a href="#user-content-loc_0x0475" class="hljs-symbol" color="#e36209">loc_0x0475</a>:</span>
<a name="user-content-0475" href="#user-content-0475" color="#6e7781" class="line-number">$0475</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0476" href="#user-content-0476" color="#6e7781" class="line-number">$0476</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0477" href="#user-content-0477" color="#6e7781" class="line-number">$0477</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-number" color="#005cc5">1FFDh</span>                           <span class="hljs-comment" color="#6a737d">; jump to RAM, hope it&#x27;s another JRL!</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_flash_read_ids"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Call _flash_remap_ids before this</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Reads 2100+ so that the reads make it to the cart</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; making the temporary remapping necessary.</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Returns:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   B: manufacturer ID</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   A: device ID</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_flash_read_ids" class="hljs-symbol" color="#e36209">_flash_read_ids</a>:</span>
<a name="user-content-047A" href="#user-content-047A" color="#6e7781" class="line-number">$047A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-flash_read_ids"><a href="#user-content-flash_read_ids" class="hljs-symbol" color="#e36209">flash_read_ids</a>:</span>
<a name="user-content-047B" href="#user-content-047B" color="#6e7781" class="line-number">$047B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<a name="user-content-047C" href="#user-content-047C" color="#6e7781" class="line-number">$047C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-047E" href="#user-content-047E" color="#6e7781" class="line-number">$047E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-047F" href="#user-content-047F" color="#6e7781" class="line-number">$047F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-0480" href="#user-content-0480" color="#6e7781" class="line-number">$0480</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-flash_begin_cmd" class="hljs-variable" color="#005cc5">flash_begin_cmd</a></span>
<a name="user-content-0483" href="#user-content-0483" color="#6e7781" class="line-number">$0483</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">HL</span>, <span class="hljs-number" color="#005cc5">#5555h</span></span>
<a name="user-content-0486" href="#user-content-0486" color="#6e7781" class="line-number">$0486</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[HL]</span>, <span class="hljs-number" color="#005cc5">#90h</span></span>
<a name="user-content-0488" href="#user-content-0488" color="#6e7781" class="line-number">$0488</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span>[2100h]</span></span>
<a name="user-content-048C" href="#user-content-048C" color="#6e7781" class="line-number">$048C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[2101h]</span></span>
<a name="user-content-0490" href="#user-content-0490" color="#6e7781" class="line-number">$0490</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-0491" href="#user-content-0491" color="#6e7781" class="line-number">$0491</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0492" href="#user-content-0492" color="#6e7781" class="line-number">$0492</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_flash_reset"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_flash_reset" class="hljs-symbol" color="#e36209">_flash_reset</a>:</span>
<a name="user-content-0493" href="#user-content-0493" color="#6e7781" class="line-number">$0493</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-flash_reset"><a href="#user-content-flash_reset" class="hljs-symbol" color="#e36209">flash_reset</a>:</span>
<a name="user-content-0494" href="#user-content-0494" color="#6e7781" class="line-number">$0494</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<a name="user-content-0495" href="#user-content-0495" color="#6e7781" class="line-number">$0495</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-0497" href="#user-content-0497" color="#6e7781" class="line-number">$0497</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0498" href="#user-content-0498" color="#6e7781" class="line-number">$0498</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-0499" href="#user-content-0499" color="#6e7781" class="line-number">$0499</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-flash_begin_cmd" class="hljs-variable" color="#005cc5">flash_begin_cmd</a></span>
<a name="user-content-049C" href="#user-content-049C" color="#6e7781" class="line-number">$049C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">HL</span>, <span class="hljs-number" color="#005cc5">#5555h</span></span>
<a name="user-content-049F" href="#user-content-049F" color="#6e7781" class="line-number">$049F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[HL]</span>, <span class="hljs-number" color="#005cc5">#0F0h</span></span>
<a name="user-content-04A1" href="#user-content-04A1" color="#6e7781" class="line-number">$04A1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-04A2" href="#user-content-04A2" color="#6e7781" class="line-number">$04A2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-04A3" href="#user-content-04A3" color="#6e7781" class="line-number">$04A3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_flash_program_byte"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Arguments</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   XP/IX: address to write to</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   A: byte to write</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Returns</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   A: -1 = write failed, 0 = success</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Clobbers: B</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_flash_program_byte" class="hljs-symbol" color="#e36209">_flash_program_byte</a>:</span>
<a name="user-content-04A4" href="#user-content-04A4" color="#6e7781" class="line-number">$04A4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-flash_program_byte"><a href="#user-content-flash_program_byte" class="hljs-symbol" color="#e36209">flash_program_byte</a>:</span>
<a name="user-content-04A5" href="#user-content-04A5" color="#6e7781" class="line-number">$04A5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<a name="user-content-04A6" href="#user-content-04A6" color="#6e7781" class="line-number">$04A6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-04A8" href="#user-content-04A8" color="#6e7781" class="line-number">$04A8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-04A9" href="#user-content-04A9" color="#6e7781" class="line-number">$04A9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-04AA" href="#user-content-04AA" color="#6e7781" class="line-number">$04AA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-flash_begin_cmd" class="hljs-variable" color="#005cc5">flash_begin_cmd</a></span>
<a name="user-content-04AD" href="#user-content-04AD" color="#6e7781" class="line-number">$04AD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">HL</span>, <span class="hljs-number" color="#005cc5">#5555h</span>                       <span class="hljs-comment" color="#6a737d">; final part of write unlock</span></span>
<a name="user-content-04B0" href="#user-content-04B0" color="#6e7781" class="line-number">$04B0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[HL]</span>, <span class="hljs-number" color="#005cc5">#0A0h</span>                      <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-04B2" href="#user-content-04B2" color="#6e7781" class="line-number">$04B2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[IX]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                          <span class="hljs-comment" color="#6a737d">; write byte</span></span>
<a name="user-content-04B3" href="#user-content-04B3" color="#6e7781" class="line-number">$04B3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">H</span>, <span class="hljs-number" color="#005cc5">#08h</span>                          <span class="hljs-comment" color="#6a737d">; try 7x2 reads</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-fpb__wait_for_write"><a href="#user-content-fpb__wait_for_write" class="hljs-symbol" color="#e36209">fpb__wait_for_write</a>:</span>
<a name="user-content-04B5" href="#user-content-04B5" color="#6e7781" class="line-number">$04B5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DEC</span> <span class="hljs-variable language_" color="#d73a49">H</span></span>
<a name="user-content-04B6" href="#user-content-04B6" color="#6e7781" class="line-number">$04B6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-fpb__wfw__unfinished" class="hljs-variable" color="#005cc5">fpb__wfw__unfinished</a></span>
<a name="user-content-04B8" href="#user-content-04B8" color="#6e7781" class="line-number">$04B8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#0FFh</span>                         <span class="hljs-comment" color="#6a737d">; write failed</span></span>
<a name="user-content-04BA" href="#user-content-04BA" color="#6e7781" class="line-number">$04BA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <a href="#user-content-fpb__return" class="hljs-variable" color="#005cc5">fpb__return</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-fpb__wfw__unfinished"><a href="#user-content-fpb__wfw__unfinished" class="hljs-symbol" color="#e36209">fpb__wfw__unfinished</a>:</span>
<a name="user-content-04BC" href="#user-content-04BC" color="#6e7781" class="line-number">$04BC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span>[IX]</span>                          <span class="hljs-comment" color="#6a737d">; check if byte was written correctly</span></span>
<a name="user-content-04BD" href="#user-content-04BD" color="#6e7781" class="line-number">$04BD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                             <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-04BE" href="#user-content-04BE" color="#6e7781" class="line-number">$04BE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-fpb__wait_for_write" class="hljs-variable" color="#005cc5">fpb__wait_for_write</a></span>
<a name="user-content-04C0" href="#user-content-04C0" color="#6e7781" class="line-number">$04C0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span>[IX]</span>                          <span class="hljs-comment" color="#6a737d">; confirm it&#x27;s not a data ghost ??</span></span>
<a name="user-content-04C1" href="#user-content-04C1" color="#6e7781" class="line-number">$04C1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                             <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-04C2" href="#user-content-04C2" color="#6e7781" class="line-number">$04C2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-fpb__wait_for_write" class="hljs-variable" color="#005cc5">fpb__wait_for_write</a></span>
<a name="user-content-04C4" href="#user-content-04C4" color="#6e7781" class="line-number">$04C4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">XOR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                            <span class="hljs-comment" color="#6a737d">; write success</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-fpb__return"><a href="#user-content-fpb__return" class="hljs-symbol" color="#e36209">fpb__return</a>:</span>
<a name="user-content-04C5" href="#user-content-04C5" color="#6e7781" class="line-number">$04C5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-04C6" href="#user-content-04C6" color="#6e7781" class="line-number">$04C6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-04C7" href="#user-content-04C7" color="#6e7781" class="line-number">$04C7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_flash_erase_sector"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; A sector is a 4 KiB section, uniformily placed.</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; IX may contain any address in the section.</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; The cleared sector is filled with 0xFF bytes.</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Arguments</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   XP/IX: sector to erase</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Clobbers: BA</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_flash_erase_sector" class="hljs-symbol" color="#e36209">_flash_erase_sector</a>:</span>
<a name="user-content-04C8" href="#user-content-04C8" color="#6e7781" class="line-number">$04C8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-04CA" href="#user-content-04CA" color="#6e7781" class="line-number">$04CA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-04CB" href="#user-content-04CB" color="#6e7781" class="line-number">$04CB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-04CC" href="#user-content-04CC" color="#6e7781" class="line-number">$04CC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-flash_begin_cmd" class="hljs-variable" color="#005cc5">flash_begin_cmd</a></span>
<a name="user-content-04CF" href="#user-content-04CF" color="#6e7781" class="line-number">$04CF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">HL</span>, <span class="hljs-number" color="#005cc5">#5555h</span>                       <span class="hljs-comment" color="#6a737d">; erase sequence</span></span>
<a name="user-content-04D2" href="#user-content-04D2" color="#6e7781" class="line-number">$04D2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[HL]</span>, <span class="hljs-number" color="#005cc5">#80h</span>                       <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-04D4" href="#user-content-04D4" color="#6e7781" class="line-number">$04D4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[HL]</span>, <span class="hljs-number" color="#005cc5">#0AAh</span>                      <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-04D6" href="#user-content-04D6" color="#6e7781" class="line-number">$04D6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">HL</span>, <span class="hljs-number" color="#005cc5">#2AAAh</span>                       <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-04D9" href="#user-content-04D9" color="#6e7781" class="line-number">$04D9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[HL]</span>, <span class="hljs-number" color="#005cc5">#55h</span>                       <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-04DB" href="#user-content-04DB" color="#6e7781" class="line-number">$04DB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[IX]</span>, <span class="hljs-number" color="#005cc5">#30h</span>                       <span class="hljs-comment" color="#6a737d">; specify sector to erase</span></span>
<a name="user-content-04DD" href="#user-content-04DD" color="#6e7781" class="line-number">$04DD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#0FFh</span>                         <span class="hljs-comment" color="#6a737d">; check for 0xFF to be written</span></span>
<a name="user-content-04DF" href="#user-content-04DF" color="#6e7781" class="line-number">$04DF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">HL</span>, <span class="hljs-number" color="#005cc5">#05001</span>                       <span class="hljs-comment" color="#6a737d">; loop 5000 times</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-fes__wait_for_erase"><a href="#user-content-fes__wait_for_erase" class="hljs-symbol" color="#e36209">fes__wait_for_erase</a>:</span>
<a name="user-content-04E2" href="#user-content-04E2" color="#6e7781" class="line-number">$04E2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DEC</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-04E3" href="#user-content-04E3" color="#6e7781" class="line-number">$04E3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-loc_0x04E9" class="hljs-variable" color="#005cc5">loc_0x04E9</a></span>
<a name="user-content-04E5" href="#user-content-04E5" color="#6e7781" class="line-number">$04E5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#0FFh</span>                         <span class="hljs-comment" color="#6a737d">; erase failed</span></span>
<a name="user-content-04E7" href="#user-content-04E7" color="#6e7781" class="line-number">$04E7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <a href="#user-content-loc_0x04F2" class="hljs-variable" color="#005cc5">loc_0x04F2</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-loc_0x04E9"><a href="#user-content-loc_0x04E9" class="hljs-symbol" color="#e36209">loc_0x04E9</a>:</span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-loc_0x04F2">    <span class="hljs-comment" color="#6a737d">; note that for any read while erase is still going</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-comment" color="#6a737d">; bit 7 will be 0 no matter the data at the location</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-comment" color="#6a737d">; you&#x27;re reading from</span></span>
<a name="user-content-04E9" href="#user-content-04E9" color="#6e7781" class="line-number">$04E9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span>[IX]</span>                          <span class="hljs-comment" color="#6a737d">; check if byte was erased correctly</span></span>
<a name="user-content-04EA" href="#user-content-04EA" color="#6e7781" class="line-number">$04EA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                             <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-04EB" href="#user-content-04EB" color="#6e7781" class="line-number">$04EB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-fes__wait_for_erase" class="hljs-variable" color="#005cc5">fes__wait_for_erase</a></span>
<a name="user-content-04ED" href="#user-content-04ED" color="#6e7781" class="line-number">$04ED</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span>[IX]</span>                          <span class="hljs-comment" color="#6a737d">; copypasta</span></span>
<a name="user-content-04EE" href="#user-content-04EE" color="#6e7781" class="line-number">$04EE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                             <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-04EF" href="#user-content-04EF" color="#6e7781" class="line-number">$04EF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-fes__wait_for_erase" class="hljs-variable" color="#005cc5">fes__wait_for_erase</a></span>
<a name="user-content-04F1" href="#user-content-04F1" color="#6e7781" class="line-number">$04F1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">XOR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                            <span class="hljs-comment" color="#6a737d">; erase success</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-loc_0x04F2" class="hljs-symbol" color="#e36209">loc_0x04F2</a>:</span>
<a name="user-content-04F2" href="#user-content-04F2" color="#6e7781" class="line-number">$04F2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-04F3" href="#user-content-04F3" color="#6e7781" class="line-number">$04F3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-04F4" href="#user-content-04F4" color="#6e7781" class="line-number">$04F4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_flash_enter_bank_select_mode"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Makes writes to $xxFFFF be interpreted as</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; bank selects at the mapper level.</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_flash_enter_bank_select_mode" class="hljs-symbol" color="#e36209">_flash_enter_bank_select_mode</a>:</span>
<a name="user-content-04F5" href="#user-content-04F5" color="#6e7781" class="line-number">$04F5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-flash_enter_bank_select_mode"><a href="#user-content-flash_enter_bank_select_mode" class="hljs-symbol" color="#e36209">flash_enter_bank_select_mode</a>:</span>
<a name="user-content-04F6" href="#user-content-04F6" color="#6e7781" class="line-number">$04F6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<a name="user-content-04F7" href="#user-content-04F7" color="#6e7781" class="line-number">$04F7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-04F9" href="#user-content-04F9" color="#6e7781" class="line-number">$04F9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-04FA" href="#user-content-04FA" color="#6e7781" class="line-number">$04FA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-04FB" href="#user-content-04FB" color="#6e7781" class="line-number">$04FB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-flash_begin_cmd" class="hljs-variable" color="#005cc5">flash_begin_cmd</a></span>
<a name="user-content-04FE" href="#user-content-04FE" color="#6e7781" class="line-number">$04FE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">HL</span>, <span class="hljs-number" color="#005cc5">#5555h</span>                       <span class="hljs-comment" color="#6a737d">; send a command to the mapper</span></span>
<a name="user-content-0501" href="#user-content-0501" color="#6e7781" class="line-number">$0501</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[HL]</span>, <span class="hljs-number" color="#005cc5">#0D0h</span>                      <span class="hljs-comment" color="#6a737d">; ...to unlock bank select</span></span>
<a name="user-content-0503" href="#user-content-0503" color="#6e7781" class="line-number">$0503</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-0504" href="#user-content-0504" color="#6e7781" class="line-number">$0504</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0505" href="#user-content-0505" color="#6e7781" class="line-number">$0505</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_flash_select_bank"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Each bank is 256 KiB which is an addressing</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; space of 0x040000. Thus the system can hold</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; 8 banks. XP=7 with A=1 should be the default</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; state while XP=7 with A=0 allows you to read</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; from the first $2100 bytes of the cartridge</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; by addressing data page 4, code page 8.</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Arguments</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   XP: Bank register to write to; 3+4*x</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   A: Value to write</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_flash_select_bank" class="hljs-symbol" color="#e36209">_flash_select_bank</a>:</span>
<a name="user-content-0506" href="#user-content-0506" color="#6e7781" class="line-number">$0506</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-flash_select_bank"><a href="#user-content-flash_select_bank" class="hljs-symbol" color="#e36209">flash_select_bank</a>:</span>
<a name="user-content-0507" href="#user-content-0507" color="#6e7781" class="line-number">$0507</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<a name="user-content-0508" href="#user-content-0508" color="#6e7781" class="line-number">$0508</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-050A" href="#user-content-050A" color="#6e7781" class="line-number">$050A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-flash_enter_bank_select_mode" class="hljs-variable" color="#005cc5">flash_enter_bank_select_mode</a>   <span class="hljs-comment" color="#6a737d">; unlock bank registers</span></span>
<a name="user-content-050D" href="#user-content-050D" color="#6e7781" class="line-number">$050D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">IX</span></span>
<a name="user-content-050E" href="#user-content-050E" color="#6e7781" class="line-number">$050E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-number" color="#005cc5">#0FFFFh</span>                      <span class="hljs-comment" color="#6a737d">; write to bank select register</span></span>
<a name="user-content-0511" href="#user-content-0511" color="#6e7781" class="line-number">$0511</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[IX]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                          <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0512" href="#user-content-0512" color="#6e7781" class="line-number">$0512</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">IX</span></span>
<a name="user-content-0513" href="#user-content-0513" color="#6e7781" class="line-number">$0513</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-flash_reset" class="hljs-variable" color="#005cc5">flash_reset</a>                    <span class="hljs-comment" color="#6a737d">; lock bank registers</span></span>
<a name="user-content-0516" href="#user-content-0516" color="#6e7781" class="line-number">$0516</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_flash_allow_remapping_page_0"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Without this, writing to 0x03FFFF bank select</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; register is probably a NOP.</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_flash_allow_remapping_page_0" class="hljs-symbol" color="#e36209">_flash_allow_remapping_page_0</a>:</span>
<a name="user-content-0517" href="#user-content-0517" color="#6e7781" class="line-number">$0517</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-flash_allow_remapping_page_0"><a href="#user-content-flash_allow_remapping_page_0" class="hljs-symbol" color="#e36209">flash_allow_remapping_page_0</a>:</span>
<a name="user-content-0518" href="#user-content-0518" color="#6e7781" class="line-number">$0518</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<a name="user-content-0519" href="#user-content-0519" color="#6e7781" class="line-number">$0519</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-051B" href="#user-content-051B" color="#6e7781" class="line-number">$051B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-051C" href="#user-content-051C" color="#6e7781" class="line-number">$051C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-051D" href="#user-content-051D" color="#6e7781" class="line-number">$051D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-flash_begin_cmd" class="hljs-variable" color="#005cc5">flash_begin_cmd</a></span>
<a name="user-content-0520" href="#user-content-0520" color="#6e7781" class="line-number">$0520</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">HL</span>, <span class="hljs-number" color="#005cc5">#5555h</span></span>
<a name="user-content-0523" href="#user-content-0523" color="#6e7781" class="line-number">$0523</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[HL]</span>, <span class="hljs-number" color="#005cc5">#0C9h</span></span>
<a name="user-content-0525" href="#user-content-0525" color="#6e7781" class="line-number">$0525</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[HL]</span>, <span class="hljs-variable language_" color="#d73a49">A</span></span>
<a name="user-content-0526" href="#user-content-0526" color="#6e7781" class="line-number">$0526</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-0527" href="#user-content-0527" color="#6e7781" class="line-number">$0527</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0528" href="#user-content-0528" color="#6e7781" class="line-number">$0528</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_flash_remap_ids"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Instructs the mapper to subtract $2100</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; from the input address. Though it may</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; not be generally usable in this state?</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; This is used with ID mode to read info.</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_flash_remap_ids" class="hljs-symbol" color="#e36209">_flash_remap_ids</a>:</span>
<a name="user-content-0529" href="#user-content-0529" color="#6e7781" class="line-number">$0529</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-flash_remap_ids"><a href="#user-content-flash_remap_ids" class="hljs-symbol" color="#e36209">flash_remap_ids</a>:</span>
<a name="user-content-052A" href="#user-content-052A" color="#6e7781" class="line-number">$052A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<a name="user-content-052B" href="#user-content-052B" color="#6e7781" class="line-number">$052B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-052D" href="#user-content-052D" color="#6e7781" class="line-number">$052D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-052E" href="#user-content-052E" color="#6e7781" class="line-number">$052E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-052F" href="#user-content-052F" color="#6e7781" class="line-number">$052F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-flash_begin_cmd" class="hljs-variable" color="#005cc5">flash_begin_cmd</a></span>
<a name="user-content-0532" href="#user-content-0532" color="#6e7781" class="line-number">$0532</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">HL</span>, <span class="hljs-number" color="#005cc5">#5555h</span></span>
<a name="user-content-0535" href="#user-content-0535" color="#6e7781" class="line-number">$0535</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[HL]</span>, <span class="hljs-number" color="#005cc5">#0C0h</span></span>
<a name="user-content-0537" href="#user-content-0537" color="#6e7781" class="line-number">$0537</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-0538" href="#user-content-0538" color="#6e7781" class="line-number">$0538</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0539" href="#user-content-0539" color="#6e7781" class="line-number">$0539</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_flash_prepare_game"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Prepares banks to run the game.</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Doesn&#x27;t run the game itself.</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Arguments:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   A: game ID (0-based)</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Clobbers: B</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_flash_prepare_game" class="hljs-symbol" color="#e36209">_flash_prepare_game</a>:</span>
<a name="user-content-053A" href="#user-content-053A" color="#6e7781" class="line-number">$053A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-flash_prepare_game"><a href="#user-content-flash_prepare_game" class="hljs-symbol" color="#e36209">flash_prepare_game</a>:</span>
<a name="user-content-053B" href="#user-content-053B" color="#6e7781" class="line-number">$053B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<a name="user-content-053C" href="#user-content-053C" color="#6e7781" class="line-number">$053C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-053E" href="#user-content-053E" color="#6e7781" class="line-number">$053E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">IP</span></span>
<a name="user-content-053F" href="#user-content-053F" color="#6e7781" class="line-number">$053F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">IX</span></span>
<a name="user-content-0540" href="#user-content-0540" color="#6e7781" class="line-number">$0540</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">IY</span></span>
<a name="user-content-0541" href="#user-content-0541" color="#6e7781" class="line-number">$0541</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-0542" href="#user-content-0542" color="#6e7781" class="line-number">$0542</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">L</span>, <span class="hljs-number" color="#005cc5">#60h</span>                          <span class="hljs-comment" color="#6a737d">; size of game structure</span></span>
<a name="user-content-0544" href="#user-content-0544" color="#6e7781" class="line-number">$0544</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">MLT</span>                                <span class="hljs-comment" color="#6a737d">; mlt to get addr in array</span></span>
<a name="user-content-0546" href="#user-content-0546" color="#6e7781" class="line-number">$0546</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-number" color="#005cc5">#1048h</span>                       <span class="hljs-comment" color="#6a737d">; base address of structures + bank select array offset</span></span>
<a name="user-content-0549" href="#user-content-0549" color="#6e7781" class="line-number">$0549</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">ADD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-variable language_" color="#d73a49">HL</span>                          <span class="hljs-comment" color="#6a737d">; offset</span></span>
<a name="user-content-054B" href="#user-content-054B" color="#6e7781" class="line-number">$054B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">XP</span>, <span class="hljs-number" color="#005cc5">#04h</span>                         <span class="hljs-comment" color="#6a737d">; and read</span></span>
<a name="user-content-054E" href="#user-content-054E" color="#6e7781" class="line-number">$054E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[IX]</span>                          <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-054F" href="#user-content-054F" color="#6e7781" class="line-number">$054F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#08h</span>                          <span class="hljs-comment" color="#6a737d">; if bank ID is &gt;= 8,</span></span>
<a name="user-content-0551" href="#user-content-0551" color="#6e7781" class="line-number">$0551</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NC</span>, <a href="#user-content-fsg__skip_remap_0" class="hljs-variable" color="#005cc5">fsg__skip_remap_0</a>           <span class="hljs-comment" color="#6a737d">; don&#x27;t disable region 0</span></span>
<a name="user-content-0553" href="#user-content-0553" color="#6e7781" class="line-number">$0553</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-flash_allow_remapping_page_0" class="hljs-variable" color="#005cc5">flash_allow_remapping_page_0</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-fsg__skip_remap_0"><a href="#user-content-fsg__skip_remap_0" class="hljs-symbol" color="#e36209">fsg__skip_remap_0</a>:</span>
<a name="user-content-0556" href="#user-content-0556" color="#6e7781" class="line-number">$0556</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">SUB</span> <span class="hljs-variable language_" color="#d73a49">SP</span>, <span class="hljs-number" color="#005cc5">#0008h</span>                      <span class="hljs-comment" color="#6a737d">; copy banks to heap</span></span>
<a name="user-content-055A" href="#user-content-055A" color="#6e7781" class="line-number">$055A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">YP</span>, <span class="hljs-number" color="#005cc5">#00h</span>                         <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-055D" href="#user-content-055D" color="#6e7781" class="line-number">$055D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IY</span>, <span class="hljs-variable language_" color="#d73a49">SP</span>                           <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-055F" href="#user-content-055F" color="#6e7781" class="line-number">$055F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">L</span>, <span class="hljs-number" color="#005cc5">#00h</span>                          <span class="hljs-comment" color="#6a737d">; ...</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-fsg__select_banks"><a href="#user-content-fsg__select_banks" class="hljs-symbol" color="#e36209">fsg__select_banks</a>:</span>
<a name="user-content-0561" href="#user-content-0561" color="#6e7781" class="line-number">$0561</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[IX+L]</span>                        <span class="hljs-comment" color="#6a737d">; copy bank ID from ROM</span></span>
<a name="user-content-0563" href="#user-content-0563" color="#6e7781" class="line-number">$0563</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[IY+L]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                        <span class="hljs-comment" color="#6a737d">; ...to heap</span></span>
<a name="user-content-0565" href="#user-content-0565" color="#6e7781" class="line-number">$0565</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">L</span></span>
<a name="user-content-0566" href="#user-content-0566" color="#6e7781" class="line-number">$0566</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">L</span>, <span class="hljs-number" color="#005cc5">#08h</span>                          <span class="hljs-comment" color="#6a737d">; there&#x27;s 8 of them</span></span>
<a name="user-content-0569" href="#user-content-0569" color="#6e7781" class="line-number">$0569</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-fsg__select_banks" class="hljs-variable" color="#005cc5">fsg__select_banks</a></span>
<a name="user-content-056B" href="#user-content-056B" color="#6e7781" class="line-number">$056B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-flash_enter_bank_select_mode" class="hljs-variable" color="#005cc5">flash_enter_bank_select_mode</a></span>
<a name="user-content-056E" href="#user-content-056E" color="#6e7781" class="line-number">$056E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#03h</span>                          <span class="hljs-comment" color="#6a737d">; start at first bank select register</span></span>
<a name="user-content-0570" href="#user-content-0570" color="#6e7781" class="line-number">$0570</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-number" color="#005cc5">#0FFFFh</span>                      <span class="hljs-comment" color="#6a737d">; bank select register address</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-fsg__bank_select_loop"><a href="#user-content-fsg__bank_select_loop" class="hljs-symbol" color="#e36209">fsg__bank_select_loop</a>:</span>
<a name="user-content-0573" href="#user-content-0573" color="#6e7781" class="line-number">$0573</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">XP</span>, <span class="hljs-variable language_" color="#d73a49">A</span></span>
<a name="user-content-0575" href="#user-content-0575" color="#6e7781" class="line-number">$0575</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span>[IY]</span> </span>
<a name="user-content-0576" href="#user-content-0576" color="#6e7781" class="line-number">$0576</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span class="hljs-number" color="#005cc5">#08h</span>                          <span class="hljs-comment" color="#6a737d">; if value is &gt;= 8,</span></span>
<a name="user-content-0579" href="#user-content-0579" color="#6e7781" class="line-number">$0579</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">C</span>, <a href="#user-content-fsg__bsl__already_le8" class="hljs-variable" color="#005cc5">fsg__bsl__already_le8</a></span>
<a name="user-content-057B" href="#user-content-057B" color="#6e7781" class="line-number">$057B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span class="hljs-number" color="#005cc5">#08h</span>                          <span class="hljs-comment" color="#6a737d">; cap to 8 (likely disables region)</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-fsg__bsl__already_le8"><a href="#user-content-fsg__bsl__already_le8" class="hljs-symbol" color="#e36209">fsg__bsl__already_le8</a>:</span>
<a name="user-content-057D" href="#user-content-057D" color="#6e7781" class="line-number">$057D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[IX]</span>, <span class="hljs-variable language_" color="#d73a49">B</span></span>
<a name="user-content-057E" href="#user-content-057E" color="#6e7781" class="line-number">$057E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">IY</span></span>
<a name="user-content-057F" href="#user-content-057F" color="#6e7781" class="line-number">$057F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">ADD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#04h</span>                         <span class="hljs-comment" color="#6a737d">; increment to next bank select register</span></span>
<a name="user-content-0581" href="#user-content-0581" color="#6e7781" class="line-number">$0581</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#23h</span>                          <span class="hljs-comment" color="#6a737d">; unless we hit the end,</span></span>
<a name="user-content-0583" href="#user-content-0583" color="#6e7781" class="line-number">$0583</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-fsg__bank_select_loop" class="hljs-variable" color="#005cc5">fsg__bank_select_loop</a>       <span class="hljs-comment" color="#6a737d">; keep going</span></span>
<a name="user-content-0585" href="#user-content-0585" color="#6e7781" class="line-number">$0585</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-flash_reset" class="hljs-variable" color="#005cc5">flash_reset</a>                    <span class="hljs-comment" color="#6a737d">; lock bank select registers</span></span>
<a name="user-content-0588" href="#user-content-0588" color="#6e7781" class="line-number">$0588</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SP</span>, <span class="hljs-variable language_" color="#d73a49">IY</span></span>
<a name="user-content-058A" href="#user-content-058A" color="#6e7781" class="line-number">$058A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-058B" href="#user-content-058B" color="#6e7781" class="line-number">$058B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">IY</span></span>
<a name="user-content-058C" href="#user-content-058C" color="#6e7781" class="line-number">$058C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">IX</span></span>
<a name="user-content-058D" href="#user-content-058D" color="#6e7781" class="line-number">$058D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">IP</span></span>
<a name="user-content-058E" href="#user-content-058E" color="#6e7781" class="line-number">$058E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-flash_begin_cmd"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Common portion of a JEDEC SDP command sequence.</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Returns:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   EP: $00</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Clobbers: HL</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-flash_begin_cmd" class="hljs-symbol" color="#e36209">flash_begin_cmd</a>:</span>
<a name="user-content-058F" href="#user-content-058F" color="#6e7781" class="line-number">$058F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-0592" href="#user-content-0592" color="#6e7781" class="line-number">$0592</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">HL</span>, <span class="hljs-number" color="#005cc5">#5555h</span></span>
<a name="user-content-0595" href="#user-content-0595" color="#6e7781" class="line-number">$0595</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[HL]</span>, <span class="hljs-number" color="#005cc5">#0AAh</span></span>
<a name="user-content-0597" href="#user-content-0597" color="#6e7781" class="line-number">$0597</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">HL</span>, <span class="hljs-number" color="#005cc5">#2AAAh</span></span>
<a name="user-content-059A" href="#user-content-059A" color="#6e7781" class="line-number">$059A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[HL]</span>, <span class="hljs-number" color="#005cc5">#55h</span></span>
<a name="user-content-059C" href="#user-content-059C" color="#6e7781" class="line-number">$059C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-flash_detect"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Read cart information presuming it&#x27;s a SST39LF/VF016 chip</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; If it&#x27;s not, perform some recovery.</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Returns:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   Z: 0 = SST39LF/VF016, 1 = commercial game/other chip</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Clobbers: BA</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-flash_detect" class="hljs-symbol" color="#e36209">flash_detect</a>:</span>
<a name="user-content-059D" href="#user-content-059D" color="#6e7781" class="line-number">$059D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span>[5555h]</span>                       <span class="hljs-comment" color="#6a737d">; backup in case the chip is something else</span></span>
<a name="user-content-05A1" href="#user-content-05A1" color="#6e7781" class="line-number">$05A1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[2AAAh]</span>                       <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-05A5" href="#user-content-05A5" color="#6e7781" class="line-number">$05A5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BA</span></span>
<a name="user-content-05A6" href="#user-content-05A6" color="#6e7781" class="line-number">$05A6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#0FFh</span></span>
<a name="user-content-05A8" href="#user-content-05A8" color="#6e7781" class="line-number">$05A8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[2AAAh]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                       <span class="hljs-comment" color="#6a737d">; NOPs to clear state ??</span></span>
<a name="user-content-05AC" href="#user-content-05AC" color="#6e7781" class="line-number">$05AC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[2AAAh]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                       <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-05B0" href="#user-content-05B0" color="#6e7781" class="line-number">$05B0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-flash_reset" class="hljs-variable" color="#005cc5">flash_reset</a>                    <span class="hljs-comment" color="#6a737d">; make sure device is in normal state</span></span>
<a name="user-content-05B3" href="#user-content-05B3" color="#6e7781" class="line-number">$05B3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-flash_remap_ids" class="hljs-variable" color="#005cc5">flash_remap_ids</a>                <span class="hljs-comment" color="#6a737d">; have mapped read from $0000 when $2100 is requested</span></span>
<a name="user-content-05B6" href="#user-content-05B6" color="#6e7781" class="line-number">$05B6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-flash_read_ids" class="hljs-variable" color="#005cc5">flash_read_ids</a>                 <span class="hljs-comment" color="#6a737d">; read manufacturer/device ID into BA</span></span>
<a name="user-content-05B9" href="#user-content-05B9" color="#6e7781" class="line-number">$05B9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-flash_reset" class="hljs-variable" color="#005cc5">flash_reset</a>                    <span class="hljs-comment" color="#6a737d">; exit Software ID mode</span></span>
<a name="user-content-05BC" href="#user-content-05BC" color="#6e7781" class="line-number">$05BC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">BA</span>, <span class="hljs-number" color="#005cc5">#0BFD9h</span>                      <span class="hljs-comment" color="#6a737d">; check manufacturer/device ID (SST39?F016)</span></span>
<a name="user-content-05BF" href="#user-content-05BF" color="#6e7781" class="line-number">$05BF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BA</span></span>
<a name="user-content-05C0" href="#user-content-05C0" color="#6e7781" class="line-number">$05C0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-loc_0x05CA" class="hljs-variable" color="#005cc5">loc_0x05CA</a></span>
<a name="user-content-05C2" href="#user-content-05C2" color="#6e7781" class="line-number">$05C2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[5555h]</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                       <span class="hljs-comment" color="#6a737d">; if it was an unexpected chip</span></span>
<a name="user-content-05C6" href="#user-content-05C6" color="#6e7781" class="line-number">$05C6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[2AAAh]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                       <span class="hljs-comment" color="#6a737d">; try to restore the data (NOP if ROM)</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-loc_0x05CA"><a href="#user-content-loc_0x05CA" class="hljs-symbol" color="#e36209">loc_0x05CA</a>:</span>
<a name="user-content-05CA" href="#user-content-05CA" color="#6e7781" class="line-number">$05CA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[2AAAh]</span>                       <span class="hljs-comment" color="#6a737d">; dummy read?</span></span>
<a name="user-content-05CE" href="#user-content-05CE" color="#6e7781" class="line-number">$05CE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-check_cart_type"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-check_cart_type" class="hljs-symbol" color="#e36209">check_cart_type</a>:</span>
<a name="user-content-05CF" href="#user-content-05CF" color="#6e7781" class="line-number">$05CF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-flash_detect" class="hljs-variable" color="#005cc5">flash_detect</a>                   <span class="hljs-comment" color="#6a737d">; Z=0 if using a dev cart</span></span>
<a name="user-content-05D2" href="#user-content-05D2" color="#6e7781" class="line-number">$05D2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-cct__not_flash" class="hljs-variable" color="#005cc5">cct__not_flash</a></span>
<a name="user-content-05D4" href="#user-content-05D4" color="#6e7781" class="line-number">$05D4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">IP</span></span>
<a name="user-content-05D5" href="#user-content-05D5" color="#6e7781" class="line-number">$05D5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">XP</span>, <span class="hljs-number" color="#005cc5">#07h</span>                         <span class="hljs-comment" color="#6a737d">; page register to write to</span></span>
<a name="user-content-05D8" href="#user-content-05D8" color="#6e7781" class="line-number">$05D8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#00h</span>                          <span class="hljs-comment" color="#6a737d">; bank to select</span></span>
<a name="user-content-05DA" href="#user-content-05DA" color="#6e7781" class="line-number">$05DA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-flash_select_bank" class="hljs-variable" color="#005cc5">flash_select_bank</a></span>
<a name="user-content-05DD" href="#user-content-05DD" color="#6e7781" class="line-number">$05DD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">XP</span>, <span class="hljs-number" color="#005cc5">#04h</span>                         <span class="hljs-comment" color="#6a737d">; read startup action from cartridge</span></span>
<a name="user-content-05E0" href="#user-content-05E0" color="#6e7781" class="line-number">$05E0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-number" color="#005cc5">#1300h</span>                       <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-05E3" href="#user-content-05E3" color="#6e7781" class="line-number">$05E3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[IX]</span>                          <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-05E4" href="#user-content-05E4" color="#6e7781" class="line-number">$05E4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">IP</span></span>
<a name="user-content-05E5" href="#user-content-05E5" color="#6e7781" class="line-number">$05E5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#02h</span></span>
<a name="user-content-05E7" href="#user-content-05E7" color="#6e7781" class="line-number">$05E7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-cct__startup_action_2" class="hljs-variable" color="#005cc5">cct__startup_action_2</a></span>
<a name="user-content-05E9" href="#user-content-05E9" color="#6e7781" class="line-number">$05E9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">NB</span>, <span class="hljs-number" color="#005cc5">#08h</span>                         <span class="hljs-comment" color="#6a737d">; startup action 0 and 1,</span></span>
<a name="user-content-05EC" href="#user-content-05EC" color="#6e7781" class="line-number">$05EC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <span class="hljs-number" color="#005cc5">41400h</span>                         <span class="hljs-comment" color="#6a737d">; call 0x041400 on cartridge</span></span>
<a name="user-content-05EF" href="#user-content-05EF" color="#6e7781" class="line-number">$05EF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[RemainingPlays]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>              <span class="hljs-comment" color="#6a737d">; which returns the remaining plays in A</span></span>
<a name="user-content-05F3" href="#user-content-05F3" color="#6e7781" class="line-number">$05F3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <a href="#user-content-nintendo_check" class="hljs-variable" color="#005cc5">nintendo_check</a>                  <span class="hljs-comment" color="#6a737d">; continue to boot</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-cct__startup_action_2"><a href="#user-content-cct__startup_action_2" class="hljs-symbol" color="#e36209">cct__startup_action_2</a>:</span>
<a name="user-content-05F6" href="#user-content-05F6" color="#6e7781" class="line-number">$05F6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#01h</span></span>
<a name="user-content-05F8" href="#user-content-05F8" color="#6e7781" class="line-number">$05F8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-game_select_menu" class="hljs-variable" color="#005cc5">game_select_menu</a></span>
<a name="user-content-05FA" href="#user-content-05FA" color="#6e7781" class="line-number">$05FA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">XOR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                            <span class="hljs-comment" color="#6a737d">; startup action 2 picks the 0th slot</span></span>
<a name="user-content-05FB" href="#user-content-05FB" color="#6e7781" class="line-number">$05FB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-flash_prepare_game" class="hljs-variable" color="#005cc5">flash_prepare_game</a>             <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-05FE" href="#user-content-05FE" color="#6e7781" class="line-number">$05FE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#01h</span>                   <span class="hljs-comment" color="#6a737d">; remember that we used startup action 2</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-cct__not_flash"><a href="#user-content-cct__not_flash" class="hljs-symbol" color="#e36209">cct__not_flash</a>:</span>
<a name="user-content-0601" href="#user-content-0601" color="#6e7781" class="line-number">$0601</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#0FFh</span>                         <span class="hljs-comment" color="#6a737d">; normal carts, unexpected chips, and startup action 2,</span></span>
<a name="user-content-0603" href="#user-content-0603" color="#6e7781" class="line-number">$0603</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[RemainingPlays]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>              <span class="hljs-comment" color="#6a737d">; unlimited play</span></span>
<a name="user-content-0607" href="#user-content-0607" color="#6e7781" class="line-number">$0607</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <a href="#user-content-nintendo_check" class="hljs-variable" color="#005cc5">nintendo_check</a>                  <span class="hljs-comment" color="#6a737d">; continue to boot</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-game_select_menu"><a href="#user-content-game_select_menu" class="hljs-symbol" color="#e36209">game_select_menu</a>:</span>
<a name="user-content-060A" href="#user-content-060A" color="#6e7781" class="line-number">$060A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-number" color="#005cc5">#GameNameTiles</span>               <span class="hljs-comment" color="#6a737d">; address right after the v-flipped decoded tile data</span></span>
<a name="user-content-060D" href="#user-content-060D" color="#6e7781" class="line-number">$060D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">XOR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                            <span class="hljs-comment" color="#6a737d">; 0-fill $19D0~$1C10 (exclusive)</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-gsm__clear"><a href="#user-content-gsm__clear" class="hljs-symbol" color="#e36209">gsm__clear</a>:                             <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-060E" href="#user-content-060E" color="#6e7781" class="line-number">$060E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[IX]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                          <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-060F" href="#user-content-060F" color="#6e7781" class="line-number">$060F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">IX</span>                              <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0610" href="#user-content-0610" color="#6e7781" class="line-number">$0610</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-number" color="#005cc5">#1C10h</span>                       <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0613" href="#user-content-0613" color="#6e7781" class="line-number">$0613</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-gsm__clear" class="hljs-variable" color="#005cc5">gsm__clear</a>                  <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0615" href="#user-content-0615" color="#6e7781" class="line-number">$0615</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">IP</span></span>
<a name="user-content-0616" href="#user-content-0616" color="#6e7781" class="line-number">$0616</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#04h</span>                          <span class="hljs-comment" color="#6a737d">; read from data page 4 (region 1, bank 0)</span></span>
<a name="user-content-0618" href="#user-content-0618" color="#6e7781" class="line-number">$0618</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">XP</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                            <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-061A" href="#user-content-061A" color="#6e7781" class="line-number">$061A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">YP</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                            <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-061C" href="#user-content-061C" color="#6e7781" class="line-number">$061C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">XOR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                            <span class="hljs-comment" color="#6a737d">; initialize memory</span></span>
<a name="user-content-061D" href="#user-content-061D" color="#6e7781" class="line-number">$061D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[NumGameStructs]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>              <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0621" href="#user-content-0621" color="#6e7781" class="line-number">$0621</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[LoopN]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                       <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0625" href="#user-content-0625" color="#6e7781" class="line-number">$0625</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">HL</span>, <span class="hljs-number" color="#005cc5">#GameStructs</span>                 <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0628" href="#user-content-0628" color="#6e7781" class="line-number">$0628</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[NextGameStruct]</span>, <span class="hljs-variable language_" color="#d73a49">HL</span>             <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-062B" href="#user-content-062B" color="#6e7781" class="line-number">$062B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">HL</span>, <span class="hljs-number" color="#005cc5">#GameNameTiles</span>               <span class="hljs-comment" color="#6a737d">; pointer to new tiles</span></span>
<a name="user-content-062E" href="#user-content-062E" color="#6e7781" class="line-number">$062E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[NextTilePos]</span>, <span class="hljs-variable language_" color="#d73a49">HL</span>                <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0631" href="#user-content-0631" color="#6e7781" class="line-number">$0631</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IY</span>, <span class="hljs-number" color="#005cc5">#1050h</span>                       <span class="hljs-comment" color="#6a737d">; starting at type byte for entry 0</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-gsm__load_data_loop"><a href="#user-content-gsm__load_data_loop" class="hljs-symbol" color="#e36209">gsm__load_data_loop</a>:</span>
<a name="user-content-0634" href="#user-content-0634" color="#6e7781" class="line-number">$0634</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[IY]</span>                          <span class="hljs-comment" color="#6a737d">; read from $041050 (first loop)</span></span>
<a name="user-content-0635" href="#user-content-0635" color="#6e7781" class="line-number">$0635</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                             <span class="hljs-comment" color="#6a737d">; if it&#x27;s 0,</span></span>
<a name="user-content-0636" href="#user-content-0636" color="#6e7781" class="line-number">$0636</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-gsm__ldl__end" class="hljs-variable" color="#005cc5">gsm__ldl__end</a>                <span class="hljs-comment" color="#6a737d">; skip entry</span></span>
<a name="user-content-0639" href="#user-content-0639" color="#6e7781" class="line-number">$0639</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#0FFh</span>                         <span class="hljs-comment" color="#6a737d">; if it&#x27;s -1,</span></span>
<a name="user-content-063B" href="#user-content-063B" color="#6e7781" class="line-number">$063B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-gsm__ldl__end" class="hljs-variable" color="#005cc5">gsm__ldl__end</a>                <span class="hljs-comment" color="#6a737d">; skip entry</span></span>
<a name="user-content-063E" href="#user-content-063E" color="#6e7781" class="line-number">$063E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#0FEh</span>                         <span class="hljs-comment" color="#6a737d">; if it&#x27;s -2,</span></span>
<a name="user-content-0640" href="#user-content-0640" color="#6e7781" class="line-number">$0640</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-gsm__ldl__load_data" class="hljs-variable" color="#005cc5">gsm__ldl__load_data</a>          <span class="hljs-comment" color="#6a737d">; load data/tiles</span></span>
<a name="user-content-0642" href="#user-content-0642" color="#6e7781" class="line-number">$0642</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-variable language_" color="#d73a49">IY</span>                           <span class="hljs-comment" color="#6a737d">; otherwise,</span></span>
<a name="user-content-0644" href="#user-content-0644" color="#6e7781" class="line-number">$0644</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">IX</span>                              <span class="hljs-comment" color="#6a737d">; read next byte</span></span>
<a name="user-content-0645" href="#user-content-0645" color="#6e7781" class="line-number">$0645</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[IX]</span>                          <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0646" href="#user-content-0646" color="#6e7781" class="line-number">$0646</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#80h</span>                         <span class="hljs-comment" color="#6a737d">; if MSB is 1</span></span>
<a name="user-content-0648" href="#user-content-0648" color="#6e7781" class="line-number">$0648</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-gsm__ldl__loadable" class="hljs-variable" color="#005cc5">gsm__ldl__loadable</a>          <span class="hljs-comment" color="#6a737d">;</span></span>
<a name="user-content-064A" href="#user-content-064A" color="#6e7781" class="line-number">$064A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">XOR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                            <span class="hljs-comment" color="#6a737d">; otherwise write 0</span></span>
<a name="user-content-064B" href="#user-content-064B" color="#6e7781" class="line-number">$064B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DEC</span> <span class="hljs-variable language_" color="#d73a49">IX</span>                              <span class="hljs-comment" color="#6a737d">; to $041050 (first loop)</span></span>
<a name="user-content-064C" href="#user-content-064C" color="#6e7781" class="line-number">$064C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-flash_program_byte" class="hljs-variable" color="#005cc5">flash_program_byte</a></span>
<a name="user-content-064F" href="#user-content-064F" color="#6e7781" class="line-number">$064F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                             <span class="hljs-comment" color="#6a737d">; if byte was written successfully,</span></span>
<a name="user-content-0650" href="#user-content-0650" color="#6e7781" class="line-number">$0650</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-gsm__ldl__end" class="hljs-variable" color="#005cc5">gsm__ldl__end</a>                <span class="hljs-comment" color="#6a737d">; skip entry</span></span>
<a name="user-content-0653" href="#user-content-0653" color="#6e7781" class="line-number">$0653</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">IP</span>                              <span class="hljs-comment" color="#6a737d">; otherwise,</span></span>
<a name="user-content-0654" href="#user-content-0654" color="#6e7781" class="line-number">$0654</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <a href="#user-content-insert_cart_screen" class="hljs-variable" color="#005cc5">insert_cart_screen</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-gsm__ldl__loadable"><a href="#user-content-gsm__ldl__loadable" class="hljs-symbol" color="#e36209">gsm__ldl__loadable</a>:</span>
<a name="user-content-0657" href="#user-content-0657" color="#6e7781" class="line-number">$0657</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">L</span>, <span class="hljs-number" color="#005cc5">#00h</span>                          <span class="hljs-comment" color="#6a737d">; number of 1-bits</span></span>
<a name="user-content-0659" href="#user-content-0659" color="#6e7781" class="line-number">$0659</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BA</span>, <span class="hljs-variable language_" color="#d73a49">IX</span>                           <span class="hljs-comment" color="#6a737d">; ...from IX</span></span>
<a name="user-content-065B" href="#user-content-065B" color="#6e7781" class="line-number">$065B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">ADD</span> <span class="hljs-variable language_" color="#d73a49">BA</span>, <span class="hljs-number" color="#005cc5">#15</span>                         <span class="hljs-comment" color="#6a737d">; ...for 15 bytes</span></span>
<a name="user-content-065E" href="#user-content-065E" color="#6e7781" class="line-number">$065E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BA</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-gsm__ldl__count_1s_in_byte"><a href="#user-content-gsm__ldl__count_1s_in_byte" class="hljs-symbol" color="#e36209">gsm__ldl__count_1s_in_byte</a>:</span>
<a name="user-content-065F" href="#user-content-065F" color="#6e7781" class="line-number">$065F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[IX]</span>                          <span class="hljs-comment" color="#6a737d">; fetch byte</span></span>
<a name="user-content-0660" href="#user-content-0660" color="#6e7781" class="line-number">$0660</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span class="hljs-number" color="#005cc5">#80h</span>                          <span class="hljs-comment" color="#6a737d">; starting mask (MSB)</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-gsm__ldl__count_1_bits"><a href="#user-content-gsm__ldl__count_1_bits" class="hljs-symbol" color="#e36209">gsm__ldl__count_1_bits</a>:</span>
<a name="user-content-0662" href="#user-content-0662" color="#6e7781" class="line-number">$0662</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                            <span class="hljs-comment" color="#6a737d">; if bit is 0,</span></span>
<a name="user-content-0663" href="#user-content-0663" color="#6e7781" class="line-number">$0663</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-gsm__ldl__remove_bit" class="hljs-variable" color="#005cc5">gsm__ldl__remove_bit</a>         <span class="hljs-comment" color="#6a737d">; exit loop</span></span>
<a name="user-content-0665" href="#user-content-0665" color="#6e7781" class="line-number">$0665</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">L</span>                               <span class="hljs-comment" color="#6a737d">; number of 1-bits +1</span></span>
<a name="user-content-0666" href="#user-content-0666" color="#6e7781" class="line-number">$0666</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">SRL</span> <span class="hljs-variable language_" color="#d73a49">B</span>                               <span class="hljs-comment" color="#6a737d">; move to next bit</span></span>
<a name="user-content-0668" href="#user-content-0668" color="#6e7781" class="line-number">$0668</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-gsm__ldl__count_1_bits" class="hljs-variable" color="#005cc5">gsm__ldl__count_1_bits</a></span>
<a name="user-content-066A" href="#user-content-066A" color="#6e7781" class="line-number">$066A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">IX</span>                              <span class="hljs-comment" color="#6a737d">; move to next byte</span></span>
<a name="user-content-066B" href="#user-content-066B" color="#6e7781" class="line-number">$066B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BA</span>                              <span class="hljs-comment" color="#6a737d">; restore end address for check</span></span>
<a name="user-content-066C" href="#user-content-066C" color="#6e7781" class="line-number">$066C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BA</span>                             <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-066D" href="#user-content-066D" color="#6e7781" class="line-number">$066D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">BA</span>, <span class="hljs-variable language_" color="#d73a49">IX</span>                           <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-066F" href="#user-content-066F" color="#6e7781" class="line-number">$066F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-gsm__ldl__continue_counting" class="hljs-variable" color="#005cc5">gsm__ldl__continue_counting</a> <span class="hljs-comment" color="#6a737d">; continue if we haven&#x27;t hit it (exclusive)</span></span>
<a name="user-content-0671" href="#user-content-0671" color="#6e7781" class="line-number">$0671</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span class="hljs-number" color="#005cc5">#80h</span>                          <span class="hljs-comment" color="#6a737d">; reset mask to MSB for check below</span></span>
<a name="user-content-0673" href="#user-content-0673" color="#6e7781" class="line-number">$0673</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <a href="#user-content-gsm__ldl__remove_bit" class="hljs-variable" color="#005cc5">gsm__ldl__remove_bit</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-gsm__ldl__continue_counting"><a href="#user-content-gsm__ldl__continue_counting" class="hljs-symbol" color="#e36209">gsm__ldl__continue_counting</a>:</span>
<a name="user-content-0675" href="#user-content-0675" color="#6e7781" class="line-number">$0675</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <a href="#user-content-gsm__ldl__count_1s_in_byte" class="hljs-variable" color="#005cc5">gsm__ldl__count_1s_in_byte</a>      <span class="hljs-comment" color="#6a737d">; could&#x27;ve just jumped straight there...</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-gsm__ldl__remove_bit"><a href="#user-content-gsm__ldl__remove_bit" class="hljs-symbol" color="#e36209">gsm__ldl__remove_bit</a>:</span>
<a name="user-content-0677" href="#user-content-0677" color="#6e7781" class="line-number">$0677</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RLC</span> <span class="hljs-variable language_" color="#d73a49">B</span>                               <span class="hljs-comment" color="#6a737d">; if we got here from any bit but the MSB being 0,</span></span>
<a name="user-content-0679" href="#user-content-0679" color="#6e7781" class="line-number">$0679</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span class="hljs-number" color="#005cc5">#01h</span>                          <span class="hljs-comment" color="#6a737d">; these would not be equal,</span></span>
<a name="user-content-067C" href="#user-content-067C" color="#6e7781" class="line-number">$067C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-loc_0x067F" class="hljs-variable" color="#005cc5">loc_0x067F</a>                  <span class="hljs-comment" color="#6a737d">; so we don&#x27;t dec IX</span></span>
<a name="user-content-067E" href="#user-content-067E" color="#6e7781" class="line-number">$067E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DEC</span> <span class="hljs-variable language_" color="#d73a49">IX</span>                              <span class="hljs-comment" color="#6a737d">; otherwise, dec IX back to the last 0xFF byte (IX+15)</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-loc_0x067F"><a href="#user-content-loc_0x067F" class="hljs-symbol" color="#e36209">loc_0x067F</a>:</span>
<a name="user-content-067F" href="#user-content-067F" color="#6e7781" class="line-number">$067F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CPL</span> <span class="hljs-variable language_" color="#d73a49">B</span>                               <span class="hljs-comment" color="#6a737d">; mask everything but bit before the &quot;0&quot;</span></span>
<a name="user-content-0681" href="#user-content-0681" color="#6e7781" class="line-number">$0681</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[IX]</span>                          <span class="hljs-comment" color="#6a737d">; reload in case we decremented</span></span>
<a name="user-content-0682" href="#user-content-0682" color="#6e7781" class="line-number">$0682</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                            <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0683" href="#user-content-0683" color="#6e7781" class="line-number">$0683</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">H</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                             <span class="hljs-comment" color="#6a737d">; cases:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-gsm__ldl__load_data">                                        <span class="hljs-comment" color="#6a737d">; 01 80   -&gt; H = 0x00</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">                                        <span class="hljs-comment" color="#6a737d">; 01 FF08 -&gt; H = 0xFE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">                                        <span class="hljs-comment" color="#6a737d">; 01 FFF8 -&gt; H = 0xF0</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">                                        <span class="hljs-comment" color="#6a737d">; 01 FFFF FFFF FFFF FFFF FFFF FFFF FFFF FFFF -&gt; H = 0xFE</span></span>
<a name="user-content-0684" href="#user-content-0684" color="#6e7781" class="line-number">$0684</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BA</span></span>
<a name="user-content-0685" href="#user-content-0685" color="#6e7781" class="line-number">$0685</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span class="hljs-variable language_" color="#d73a49">H</span></span>
<a name="user-content-0686" href="#user-content-0686" color="#6e7781" class="line-number">$0686</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DEC</span> <span class="hljs-variable language_" color="#d73a49">L</span>                               <span class="hljs-comment" color="#6a737d">; number of 1-bits -1</span></span>
<a name="user-content-0687" href="#user-content-0687" color="#6e7781" class="line-number">$0687</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">L</span>                             <span class="hljs-comment" color="#6a737d">; ...</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-gsm__ldl__load_data" class="hljs-symbol" color="#e36209">gsm__ldl__load_data</a>:</span>
<a name="user-content-0688" href="#user-content-0688" color="#6e7781" class="line-number">$0688</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BA</span></span>
<a name="user-content-0689" href="#user-content-0689" color="#6e7781" class="line-number">$0689</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[NumGameStructs]</span>              <span class="hljs-comment" color="#6a737d">; loading 1 more struct</span></span>
<a name="user-content-068D" href="#user-content-068D" color="#6e7781" class="line-number">$068D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">A</span>                               <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-068E" href="#user-content-068E" color="#6e7781" class="line-number">$068E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[NumGameStructs]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>              <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0692" href="#user-content-0692" color="#6e7781" class="line-number">$0692</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">HL</span>, <span>[NextGameStruct]</span>             <span class="hljs-comment" color="#6a737d">; where we&#x27;re loading the data to</span></span>
<a name="user-content-0695" href="#user-content-0695" color="#6e7781" class="line-number">$0695</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[LoopN]</span>                       <span class="hljs-comment" color="#6a737d">; $00 - index on cart</span></span>
<a name="user-content-0699" href="#user-content-0699" color="#6e7781" class="line-number">$0699</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[HL]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                          <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-069A" href="#user-content-069A" color="#6e7781" class="line-number">$069A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-069B" href="#user-content-069B" color="#6e7781" class="line-number">$069B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BA</span></span>
<a name="user-content-069C" href="#user-content-069C" color="#6e7781" class="line-number">$069C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[HL]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                          <span class="hljs-comment" color="#6a737d">; 0xFE or number of 1-bits - 1</span></span>
<a name="user-content-069D" href="#user-content-069D" color="#6e7781" class="line-number">$069D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-069E" href="#user-content-069E" color="#6e7781" class="line-number">$069E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[HL]</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                          <span class="hljs-comment" color="#6a737d">; garbage byte or ?? (see above)</span></span>
<a name="user-content-069F" href="#user-content-069F" color="#6e7781" class="line-number">$069F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-06A0" href="#user-content-06A0" color="#6e7781" class="line-number">$06A0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[HL]</span>, <span class="hljs-variable language_" color="#d73a49">IX</span>                         <span class="hljs-comment" color="#6a737d">; $1C10 (first loop if 0xFE) or location of byte in B</span></span>
<a name="user-content-06A2" href="#user-content-06A2" color="#6e7781" class="line-number">$06A2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">ADD</span> <span class="hljs-variable language_" color="#d73a49">HL</span>, <span class="hljs-number" color="#005cc5">#5</span>                          <span class="hljs-comment" color="#6a737d">; two bytes from the above addr + 3 slop</span></span>
<a name="user-content-06A5" href="#user-content-06A5" color="#6e7781" class="line-number">$06A5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[NextGameStruct]</span>, <span class="hljs-variable language_" color="#d73a49">HL</span>             <span class="hljs-comment" color="#6a737d">; store addr for next entry</span></span>
<a name="user-content-06A8" href="#user-content-06A8" color="#6e7781" class="line-number">$06A8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">HL</span>, <span>[NextTilePos]</span>                <span class="hljs-comment" color="#6a737d">; where we&#x27;re loading tile gfx to</span></span>
<a name="user-content-06AB" href="#user-content-06AB" color="#6e7781" class="line-number">$06AB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-variable language_" color="#d73a49">IY</span>                           <span class="hljs-comment" color="#6a737d">; $041050 (first loop)</span></span>
<a name="user-content-06AD" href="#user-content-06AD" color="#6e7781" class="line-number">$06AD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span class="hljs-number" color="#005cc5">#72</span>                           <span class="hljs-comment" color="#6a737d">; read 9 tiles (72 bytes)</span></span>
<a name="user-content-06AF" href="#user-content-06AF" color="#6e7781" class="line-number">$06AF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">SUB</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-number" color="#005cc5">#0050h</span>                      <span class="hljs-comment" color="#6a737d">; $041000 (first loop)</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-gsm__ldl__load_name_tiles"><a href="#user-content-gsm__ldl__load_name_tiles" class="hljs-symbol" color="#e36209">gsm__ldl__load_name_tiles</a>:</span>
<a name="user-content-06B2" href="#user-content-06B2" color="#6e7781" class="line-number">$06B2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[HL]</span>, <span>[IX]</span>                       <span class="hljs-comment" color="#6a737d">; load in tile</span></span>
<a name="user-content-06B3" href="#user-content-06B3" color="#6e7781" class="line-number">$06B3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">HL</span>                              <span class="hljs-comment" color="#6a737d">; next</span></span>
<a name="user-content-06B4" href="#user-content-06B4" color="#6e7781" class="line-number">$06B4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">IX</span>                              <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-06B5" href="#user-content-06B5" color="#6e7781" class="line-number">$06B5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DJR</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-gsm__ldl__load_name_tiles" class="hljs-variable" color="#005cc5">gsm__ldl__load_name_tiles</a></span>
<a name="user-content-06B7" href="#user-content-06B7" color="#6e7781" class="line-number">$06B7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[NextTilePos]</span>, <span class="hljs-variable language_" color="#d73a49">HL</span>                <span class="hljs-comment" color="#6a737d">; store addr for next entry</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-gsm__ldl__end"><a href="#user-content-gsm__ldl__end" class="hljs-symbol" color="#e36209">gsm__ldl__end</a>:</span>
<a name="user-content-06BA" href="#user-content-06BA" color="#6e7781" class="line-number">$06BA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">ADD</span> <span class="hljs-variable language_" color="#d73a49">IY</span>, <span class="hljs-number" color="#005cc5">#0060h</span>                      <span class="hljs-comment" color="#6a737d">; $0410B0 (first loop)</span></span>
<a name="user-content-06BD" href="#user-content-06BD" color="#6e7781" class="line-number">$06BD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[LoopN]</span>                       <span class="hljs-comment" color="#6a737d">; increment loop count</span></span>
<a name="user-content-06C1" href="#user-content-06C1" color="#6e7781" class="line-number">$06C1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">A</span>                               <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-06C2" href="#user-content-06C2" color="#6e7781" class="line-number">$06C2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[LoopN]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                       <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-06C6" href="#user-content-06C6" color="#6e7781" class="line-number">$06C6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#08h</span>                          <span class="hljs-comment" color="#6a737d">; if we haven&#x27;t looped 8 times,</span></span>
<a name="user-content-06C8" href="#user-content-06C8" color="#6e7781" class="line-number">$06C8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-gsm__load_data_loop" class="hljs-variable" color="#005cc5">gsm__load_data_loop</a>         <span class="hljs-comment" color="#6a737d">; keep going</span></span>
<a name="user-content-06CB" href="#user-content-06CB" color="#6e7781" class="line-number">$06CB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">IP</span></span>
<a name="user-content-06CC" href="#user-content-06CC" color="#6e7781" class="line-number">$06CC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[NumGameStructs]</span>              <span class="hljs-comment" color="#6a737d">; check if any data was loaded</span></span>
<a name="user-content-06D0" href="#user-content-06D0" color="#6e7781" class="line-number">$06D0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                             <span class="hljs-comment" color="#6a737d">; and if so,</span></span>
<a name="user-content-06D1" href="#user-content-06D1" color="#6e7781" class="line-number">$06D1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-gsm__games_available" class="hljs-variable" color="#005cc5">gsm__games_available</a>        <span class="hljs-comment" color="#6a737d">; show screen</span></span>
<a name="user-content-06D3" href="#user-content-06D3" color="#6e7781" class="line-number">$06D3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <a href="#user-content-insert_cart_screen" class="hljs-variable" color="#005cc5">insert_cart_screen</a>              <span class="hljs-comment" color="#6a737d">; otherwise</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-gsm__games_available"><a href="#user-content-gsm__games_available" class="hljs-symbol" color="#e36209">gsm__games_available</a>:</span>
<a name="user-content-06D6" href="#user-content-06D6" color="#6e7781" class="line-number">$06D6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#08h</span>                   <span class="hljs-comment" color="#6a737d">; ??</span></span>
<a name="user-content-06D9" href="#user-content-06D9" color="#6e7781" class="line-number">$06D9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <a href="#user-content-game_select_screen" class="hljs-variable" color="#005cc5">game_select_screen</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-run_selected_game"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; This is jumped to not called</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Arguments:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   A: game index (in RAM table)</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Clobbers: any</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-run_selected_game" class="hljs-symbol" color="#e36209">run_selected_game</a>:</span>
<a name="user-content-06DC" href="#user-content-06DC" color="#6e7781" class="line-number">$06DC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">SLL</span> <span class="hljs-variable language_" color="#d73a49">A</span>                               <span class="hljs-comment" color="#6a737d">; multiply index by 8 (size of a game struct in memory)</span></span>
<a name="user-content-06DE" href="#user-content-06DE" color="#6e7781" class="line-number">$06DE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">SLL</span> <span class="hljs-variable language_" color="#d73a49">A</span>                               <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-06E0" href="#user-content-06E0" color="#6e7781" class="line-number">$06E0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">SLL</span> <span class="hljs-variable language_" color="#d73a49">A</span>                               <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-06E2" href="#user-content-06E2" color="#6e7781" class="line-number">$06E2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span class="hljs-number" color="#005cc5">#00h</span>                          <span class="hljs-comment" color="#6a737d">; indexing into game structs array</span></span>
<a name="user-content-06E4" href="#user-content-06E4" color="#6e7781" class="line-number">$06E4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IY</span>, <span class="hljs-number" color="#005cc5">#GameStructs</span>                 <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-06E7" href="#user-content-06E7" color="#6e7781" class="line-number">$06E7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">ADD</span> <span class="hljs-variable language_" color="#d73a49">IY</span>, <span class="hljs-variable language_" color="#d73a49">BA</span>                          <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-06E9" href="#user-content-06E9" color="#6e7781" class="line-number">$06E9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">H</span>, <span>[IY]</span>                          <span class="hljs-comment" color="#6a737d">; ...read index in list on cart to H</span></span>
<a name="user-content-06EA" href="#user-content-06EA" color="#6e7781" class="line-number">$06EA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">IY</span></span>
<a name="user-content-06EB" href="#user-content-06EB" color="#6e7781" class="line-number">$06EB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span>[IY]</span>                          <span class="hljs-comment" color="#6a737d">; 0xFE or number of 1-bits - 1</span></span>
<a name="user-content-06EC" href="#user-content-06EC" color="#6e7781" class="line-number">$06EC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[RemainingPlays]</span>, <span class="hljs-variable language_" color="#d73a49">B</span>              <span class="hljs-comment" color="#6a737d">; ...to cart type???</span></span>
<a name="user-content-06F0" href="#user-content-06F0" color="#6e7781" class="line-number">$06F0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span class="hljs-number" color="#005cc5">#0FEh</span>                         <span class="hljs-comment" color="#6a737d">; if it&#x27;s -2,</span></span>
<a name="user-content-06F3" href="#user-content-06F3" color="#6e7781" class="line-number">$06F3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-loc_0x0706" class="hljs-variable" color="#005cc5">loc_0x0706</a>                   <span class="hljs-comment" color="#6a737d">; skip write out</span></span>
<a name="user-content-06F5" href="#user-content-06F5" color="#6e7781" class="line-number">$06F5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">IY</span></span>
<a name="user-content-06F6" href="#user-content-06F6" color="#6e7781" class="line-number">$06F6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[IY]</span>                          <span class="hljs-comment" color="#6a737d">; ??</span></span>
<a name="user-content-06F7" href="#user-content-06F7" color="#6e7781" class="line-number">$06F7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">IY</span></span>
<a name="user-content-06F8" href="#user-content-06F8" color="#6e7781" class="line-number">$06F8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span>[IY]</span>                         <span class="hljs-comment" color="#6a737d">; original location of A</span></span>
<a name="user-content-06FA" href="#user-content-06FA" color="#6e7781" class="line-number">$06FA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">IP</span></span>
<a name="user-content-06FB" href="#user-content-06FB" color="#6e7781" class="line-number">$06FB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">XP</span>, <span class="hljs-number" color="#005cc5">#04h</span>                         <span class="hljs-comment" color="#6a737d">; write masked byte</span></span>
<a name="user-content-06FE" href="#user-content-06FE" color="#6e7781" class="line-number">$06FE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-flash_program_byte" class="hljs-variable" color="#005cc5">flash_program_byte</a>             <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0701" href="#user-content-0701" color="#6e7781" class="line-number">$0701</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">IP</span></span>
<a name="user-content-0702" href="#user-content-0702" color="#6e7781" class="line-number">$0702</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                             <span class="hljs-comment" color="#6a737d">; if it wasn&#x27;t written successfully,</span></span>
<a name="user-content-0703" href="#user-content-0703" color="#6e7781" class="line-number">$0703</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-insert_cart_screen" class="hljs-variable" color="#005cc5">insert_cart_screen</a>          <span class="hljs-comment" color="#6a737d">; exit</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-loc_0x0706"><a href="#user-content-loc_0x0706" class="hljs-symbol" color="#e36209">loc_0x0706</a>:</span>
<a name="user-content-0706" href="#user-content-0706" color="#6e7781" class="line-number">$0706</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span>[BR:01h]</span></span>
<a name="user-content-0708" href="#user-content-0708" color="#6e7781" class="line-number">$0708</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">H</span>                             <span class="hljs-comment" color="#6a737d">; game index to load</span></span>
<a name="user-content-0709" href="#user-content-0709" color="#6e7781" class="line-number">$0709</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                             <span class="hljs-comment" color="#6a737d">; TODO: confirm if line $00C7 makes this safe every time</span></span>
<a name="user-content-070A" href="#user-content-070A" color="#6e7781" class="line-number">$070A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:01h]</span>, <span class="hljs-variable language_" color="#d73a49">A</span></span>
<a name="user-content-070C" href="#user-content-070C" color="#6e7781" class="line-number">$070C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">H</span></span>
<a name="user-content-070D" href="#user-content-070D" color="#6e7781" class="line-number">$070D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-flash_prepare_game" class="hljs-variable" color="#005cc5">flash_prepare_game</a></span>
<a name="user-content-0710" href="#user-content-0710" color="#6e7781" class="line-number">$0710</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <a href="#user-content-nintendo_check" class="hljs-variable" color="#005cc5">nintendo_check</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_suspend_system"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Clobbers: BA</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_suspend_system" class="hljs-symbol" color="#e36209">_suspend_system</a>:</span>
<a name="user-content-0713" href="#user-content-0713" color="#6e7781" class="line-number">$0713</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0714" href="#user-content-0714" color="#6e7781" class="line-number">$0714</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0715" href="#user-content-0715" color="#6e7781" class="line-number">$0715</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-0717" href="#user-content-0717" color="#6e7781" class="line-number">$0717</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-set_br" class="hljs-variable" color="#005cc5">set_br</a></span>
<a name="user-content-071A" href="#user-content-071A" color="#6e7781" class="line-number">$071A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-do_shutdown">    <span class="hljs-comment" color="#6a737d">; back up registers that will be changed</span></span>
<a name="user-content-071D" href="#user-content-071D" color="#6e7781" class="line-number">$071D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[BR:80h]</span>                      <span class="hljs-comment" color="#6a737d">; back up LCD controller config</span></span>
<a name="user-content-071F" href="#user-content-071F" color="#6e7781" class="line-number">$071F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BA</span>                             <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0720" href="#user-content-0720" color="#6e7781" class="line-number">$0720</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span>[BR:50h]</span>                      <span class="hljs-comment" color="#6a737d">; back up input polarities (except cart slot)</span></span>
<a name="user-content-0722" href="#user-content-0722" color="#6e7781" class="line-number">$0722</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[BR:21h]</span>                      <span class="hljs-comment" color="#6a737d">; back up keypad IRQ priorities</span></span>
<a name="user-content-0724" href="#user-content-0724" color="#6e7781" class="line-number">$0724</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#0Ch</span>                         <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0726" href="#user-content-0726" color="#6e7781" class="line-number">$0726</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BA</span>                             <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0727" href="#user-content-0727" color="#6e7781" class="line-number">$0727</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span>[BR:23h]</span>                      <span class="hljs-comment" color="#6a737d">; back up IRQ enable status</span></span>
<a name="user-content-0729" href="#user-content-0729" color="#6e7781" class="line-number">$0729</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[BR:24h]</span>                      <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-072B" href="#user-content-072B" color="#6e7781" class="line-number">$072B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BA</span>                             <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-072C" href="#user-content-072C" color="#6e7781" class="line-number">$072C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span>[BR:25h]</span>                      <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-072E" href="#user-content-072E" color="#6e7781" class="line-number">$072E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[BR:26h]</span>                      <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0730" href="#user-content-0730" color="#6e7781" class="line-number">$0730</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BA</span>                             <span class="hljs-comment" color="#6a737d">; ...</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-comment" color="#6a737d">; When called directly, this needs to be a shutdown sequence</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-comment" color="#6a737d">; See _shutdown for requirements</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-do_shutdown" class="hljs-symbol" color="#e36209">do_shutdown</a>:</span>
<a name="user-content-0731" href="#user-content-0731" color="#6e7781" class="line-number">$0731</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:50h]</span>, <span class="hljs-number" color="#005cc5">#80h</span>                   <span class="hljs-comment" color="#6a737d">; leave power as falling edge, others to rising edge</span></span>
<a name="user-content-0734" href="#user-content-0734" color="#6e7781" class="line-number">$0734</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:54h]</span>, <span class="hljs-number" color="#005cc5">#01h</span>                   <span class="hljs-comment" color="#6a737d">; set input level check time for ?? to 4ms?</span></span>
<a name="user-content-0737" href="#user-content-0737" color="#6e7781" class="line-number">$0737</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:23h]</span>, <span class="hljs-number" color="#005cc5">#00h</span>                   <span class="hljs-comment" color="#6a737d">; disable IRQs</span></span>
<a name="user-content-073A" href="#user-content-073A" color="#6e7781" class="line-number">$073A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:24h]</span>, <span class="hljs-number" color="#005cc5">#00h</span>                   <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-073D" href="#user-content-073D" color="#6e7781" class="line-number">$073D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:25h]</span>, <span class="hljs-number" color="#005cc5">#80h</span>                   <span class="hljs-comment" color="#6a737d">; ...except power key</span></span>
<a name="user-content-0740" href="#user-content-0740" color="#6e7781" class="line-number">$0740</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:26h]</span>, <span class="hljs-number" color="#005cc5">#00h</span>                   <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0743" href="#user-content-0743" color="#6e7781" class="line-number">$0743</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:21h]</span>, <span class="hljs-number" color="#005cc5">#0Ch</span>                   <span class="hljs-comment" color="#6a737d">; power key IRQ priority to 3</span></span>
<a name="user-content-0746" href="#user-content-0746" color="#6e7781" class="line-number">$0746</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-wait_8000_cycles" class="hljs-variable" color="#005cc5">wait_8000_cycles</a></span>
<a name="user-content-0749" href="#user-content-0749" color="#6e7781" class="line-number">$0749</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:29h]</span>, <span class="hljs-number" color="#005cc5">#80h</span>                   <span class="hljs-comment" color="#6a737d">; clear power key IRQ</span></span>
<a name="user-content-074C" href="#user-content-074C" color="#6e7781" class="line-number">$074C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#80h</span>                          <span class="hljs-comment" color="#6a737d">; set interrupt flags to 2 before halt</span></span>
<a name="user-content-074E" href="#user-content-074E" color="#6e7781" class="line-number">$074E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-halt_cpu_and_lcd" class="hljs-variable" color="#005cc5">halt_cpu_and_lcd</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-resume">    <span class="hljs-comment" color="#6a737d">; After resuming from halt (if that&#x27;s possible!)</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-resume" class="hljs-symbol" color="#e36209">resume</a>:</span>
<a name="user-content-0751" href="#user-content-0751" color="#6e7781" class="line-number">$0751</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-lcd_on" class="hljs-variable" color="#005cc5">lcd_on</a></span>
<a name="user-content-0754" href="#user-content-0754" color="#6e7781" class="line-number">$0754</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#~20h</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-r__trust_24">    <span class="hljs-comment" color="#6a737d">; restore registers after awakening</span></span>
<a name="user-content-0757" href="#user-content-0757" color="#6e7781" class="line-number">$0757</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BA</span>                              <span class="hljs-comment" color="#6a737d">; restore IRQ enable status</span></span>
<a name="user-content-0758" href="#user-content-0758" color="#6e7781" class="line-number">$0758</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:26h]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                      <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-075A" href="#user-content-075A" color="#6e7781" class="line-number">$075A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:25h]</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                      <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-075C" href="#user-content-075C" color="#6e7781" class="line-number">$075C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BA</span>                              <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-075D" href="#user-content-075D" color="#6e7781" class="line-number">$075D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:23h]</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                      <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-075F" href="#user-content-075F" color="#6e7781" class="line-number">$075F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#40h</span>                  <span class="hljs-comment" color="#6a737d">; ??</span></span>
<a name="user-content-0762" href="#user-content-0762" color="#6e7781" class="line-number">$0762</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-r__trust_24" class="hljs-variable" color="#005cc5">r__trust_24</a></span>
<a name="user-content-0764" href="#user-content-0764" color="#6e7781" class="line-number">$0764</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#02h</span>                          <span class="hljs-comment" color="#6a737d">; ...also enable cart eject IRQ</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-r__trust_24" class="hljs-symbol" color="#e36209">r__trust_24</a>:</span>
<a name="user-content-0766" href="#user-content-0766" color="#6e7781" class="line-number">$0766</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:24h]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                      <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0768" href="#user-content-0768" color="#6e7781" class="line-number">$0768</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">A</span></span>
<a name="user-content-076A" href="#user-content-076A" color="#6e7781" class="line-number">$076A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span>[BR:21h]</span>                      <span class="hljs-comment" color="#6a737d">; only add back keypad IRQ priorities</span></span>
<a name="user-content-076C" href="#user-content-076C" color="#6e7781" class="line-number">$076C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span class="hljs-number" color="#005cc5">#~0Ch</span>                        <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-076F" href="#user-content-076F" color="#6e7781" class="line-number">$076F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                             <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0770" href="#user-content-0770" color="#6e7781" class="line-number">$0770</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:21h]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                      <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0772" href="#user-content-0772" color="#6e7781" class="line-number">$0772</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">B</span>                               <span class="hljs-comment" color="#6a737d">; restore input polarities (except cart slot)</span></span>
<a name="user-content-0774" href="#user-content-0774" color="#6e7781" class="line-number">$0774</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:50h]</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                      <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0776" href="#user-content-0776" color="#6e7781" class="line-number">$0776</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BA</span>                              <span class="hljs-comment" color="#6a737d">; restore LCD controller config</span></span>
<a name="user-content-0777" href="#user-content-0777" color="#6e7781" class="line-number">$0777</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:80h]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                      <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0779" href="#user-content-0779" color="#6e7781" class="line-number">$0779</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-077A" href="#user-content-077A" color="#6e7781" class="line-number">$077A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-077B" href="#user-content-077B" color="#6e7781" class="line-number">$077B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_sleep"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_sleep" class="hljs-symbol" color="#e36209">_sleep</a>:</span>
<a name="user-content-077C" href="#user-content-077C" color="#6e7781" class="line-number">$077C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-077D" href="#user-content-077D" color="#6e7781" class="line-number">$077D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-077E" href="#user-content-077E" color="#6e7781" class="line-number">$077E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-0780" href="#user-content-0780" color="#6e7781" class="line-number">$0780</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-set_br" class="hljs-variable" color="#005cc5">set_br</a></span>
<a name="user-content-0783" href="#user-content-0783" color="#6e7781" class="line-number">$0783</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#40h</span>                          <span class="hljs-comment" color="#6a737d">; set interrupt flags to 1 before halt</span></span>
<a name="user-content-0785" href="#user-content-0785" color="#6e7781" class="line-number">$0785</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-halt_cpu_and_lcd" class="hljs-variable" color="#005cc5">halt_cpu_and_lcd</a></span>
<a name="user-content-0788" href="#user-content-0788" color="#6e7781" class="line-number">$0788</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0789" href="#user-content-0789" color="#6e7781" class="line-number">$0789</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-078A" href="#user-content-078A" color="#6e7781" class="line-number">$078A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_sleep_with_display"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_sleep_with_display" class="hljs-symbol" color="#e36209">_sleep_with_display</a>:</span>
<a name="user-content-078B" href="#user-content-078B" color="#6e7781" class="line-number">$078B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-078C" href="#user-content-078C" color="#6e7781" class="line-number">$078C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-078D" href="#user-content-078D" color="#6e7781" class="line-number">$078D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-078F" href="#user-content-078F" color="#6e7781" class="line-number">$078F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-set_br" class="hljs-variable" color="#005cc5">set_br</a></span>
<a name="user-content-0792" href="#user-content-0792" color="#6e7781" class="line-number">$0792</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:80h]</span>, <span class="hljs-number" color="#005cc5">#~08h</span>                 <span class="hljs-comment" color="#6a737d">; disable LCD controller</span></span>
<a name="user-content-0795" href="#user-content-0795" color="#6e7781" class="line-number">$0795</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#40h</span>                          <span class="hljs-comment" color="#6a737d">; set interrupt flags to 1 before halt</span></span>
<a name="user-content-0797" href="#user-content-0797" color="#6e7781" class="line-number">$0797</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-halt_cpu" class="hljs-variable" color="#005cc5">halt_cpu</a></span>
<a name="user-content-079A" href="#user-content-079A" color="#6e7781" class="line-number">$079A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-079B" href="#user-content-079B" color="#6e7781" class="line-number">$079B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-079C" href="#user-content-079C" color="#6e7781" class="line-number">$079C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_shutdown"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Power button resets system after this.</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_shutdown" class="hljs-symbol" color="#e36209">_shutdown</a>:</span>
<a name="user-content-079D" href="#user-content-079D" color="#6e7781" class="line-number">$079D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-079F" href="#user-content-079F" color="#6e7781" class="line-number">$079F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SP</span>, <span class="hljs-number" color="#005cc5">#2000h</span></span>
<a name="user-content-07A3" href="#user-content-07A3" color="#6e7781" class="line-number">$07A3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-set_br" class="hljs-variable" color="#005cc5">set_br</a></span>
<a name="user-content-07A6" href="#user-content-07A6" color="#6e7781" class="line-number">$07A6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-init_io" class="hljs-variable" color="#005cc5">init_io</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-shutdown"><a href="#user-content-shutdown" class="hljs-symbol" color="#e36209">shutdown</a>:</span>
<a name="user-content-07A9" href="#user-content-07A9" color="#6e7781" class="line-number">$07A9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-07AB" href="#user-content-07AB" color="#6e7781" class="line-number">$07AB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#90h</span></span>
<a name="user-content-07AE" href="#user-content-07AE" color="#6e7781" class="line-number">$07AE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <a href="#user-content-do_shutdown" class="hljs-variable" color="#005cc5">do_shutdown</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_sleep2"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Same as _sleep just lines 3 and 4 swapped...</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Official software uses _sleep rather than this.</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_sleep2" class="hljs-symbol" color="#e36209">_sleep2</a>:</span>
<a name="user-content-07B1" href="#user-content-07B1" color="#6e7781" class="line-number">$07B1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-07B2" href="#user-content-07B2" color="#6e7781" class="line-number">$07B2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-07B3" href="#user-content-07B3" color="#6e7781" class="line-number">$07B3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-set_br" class="hljs-variable" color="#005cc5">set_br</a></span>
<a name="user-content-07B6" href="#user-content-07B6" color="#6e7781" class="line-number">$07B6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-07B8" href="#user-content-07B8" color="#6e7781" class="line-number">$07B8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#40h</span>                          <span class="hljs-comment" color="#6a737d">; set interrupt flags to 1 before halt</span></span>
<a name="user-content-07BA" href="#user-content-07BA" color="#6e7781" class="line-number">$07BA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-halt_cpu_and_lcd" class="hljs-variable" color="#005cc5">halt_cpu_and_lcd</a></span>
<a name="user-content-07BD" href="#user-content-07BD" color="#6e7781" class="line-number">$07BD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-07BE" href="#user-content-07BE" color="#6e7781" class="line-number">$07BE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-07BF" href="#user-content-07BF" color="#6e7781" class="line-number">$07BF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-halt_cpu_and_lcd"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Arguments:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   A copied to SC right before HALT</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-halt_cpu_and_lcd" class="hljs-symbol" color="#e36209">halt_cpu_and_lcd</a>:</span>
<a name="user-content-07C0" href="#user-content-07C0" color="#6e7781" class="line-number">$07C0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-lcd_off" class="hljs-variable" color="#005cc5">lcd_off</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-halt_cpu"><a href="#user-content-halt_cpu" class="hljs-symbol" color="#e36209">halt_cpu</a>:</span>
<a name="user-content-07C3" href="#user-content-07C3" color="#6e7781" class="line-number">$07C3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#80h</span></span>
<a name="user-content-07C6" href="#user-content-07C6" color="#6e7781" class="line-number">$07C6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-hc__wake_on_cart" class="hljs-variable" color="#005cc5">hc__wake_on_cart</a></span>
<a name="user-content-07C8" href="#user-content-07C8" color="#6e7781" class="line-number">$07C8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#40h</span></span>
<a name="user-content-07CB" href="#user-content-07CB" color="#6e7781" class="line-number">$07CB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-hc__halt_sequence" class="hljs-variable" color="#005cc5">hc__halt_sequence</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-hc__wake_on_cart"><a href="#user-content-hc__wake_on_cart" class="hljs-symbol" color="#e36209">hc__wake_on_cart</a>:                       <span class="hljs-comment" color="#6a737d">; ejected? inserted?</span></span>
<a name="user-content-07CD" href="#user-content-07CD" color="#6e7781" class="line-number">$07CD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:24h]</span>, <span class="hljs-number" color="#005cc5">#02h</span>                   <span class="hljs-comment" color="#6a737d">; enable cart eject IRQ</span></span>
<a name="user-content-07D0" href="#user-content-07D0" color="#6e7781" class="line-number">$07D0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:21h]</span>, <span class="hljs-number" color="#005cc5">#30h</span>                   <span class="hljs-comment" color="#6a737d">; set cartridge IRQs&#x27; priorities to 3</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-hc__halt_sequence"><a href="#user-content-hc__halt_sequence" class="hljs-symbol" color="#e36209">hc__halt_sequence</a>:</span>
<a name="user-content-07D3" href="#user-content-07D3" color="#6e7781" class="line-number">$07D3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:51h]</span>, <span class="hljs-number" color="#005cc5">#~02h</span>                 <span class="hljs-comment" color="#6a737d">; set cart eject IRQ to rising edge (ejected)</span></span>
<a name="user-content-07D6" href="#user-content-07D6" color="#6e7781" class="line-number">$07D6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:55h]</span>, <span class="hljs-number" color="#005cc5">#01h</span>                   <span class="hljs-comment" color="#6a737d">; set input level check time for ?? to 4ms?</span></span>
<a name="user-content-07D9" href="#user-content-07D9" color="#6e7781" class="line-number">$07D9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#~20h</span></span>
<a name="user-content-07DC" href="#user-content-07DC" color="#6e7781" class="line-number">$07DC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-unpower_cart" class="hljs-variable" color="#005cc5">unpower_cart</a></span>
<a name="user-content-07DF" href="#user-content-07DF" color="#6e7781" class="line-number">$07DF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-enter_low_speed_operation" class="hljs-variable" color="#005cc5">enter_low_speed_operation</a></span>
<a name="user-content-07E2" href="#user-content-07E2" color="#6e7781" class="line-number">$07E2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-variable language_" color="#d73a49">A</span></span>
<a name="user-content-07E4" href="#user-content-07E4" color="#6e7781" class="line-number">$07E4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">HALT</span></span>
<a name="user-content-07E6" href="#user-content-07E6" color="#6e7781" class="line-number">$07E6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-07E8" href="#user-content-07E8" color="#6e7781" class="line-number">$07E8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_default_contrast"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Stores and applies a contrast value which can be</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; restored with _apply_default_contrast (INT [50h]).</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Default set by the BIOS is 31.</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Arguments:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   A: new default contrast, 0~63</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Clobbers: B</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_default_contrast" class="hljs-symbol" color="#e36209">_default_contrast</a>:</span>
<a name="user-content-07E9" href="#user-content-07E9" color="#6e7781" class="line-number">$07E9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-default_contrast"><a href="#user-content-default_contrast" class="hljs-symbol" color="#e36209">default_contrast</a>:</span>
<a name="user-content-07EA" href="#user-content-07EA" color="#6e7781" class="line-number">$07EA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">SLL</span> <span class="hljs-variable language_" color="#d73a49">A</span></span>
<a name="user-content-07EC" href="#user-content-07EC" color="#6e7781" class="line-number">$07EC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">SLL</span> <span class="hljs-variable language_" color="#d73a49">A</span></span>
<a name="user-content-07EE" href="#user-content-07EE" color="#6e7781" class="line-number">$07EE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-07EF" href="#user-content-07EF" color="#6e7781" class="line-number">$07EF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-07F0" href="#user-content-07F0" color="#6e7781" class="line-number">$07F0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-07F3" href="#user-content-07F3" color="#6e7781" class="line-number">$07F3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">HL</span>, <span class="hljs-number" color="#005cc5">#2000h</span></span>
<a name="user-content-07F6" href="#user-content-07F6" color="#6e7781" class="line-number">$07F6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[HL]</span>, <span class="hljs-number" color="#005cc5">#03h</span></span>
<a name="user-content-07F9" href="#user-content-07F9" color="#6e7781" class="line-number">$07F9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[HL]</span>, <span class="hljs-variable language_" color="#d73a49">A</span></span>
<a name="user-content-07FB" href="#user-content-07FB" color="#6e7781" class="line-number">$07FB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-07FC" href="#user-content-07FC" color="#6e7781" class="line-number">$07FC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-07FD" href="#user-content-07FD" color="#6e7781" class="line-number">$07FD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-get_default_contrast" class="hljs-variable" color="#005cc5">get_default_contrast</a></span>
<a name="user-content-0800" href="#user-content-0800" color="#6e7781" class="line-number">$0800</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <a href="#user-content-set_temp_contrast" class="hljs-variable" color="#005cc5">set_temp_contrast</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_change_contrast"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Step contrast up or down based on Z</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Arguments:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   Z: 0 = decrement, 1 = increment</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Returns:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   A: -1 = fail, 0 = success</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Clobbers: B</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_change_contrast" class="hljs-symbol" color="#e36209">_change_contrast</a>:</span>
<a name="user-content-0802" href="#user-content-0802" color="#6e7781" class="line-number">$0802</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-get_default_contrast" class="hljs-variable" color="#005cc5">get_default_contrast</a></span>
<a name="user-content-0805" href="#user-content-0805" color="#6e7781" class="line-number">$0805</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<a name="user-content-0806" href="#user-content-0806" color="#6e7781" class="line-number">$0806</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<a name="user-content-0807" href="#user-content-0807" color="#6e7781" class="line-number">$0807</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-cc__try_decrement" class="hljs-variable" color="#005cc5">cc__try_decrement</a>            <span class="hljs-comment" color="#6a737d">; decrement if Z=0</span></span>
<a name="user-content-0809" href="#user-content-0809" color="#6e7781" class="line-number">$0809</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#03Fh</span>                         <span class="hljs-comment" color="#6a737d">; if contrast is already max,</span></span>
<a name="user-content-080B" href="#user-content-080B" color="#6e7781" class="line-number">$080B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-cc__fail" class="hljs-variable" color="#005cc5">cc__fail</a>                     <span class="hljs-comment" color="#6a737d">; fail out</span></span>
<a name="user-content-080D" href="#user-content-080D" color="#6e7781" class="line-number">$080D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">A</span>                               <span class="hljs-comment" color="#6a737d">; Z=1 so increment</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-cc__set_and_return"><a href="#user-content-cc__set_and_return" class="hljs-symbol" color="#e36209">cc__set_and_return</a>:</span>
<a name="user-content-080E" href="#user-content-080E" color="#6e7781" class="line-number">$080E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <a href="#user-content-default_contrast" class="hljs-variable" color="#005cc5">default_contrast</a>               <span class="hljs-comment" color="#6a737d">; store and apply</span></span>
<a name="user-content-0810" href="#user-content-0810" color="#6e7781" class="line-number">$0810</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">XOR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                            <span class="hljs-comment" color="#6a737d">; return success</span></span>
<a name="user-content-0811" href="#user-content-0811" color="#6e7781" class="line-number">$0811</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-cc__try_decrement"><a href="#user-content-cc__try_decrement" class="hljs-symbol" color="#e36209">cc__try_decrement</a>:</span>
<a name="user-content-0812" href="#user-content-0812" color="#6e7781" class="line-number">$0812</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                             <span class="hljs-comment" color="#6a737d">; if A &gt; 0,</span></span>
<a name="user-content-0813" href="#user-content-0813" color="#6e7781" class="line-number">$0813</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-cc__decrement" class="hljs-variable" color="#005cc5">cc__decrement</a>               <span class="hljs-comment" color="#6a737d">; decrement</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-cc__fail"><a href="#user-content-cc__fail" class="hljs-symbol" color="#e36209">cc__fail</a>:</span>
<a name="user-content-0815" href="#user-content-0815" color="#6e7781" class="line-number">$0815</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#0FFh</span>                         <span class="hljs-comment" color="#6a737d">; return failure (already max or min)</span></span>
<a name="user-content-0817" href="#user-content-0817" color="#6e7781" class="line-number">$0817</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-cc__decrement"><a href="#user-content-cc__decrement" class="hljs-symbol" color="#e36209">cc__decrement</a>:</span>
<a name="user-content-0818" href="#user-content-0818" color="#6e7781" class="line-number">$0818</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DEC</span> <span class="hljs-variable language_" color="#d73a49">A</span></span>
<a name="user-content-0819" href="#user-content-0819" color="#6e7781" class="line-number">$0819</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <a href="#user-content-cc__set_and_return" class="hljs-variable" color="#005cc5">cc__set_and_return</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_apply_default_contrast"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Returns:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   A: contrast</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Clobbers: B</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_apply_default_contrast" class="hljs-symbol" color="#e36209">_apply_default_contrast</a>:</span>
<a name="user-content-081B" href="#user-content-081B" color="#6e7781" class="line-number">$081B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-apply_default_contrast1"><a href="#user-content-apply_default_contrast1" class="hljs-symbol" color="#e36209">apply_default_contrast1</a>:</span>
<a name="user-content-081C" href="#user-content-081C" color="#6e7781" class="line-number">$081C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-get_default_contrast" class="hljs-variable" color="#005cc5">get_default_contrast</a></span>
<a name="user-content-081F" href="#user-content-081F" color="#6e7781" class="line-number">$081F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <a href="#user-content-set_temp_contrast" class="hljs-variable" color="#005cc5">set_temp_contrast</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_get_default_contrast"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Returns:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   A: contrast</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_get_default_contrast" class="hljs-symbol" color="#e36209">_get_default_contrast</a>:</span>
<a name="user-content-0821" href="#user-content-0821" color="#6e7781" class="line-number">$0821</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-get_default_contrast"><a href="#user-content-get_default_contrast" class="hljs-symbol" color="#e36209">get_default_contrast</a>:</span>
<a name="user-content-0822" href="#user-content-0822" color="#6e7781" class="line-number">$0822</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0823" href="#user-content-0823" color="#6e7781" class="line-number">$0823</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0824" href="#user-content-0824" color="#6e7781" class="line-number">$0824</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-set_br" class="hljs-variable" color="#005cc5">set_br</a></span>
<a name="user-content-0827" href="#user-content-0827" color="#6e7781" class="line-number">$0827</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[BR:00h]</span></span>
<a name="user-content-0829" href="#user-content-0829" color="#6e7781" class="line-number">$0829</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">SRL</span> <span class="hljs-variable language_" color="#d73a49">A</span></span>
<a name="user-content-082B" href="#user-content-082B" color="#6e7781" class="line-number">$082B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">SRL</span> <span class="hljs-variable language_" color="#d73a49">A</span></span>
<a name="user-content-082D" href="#user-content-082D" color="#6e7781" class="line-number">$082D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-082E" href="#user-content-082E" color="#6e7781" class="line-number">$082E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-082F" href="#user-content-082F" color="#6e7781" class="line-number">$082F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_set_temp_contrast"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Arguments:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   A: new contrast, 0~63</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Clobbers: B</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_set_temp_contrast" class="hljs-symbol" color="#e36209">_set_temp_contrast</a>:</span>
<a name="user-content-0830" href="#user-content-0830" color="#6e7781" class="line-number">$0830</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-set_temp_contrast"><a href="#user-content-set_temp_contrast" class="hljs-symbol" color="#e36209">set_temp_contrast</a>:</span>
<a name="user-content-0831" href="#user-content-0831" color="#6e7781" class="line-number">$0831</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0832" href="#user-content-0832" color="#6e7781" class="line-number">$0832</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0833" href="#user-content-0833" color="#6e7781" class="line-number">$0833</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-set_br" class="hljs-variable" color="#005cc5">set_br</a></span>
<a name="user-content-0836" href="#user-content-0836" color="#6e7781" class="line-number">$0836</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span class="hljs-variable language_" color="#d73a49">A</span></span>
<a name="user-content-0837" href="#user-content-0837" color="#6e7781" class="line-number">$0837</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:80h]</span>, <span class="hljs-number" color="#005cc5">#08h</span>                  <span class="hljs-comment" color="#6a737d">; store whether or not LCD controller was enabled</span></span>
<a name="user-content-083A" href="#user-content-083A" color="#6e7781" class="line-number">$083A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">SC</span>                            <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-083C" href="#user-content-083C" color="#6e7781" class="line-number">$083C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:80h]</span>, <span class="hljs-number" color="#005cc5">#~08h</span>                 <span class="hljs-comment" color="#6a737d">; disable LCD controller</span></span>
<a name="user-content-083F" href="#user-content-083F" color="#6e7781" class="line-number">$083F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:0FEh]</span>, <span class="hljs-number" color="#005cc5">#81h</span>                  <span class="hljs-comment" color="#6a737d">; send contrast command</span></span>
<a name="user-content-0842" href="#user-content-0842" color="#6e7781" class="line-number">$0842</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:0FEh]</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                     <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0844" href="#user-content-0844" color="#6e7781" class="line-number">$0844</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                            <span class="hljs-comment" color="#6a737d">; if LCD controller was enabled,</span></span>
<a name="user-content-0846" href="#user-content-0846" color="#6e7781" class="line-number">$0846</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-stc__return" class="hljs-variable" color="#005cc5">stc__return</a></span>
<a name="user-content-0848" href="#user-content-0848" color="#6e7781" class="line-number">$0848</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:80h]</span>, <span class="hljs-number" color="#005cc5">#08h</span>                   <span class="hljs-comment" color="#6a737d">; re-enable it</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-stc__return"><a href="#user-content-stc__return" class="hljs-symbol" color="#e36209">stc__return</a>:</span>
<a name="user-content-084B" href="#user-content-084B" color="#6e7781" class="line-number">$084B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-084C" href="#user-content-084C" color="#6e7781" class="line-number">$084C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-084D" href="#user-content-084D" color="#6e7781" class="line-number">$084D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_lcd_on"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_lcd_on" class="hljs-symbol" color="#e36209">_lcd_on</a>:</span>
<a name="user-content-084E" href="#user-content-084E" color="#6e7781" class="line-number">$084E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<a name="user-content-084F" href="#user-content-084F" color="#6e7781" class="line-number">$084F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0850" href="#user-content-0850" color="#6e7781" class="line-number">$0850</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0851" href="#user-content-0851" color="#6e7781" class="line-number">$0851</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-set_br" class="hljs-variable" color="#005cc5">set_br</a></span>
<a name="user-content-0854" href="#user-content-0854" color="#6e7781" class="line-number">$0854</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <a href="#user-content-lcd_on" class="hljs-variable" color="#005cc5">lcd_on</a></span>
<a name="user-content-0856" href="#user-content-0856" color="#6e7781" class="line-number">$0856</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0857" href="#user-content-0857" color="#6e7781" class="line-number">$0857</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0858" href="#user-content-0858" color="#6e7781" class="line-number">$0858</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-lcd_on"><span class="hljs-comment" color="#6a737d">; Clobbers: BA</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-lcd_on" class="hljs-symbol" color="#e36209">lcd_on</a>:</span>
<a name="user-content-0859" href="#user-content-0859" color="#6e7781" class="line-number">$0859</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<a name="user-content-085A" href="#user-content-085A" color="#6e7781" class="line-number">$085A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-085C" href="#user-content-085C" color="#6e7781" class="line-number">$085C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#04h</span>                  <span class="hljs-comment" color="#6a737d">; ??</span></span>
<a name="user-content-085F" href="#user-content-085F" color="#6e7781" class="line-number">$085F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-lcdo__reset_02_bit4" class="hljs-variable" color="#005cc5">lcdo__reset_02_bit4</a></span>
<a name="user-content-0861" href="#user-content-0861" color="#6e7781" class="line-number">$0861</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#10h</span>                   <span class="hljs-comment" color="#6a737d">; ??</span></span>
<a name="user-content-0864" href="#user-content-0864" color="#6e7781" class="line-number">$0864</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <a href="#user-content-lcdo__return" class="hljs-variable" color="#005cc5">lcdo__return</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-lcdo__reset_02_bit4"><a href="#user-content-lcdo__reset_02_bit4" class="hljs-symbol" color="#e36209">lcdo__reset_02_bit4</a>:</span>
<a name="user-content-0866" href="#user-content-0866" color="#6e7781" class="line-number">$0866</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#~10h</span>                 <span class="hljs-comment" color="#6a737d">; ??</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-lcdo__return"><a href="#user-content-lcdo__return" class="hljs-symbol" color="#e36209">lcdo__return</a>:</span>
<a name="user-content-0869" href="#user-content-0869" color="#6e7781" class="line-number">$0869</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:81h]</span>, <span class="hljs-number" color="#005cc5">#01h</span>                   <span class="hljs-comment" color="#6a737d">; ??</span></span>
<a name="user-content-086C" href="#user-content-086C" color="#6e7781" class="line-number">$086C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">XOR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                            <span class="hljs-comment" color="#6a737d">; wait between power cfg and on commands</span></span>
<a name="user-content-086D" href="#user-content-086D" color="#6e7781" class="line-number">$086D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-init_display" class="hljs-variable" color="#005cc5">init_display</a></span>
<a name="user-content-0870" href="#user-content-0870" color="#6e7781" class="line-number">$0870</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_init_lcd"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Clobbers: BA</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_init_lcd" class="hljs-symbol" color="#e36209">_init_lcd</a>:</span>
<a name="user-content-0871" href="#user-content-0871" color="#6e7781" class="line-number">$0871</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<a name="user-content-0872" href="#user-content-0872" color="#6e7781" class="line-number">$0872</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0873" href="#user-content-0873" color="#6e7781" class="line-number">$0873</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0874" href="#user-content-0874" color="#6e7781" class="line-number">$0874</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-set_br" class="hljs-variable" color="#005cc5">set_br</a></span>
<a name="user-content-0877" href="#user-content-0877" color="#6e7781" class="line-number">$0877</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <a href="#user-content-init_display_without_wait" class="hljs-variable" color="#005cc5">init_display_without_wait</a></span>
<a name="user-content-0879" href="#user-content-0879" color="#6e7781" class="line-number">$0879</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-087A" href="#user-content-087A" color="#6e7781" class="line-number">$087A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-087B" href="#user-content-087B" color="#6e7781" class="line-number">$087B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-init_display_without_wait"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Clobbers: BA</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-init_display_without_wait" class="hljs-symbol" color="#e36209">init_display_without_wait</a>:</span>
<a name="user-content-087C" href="#user-content-087C" color="#6e7781" class="line-number">$087C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#0FFh</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-init_display"><span class="hljs-comment" color="#6a737d">; Arguments</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   A: 0 = wait, non-zero = don&#x27;t wait</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Clobbers: B</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-init_display" class="hljs-symbol" color="#e36209">init_display</a>:</span>
<a name="user-content-087E" href="#user-content-087E" color="#6e7781" class="line-number">$087E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">SC</span>                             <span class="hljs-comment" color="#6a737d">; back up SC</span></span>
<a name="user-content-087F" href="#user-content-087F" color="#6e7781" class="line-number">$087F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-0881" href="#user-content-0881" color="#6e7781" class="line-number">$0881</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:81h]</span>, <span class="hljs-number" color="#005cc5">#01h</span>                  <span class="hljs-comment" color="#6a737d">; ??</span></span>
<a name="user-content-0884" href="#user-content-0884" color="#6e7781" class="line-number">$0884</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-id__init" class="hljs-variable" color="#005cc5">id__init</a></span>
<a name="user-content-0886" href="#user-content-0886" color="#6e7781" class="line-number">$0886</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span>                               <span class="hljs-comment" color="#6a737d">; restore SC and return</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-id__init"><a href="#user-content-id__init" class="hljs-symbol" color="#e36209">id__init</a>:</span>
<a name="user-content-0887" href="#user-content-0887" color="#6e7781" class="line-number">$0887</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-0888" href="#user-content-0888" color="#6e7781" class="line-number">$0888</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">HL</span>, <span class="hljs-number" color="#005cc5">#20FEh</span>                       <span class="hljs-comment" color="#6a737d">; using [HL] is less bytes than [BR:ll] for all</span></span>
<a name="user-content-088B" href="#user-content-088B" color="#6e7781" class="line-number">$088B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span>[BR:80h]</span>                      <span class="hljs-comment" color="#6a737d">; back up LCD controller config</span></span>
<a name="user-content-088D" href="#user-content-088D" color="#6e7781" class="line-number">$088D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:80h]</span>, <span class="hljs-number" color="#005cc5">#~08h</span>                 <span class="hljs-comment" color="#6a737d">; disable LCD controller</span></span>
<a name="user-content-0890" href="#user-content-0890" color="#6e7781" class="line-number">$0890</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[HL]</span>, <span class="hljs-number" color="#005cc5">#0E3h</span>                      <span class="hljs-comment" color="#6a737d">; send NOP</span></span>
<a name="user-content-0892" href="#user-content-0892" color="#6e7781" class="line-number">$0892</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[HL]</span>, <span class="hljs-number" color="#005cc5">#0A4h</span>                      <span class="hljs-comment" color="#6a737d">; send &quot;set all on&quot; off</span></span>
<a name="user-content-0894" href="#user-content-0894" color="#6e7781" class="line-number">$0894</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[HL]</span>, <span class="hljs-number" color="#005cc5">#0ADh</span>                      <span class="hljs-comment" color="#6a737d">; send enable static indicator</span></span>
<a name="user-content-0896" href="#user-content-0896" color="#6e7781" class="line-number">$0896</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[HL]</span>, <span class="hljs-number" color="#005cc5">#02h</span>                       <span class="hljs-comment" color="#6a737d">; blink static indicator at half second intervals</span></span>
<a name="user-content-0898" href="#user-content-0898" color="#6e7781" class="line-number">$0898</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[HL]</span>, <span class="hljs-number" color="#005cc5">#0EEh</span>                      <span class="hljs-comment" color="#6a737d">; send RMW end</span></span>
<a name="user-content-089A" href="#user-content-089A" color="#6e7781" class="line-number">$089A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[HL]</span>, <span class="hljs-number" color="#005cc5">#40h</span>                       <span class="hljs-comment" color="#6a737d">; send set display start line 0</span></span>
<a name="user-content-089C" href="#user-content-089C" color="#6e7781" class="line-number">$089C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[HL]</span>, <span class="hljs-number" color="#005cc5">#0A2h</span>                      <span class="hljs-comment" color="#6a737d">; send LCD bias 1/9</span></span>
<a name="user-content-089E" href="#user-content-089E" color="#6e7781" class="line-number">$089E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[HL]</span>, <span class="hljs-number" color="#005cc5">#0A0h</span>                      <span class="hljs-comment" color="#6a737d">; send ADC select normal</span></span>
<a name="user-content-08A0" href="#user-content-08A0" color="#6e7781" class="line-number">$08A0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[HL]</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                      <span class="hljs-comment" color="#6a737d">; send row direction normal</span></span>
<a name="user-content-08A2" href="#user-content-08A2" color="#6e7781" class="line-number">$08A2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[HL]</span>, <span class="hljs-number" color="#005cc5">#0A6h</span>                      <span class="hljs-comment" color="#6a737d">; send color invert off</span></span>
<a name="user-content-08A4" href="#user-content-08A4" color="#6e7781" class="line-number">$08A4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[HL]</span>, <span class="hljs-number" color="#005cc5">#02Fh</span>                      <span class="hljs-comment" color="#6a737d">; send power supply circuits all on</span></span>
<a name="user-content-08A6" href="#user-content-08A6" color="#6e7781" class="line-number">$08A6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                             <span class="hljs-comment" color="#6a737d">; A=0 do wait, A0 don&#x27;t wait</span></span>
<a name="user-content-08A7" href="#user-content-08A7" color="#6e7781" class="line-number">$08A7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-loc_0x08C5" class="hljs-variable" color="#005cc5">loc_0x08C5</a></span>
<a name="user-content-08A9" href="#user-content-08A9" color="#6e7781" class="line-number">$08A9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">IX</span></span>
<a name="user-content-08AA" href="#user-content-08AA" color="#6e7781" class="line-number">$08AA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#08h</span>                  <span class="hljs-comment" color="#6a737d">; check what oscillator is clocking the CPU</span></span>
<a name="user-content-08AD" href="#user-content-08AD" color="#6e7781" class="line-number">$08AD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-id__using_hso" class="hljs-variable" color="#005cc5">id__using_hso</a></span>
<a name="user-content-08AF" href="#user-content-08AF" color="#6e7781" class="line-number">$08AF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#01h</span>                          <span class="hljs-comment" color="#6a737d">; wait 5711 cycles (from start of loop)</span></span>
<a name="user-content-08B1" href="#user-content-08B1" color="#6e7781" class="line-number">$08B1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-number" color="#005cc5">#0592h</span>                       <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-08B4" href="#user-content-08B4" color="#6e7781" class="line-number">$08B4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <a href="#user-content-id__wait_for_warmup" class="hljs-variable" color="#005cc5">id__wait_for_warmup</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-id__using_hso"><a href="#user-content-id__using_hso" class="hljs-symbol" color="#e36209">id__using_hso</a>:</span>
<a name="user-content-08B6" href="#user-content-08B6" color="#6e7781" class="line-number">$08B6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#02h</span>                          <span class="hljs-comment" color="#6a737d">; wait 349978 cycles (from start of loop)</span></span>
<a name="user-content-08B8" href="#user-content-08B8" color="#6e7781" class="line-number">$08B8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-number" color="#005cc5">#55C4h</span>                       <span class="hljs-comment" color="#6a737d">; ...</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-id__wait_for_warmup"><a href="#user-content-id__wait_for_warmup" class="hljs-symbol" color="#e36209">id__wait_for_warmup</a>:</span>
<a name="user-content-08BB" href="#user-content-08BB" color="#6e7781" class="line-number">$08BB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DEC</span> <span class="hljs-variable language_" color="#d73a49">IX</span></span>
<a name="user-content-08BC" href="#user-content-08BC" color="#6e7781" class="line-number">$08BC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-id__wait_for_warmup" class="hljs-variable" color="#005cc5">id__wait_for_warmup</a></span>
<a name="user-content-08BE" href="#user-content-08BE" color="#6e7781" class="line-number">$08BE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-number" color="#005cc5">#0FFFFh</span></span>
<a name="user-content-08C1" href="#user-content-08C1" color="#6e7781" class="line-number">$08C1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DEC</span> <span class="hljs-variable language_" color="#d73a49">A</span>                               <span class="hljs-comment" color="#6a737d">; exit at 0, so A=1 doesn&#x27;t do extra</span></span>
<a name="user-content-08C2" href="#user-content-08C2" color="#6e7781" class="line-number">$08C2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-id__wait_for_warmup" class="hljs-variable" color="#005cc5">id__wait_for_warmup</a></span>
<a name="user-content-08C4" href="#user-content-08C4" color="#6e7781" class="line-number">$08C4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">IX</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-loc_0x08C5"><a href="#user-content-loc_0x08C5" class="hljs-symbol" color="#e36209">loc_0x08C5</a>:</span>
<a name="user-content-08C5" href="#user-content-08C5" color="#6e7781" class="line-number">$08C5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[HL]</span>, <span class="hljs-number" color="#005cc5">#0AFh</span>                      <span class="hljs-comment" color="#6a737d">; send display on</span></span>
<a name="user-content-08C7" href="#user-content-08C7" color="#6e7781" class="line-number">$08C7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:80h]</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                      <span class="hljs-comment" color="#6a737d">; restore frame copy state</span></span>
<a name="user-content-08C9" href="#user-content-08C9" color="#6e7781" class="line-number">$08C9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-08CA" href="#user-content-08CA" color="#6e7781" class="line-number">$08CA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_lcd_off"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_lcd_off" class="hljs-symbol" color="#e36209">_lcd_off</a>:</span>
<a name="user-content-08CB" href="#user-content-08CB" color="#6e7781" class="line-number">$08CB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<a name="user-content-08CC" href="#user-content-08CC" color="#6e7781" class="line-number">$08CC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-08CD" href="#user-content-08CD" color="#6e7781" class="line-number">$08CD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-08CE" href="#user-content-08CE" color="#6e7781" class="line-number">$08CE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-set_br" class="hljs-variable" color="#005cc5">set_br</a></span>
<a name="user-content-08D1" href="#user-content-08D1" color="#6e7781" class="line-number">$08D1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <a href="#user-content-lcd_off" class="hljs-variable" color="#005cc5">lcd_off</a></span>
<a name="user-content-08D3" href="#user-content-08D3" color="#6e7781" class="line-number">$08D3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-08D4" href="#user-content-08D4" color="#6e7781" class="line-number">$08D4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-08D5" href="#user-content-08D5" color="#6e7781" class="line-number">$08D5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-lcd_off"><a href="#user-content-lcd_off" class="hljs-symbol" color="#e36209">lcd_off</a>:</span>
<a name="user-content-08D6" href="#user-content-08D6" color="#6e7781" class="line-number">$08D6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">SC</span>                             <span class="hljs-comment" color="#6a737d">; back up flags</span></span>
<a name="user-content-08D7" href="#user-content-08D7" color="#6e7781" class="line-number">$08D7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-08D9" href="#user-content-08D9" color="#6e7781" class="line-number">$08D9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:80h]</span>, <span class="hljs-number" color="#005cc5">#~08h</span>                 <span class="hljs-comment" color="#6a737d">; disable LCD controller</span></span>
<a name="user-content-08DC" href="#user-content-08DC" color="#6e7781" class="line-number">$08DC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:0FEh]</span>, <span class="hljs-number" color="#005cc5">#0AEh</span>                 <span class="hljs-comment" color="#6a737d">; send display off</span></span>
<a name="user-content-08DF" href="#user-content-08DF" color="#6e7781" class="line-number">$08DF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:0FEh]</span>, <span class="hljs-number" color="#005cc5">#0ACh</span>                 <span class="hljs-comment" color="#6a737d">; send static indicator off</span></span>
<a name="user-content-08E2" href="#user-content-08E2" color="#6e7781" class="line-number">$08E2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:0FEh]</span>, <span class="hljs-number" color="#005cc5">#28h</span>                  <span class="hljs-comment" color="#6a737d">; send power supply circuits all off</span></span>
<a name="user-content-08E5" href="#user-content-08E5" color="#6e7781" class="line-number">$08E5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:0FEh]</span>, <span class="hljs-number" color="#005cc5">#0A5h</span>                 <span class="hljs-comment" color="#6a737d">; send &quot;set all on&quot; on (enter _sleep mode)</span></span>
<a name="user-content-08E8" href="#user-content-08E8" color="#6e7781" class="line-number">$08E8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:81h]</span>, <span class="hljs-number" color="#005cc5">#~01h</span>                 <span class="hljs-comment" color="#6a737d">; ??</span></span>
<a name="user-content-08EB" href="#user-content-08EB" color="#6e7781" class="line-number">$08EB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span>                               <span class="hljs-comment" color="#6a737d">; restore flags</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_ena_ram_vec"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_ena_ram_vec" class="hljs-symbol" color="#e36209">_ena_ram_vec</a>:</span>
<a name="user-content-08EC" href="#user-content-08EC" color="#6e7781" class="line-number">$08EC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-08ED" href="#user-content-08ED" color="#6e7781" class="line-number">$08ED</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-08EE" href="#user-content-08EE" color="#6e7781" class="line-number">$08EE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-set_br" class="hljs-variable" color="#005cc5">set_br</a></span>
<a name="user-content-08F1" href="#user-content-08F1" color="#6e7781" class="line-number">$08F1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-08F3" href="#user-content-08F3" color="#6e7781" class="line-number">$08F3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#80h</span>                  <span class="hljs-comment" color="#6a737d">; if bit 7 is already set,</span></span>
<a name="user-content-08F6" href="#user-content-08F6" color="#6e7781" class="line-number">$08F6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-loc_0x0901" class="hljs-variable" color="#005cc5">loc_0x0901</a>                  <span class="hljs-comment" color="#6a737d">; skip</span></span>
<a name="user-content-08F8" href="#user-content-08F8" color="#6e7781" class="line-number">$08F8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#80h</span>                   <span class="hljs-comment" color="#6a737d">; otherwise set it</span></span>
<a name="user-content-08FB" href="#user-content-08FB" color="#6e7781" class="line-number">$08FB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#40h</span>                   <span class="hljs-comment" color="#6a737d">; and bit 6</span></span>
<a name="user-content-08FE" href="#user-content-08FE" color="#6e7781" class="line-number">$08FE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#~20h</span>                 <span class="hljs-comment" color="#6a737d">; and reset bit 5</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-loc_0x0901"><a href="#user-content-loc_0x0901" class="hljs-symbol" color="#e36209">loc_0x0901</a>:</span>
<a name="user-content-0901" href="#user-content-0901" color="#6e7781" class="line-number">$0901</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0902" href="#user-content-0902" color="#6e7781" class="line-number">$0902</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0903" href="#user-content-0903" color="#6e7781" class="line-number">$0903</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_dis_ram_vec"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_dis_ram_vec" class="hljs-symbol" color="#e36209">_dis_ram_vec</a>:</span>
<a name="user-content-0904" href="#user-content-0904" color="#6e7781" class="line-number">$0904</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0905" href="#user-content-0905" color="#6e7781" class="line-number">$0905</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0906" href="#user-content-0906" color="#6e7781" class="line-number">$0906</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-skip_if_01_not_bit6" class="hljs-variable" color="#005cc5">skip_if_01_not_bit6</a></span>
<a name="user-content-0909" href="#user-content-0909" color="#6e7781" class="line-number">$0909</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:55h]</span>, <span class="hljs-number" color="#005cc5">#01h</span></span>
<a name="user-content-090C" href="#user-content-090C" color="#6e7781" class="line-number">$090C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:51h]</span>, <span class="hljs-number" color="#005cc5">#~02h</span></span>
<a name="user-content-090F" href="#user-content-090F" color="#6e7781" class="line-number">$090F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-0911" href="#user-content-0911" color="#6e7781" class="line-number">$0911</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:21h]</span>, <span class="hljs-number" color="#005cc5">#30h</span></span>
<a name="user-content-0914" href="#user-content-0914" color="#6e7781" class="line-number">$0914</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:24h]</span>, <span class="hljs-number" color="#005cc5">#02h</span>                   <span class="hljs-comment" color="#6a737d">; enable cart eject IRQ</span></span>
<a name="user-content-0917" href="#user-content-0917" color="#6e7781" class="line-number">$0917</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-091A" href="#user-content-091A" color="#6e7781" class="line-number">$091A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#~40h</span></span>
<a name="user-content-091D" href="#user-content-091D" color="#6e7781" class="line-number">$091D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#~80h</span></span>
<a name="user-content-0920" href="#user-content-0920" color="#6e7781" class="line-number">$0920</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0921" href="#user-content-0921" color="#6e7781" class="line-number">$0921</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0922" href="#user-content-0922" color="#6e7781" class="line-number">$0922</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_disable_cart_eject_irq_if"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_disable_cart_eject_irq_if" class="hljs-symbol" color="#e36209">_disable_cart_eject_irq_if</a>:</span>
<a name="user-content-0923" href="#user-content-0923" color="#6e7781" class="line-number">$0923</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0924" href="#user-content-0924" color="#6e7781" class="line-number">$0924</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0925" href="#user-content-0925" color="#6e7781" class="line-number">$0925</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-skip_if_01_not_bit6" class="hljs-variable" color="#005cc5">skip_if_01_not_bit6</a></span>
<a name="user-content-0928" href="#user-content-0928" color="#6e7781" class="line-number">$0928</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:24h]</span>, <span class="hljs-number" color="#005cc5">#~02h</span>                 <span class="hljs-comment" color="#6a737d">; disable cart eject IRQ</span></span>
<a name="user-content-092B" href="#user-content-092B" color="#6e7781" class="line-number">$092B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-092C" href="#user-content-092C" color="#6e7781" class="line-number">$092C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-092D" href="#user-content-092D" color="#6e7781" class="line-number">$092D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_enable_cart_eject_irq_if"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_enable_cart_eject_irq_if" class="hljs-symbol" color="#e36209">_enable_cart_eject_irq_if</a>:</span>
<a name="user-content-092E" href="#user-content-092E" color="#6e7781" class="line-number">$092E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-092F" href="#user-content-092F" color="#6e7781" class="line-number">$092F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0930" href="#user-content-0930" color="#6e7781" class="line-number">$0930</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-skip_if_01_not_bit6" class="hljs-variable" color="#005cc5">skip_if_01_not_bit6</a></span>
<a name="user-content-0933" href="#user-content-0933" color="#6e7781" class="line-number">$0933</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:24h]</span>, <span class="hljs-number" color="#005cc5">#02h</span>                   <span class="hljs-comment" color="#6a737d">; enable cart eject IRQ</span></span>
<a name="user-content-0936" href="#user-content-0936" color="#6e7781" class="line-number">$0936</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0937" href="#user-content-0937" color="#6e7781" class="line-number">$0937</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0938" href="#user-content-0938" color="#6e7781" class="line-number">$0938</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-skip_if_01_not_bit6"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; MUST push EP, BR, SC (maybe from INT) before calling</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-skip_if_01_not_bit6" class="hljs-symbol" color="#e36209">skip_if_01_not_bit6</a>:</span>
<a name="user-content-0939" href="#user-content-0939" color="#6e7781" class="line-number">$0939</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-set_br" class="hljs-variable" color="#005cc5">set_br</a></span>
<a name="user-content-093C" href="#user-content-093C" color="#6e7781" class="line-number">$093C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#40h</span>                  <span class="hljs-comment" color="#6a737d">; if bit 6 is set,</span></span>
<a name="user-content-093F" href="#user-content-093F" color="#6e7781" class="line-number">$093F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-si__return" class="hljs-variable" color="#005cc5">si__return</a>                  <span class="hljs-comment" color="#6a737d">; just return</span></span>
<a name="user-content-0941" href="#user-content-0941" color="#6e7781" class="line-number">$0941</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">ADD</span> <span class="hljs-variable language_" color="#d73a49">SP</span>, <span class="hljs-number" color="#005cc5">#0003h</span>                      <span class="hljs-comment" color="#6a737d">; otherwise return back to caller&#x27;s caller</span></span>
<a name="user-content-0945" href="#user-content-0945" color="#6e7781" class="line-number">$0945</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span>                              <span class="hljs-comment" color="#6a737d">; and give BR/EP/SC back</span></span>
<a name="user-content-0946" href="#user-content-0946" color="#6e7781" class="line-number">$0946</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span>                              <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0947" href="#user-content-0947" color="#6e7781" class="line-number">$0947</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span>                               <span class="hljs-comment" color="#6a737d">; ...</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-si__return"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-si__return" class="hljs-symbol" color="#e36209">si__return</a>:</span>
<a name="user-content-0948" href="#user-content-0948" color="#6e7781" class="line-number">$0948</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_unknown_eject1"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_unknown_eject1" class="hljs-symbol" color="#e36209">_unknown_eject1</a>:</span>
<a name="user-content-0949" href="#user-content-0949" color="#6e7781" class="line-number">$0949</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-094A" href="#user-content-094A" color="#6e7781" class="line-number">$094A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-094B" href="#user-content-094B" color="#6e7781" class="line-number">$094B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-set_br" class="hljs-variable" color="#005cc5">set_br</a></span>
<a name="user-content-094E" href="#user-content-094E" color="#6e7781" class="line-number">$094E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-0950" href="#user-content-0950" color="#6e7781" class="line-number">$0950</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#80h</span>                  <span class="hljs-comment" color="#6a737d">; if bit 7 is set,</span></span>
<a name="user-content-0953" href="#user-content-0953" color="#6e7781" class="line-number">$0953</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-loc_0x095E" class="hljs-variable" color="#005cc5">loc_0x095E</a>                  <span class="hljs-comment" color="#6a737d">; just return</span></span>
<a name="user-content-0955" href="#user-content-0955" color="#6e7781" class="line-number">$0955</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:24h]</span>, <span class="hljs-number" color="#005cc5">#~02h</span>                 <span class="hljs-comment" color="#6a737d">; otherwise, disable cart eject IRQ</span></span>
<a name="user-content-0958" href="#user-content-0958" color="#6e7781" class="line-number">$0958</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#80h</span>                   <span class="hljs-comment" color="#6a737d">; set bit 7</span></span>
<a name="user-content-095B" href="#user-content-095B" color="#6e7781" class="line-number">$095B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#~20h</span>                 <span class="hljs-comment" color="#6a737d">; and reset bit 5</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-loc_0x095E"><a href="#user-content-loc_0x095E" class="hljs-symbol" color="#e36209">loc_0x095E</a>:</span>
<a name="user-content-095E" href="#user-content-095E" color="#6e7781" class="line-number">$095E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-095F" href="#user-content-095F" color="#6e7781" class="line-number">$095F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0960" href="#user-content-0960" color="#6e7781" class="line-number">$0960</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_unknown_eject2"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_unknown_eject2" class="hljs-symbol" color="#e36209">_unknown_eject2</a>:</span>
<a name="user-content-0961" href="#user-content-0961" color="#6e7781" class="line-number">$0961</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0962" href="#user-content-0962" color="#6e7781" class="line-number">$0962</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0963" href="#user-content-0963" color="#6e7781" class="line-number">$0963</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-skip_if_01_bit6_or_not_bit7" class="hljs-variable" color="#005cc5">skip_if_01_bit6_or_not_bit7</a></span>
<a name="user-content-0966" href="#user-content-0966" color="#6e7781" class="line-number">$0966</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:55h]</span>, <span class="hljs-number" color="#005cc5">#01h</span>                   <span class="hljs-comment" color="#6a737d">; set input level check time for ?? to 4ms?</span></span>
<a name="user-content-0969" href="#user-content-0969" color="#6e7781" class="line-number">$0969</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:51h]</span>, <span class="hljs-number" color="#005cc5">#~02h</span>                 <span class="hljs-comment" color="#6a737d">; set cart eject IRQ to rising edge (ejected)</span></span>
<a name="user-content-096C" href="#user-content-096C" color="#6e7781" class="line-number">$096C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-096E" href="#user-content-096E" color="#6e7781" class="line-number">$096E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:21h]</span>, <span class="hljs-number" color="#005cc5">#30h</span>                   <span class="hljs-comment" color="#6a737d">; set cartridge IRQs&#x27; priorities to 3</span></span>
<a name="user-content-0971" href="#user-content-0971" color="#6e7781" class="line-number">$0971</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:24h]</span>, <span class="hljs-number" color="#005cc5">#02h</span>                   <span class="hljs-comment" color="#6a737d">; enable cart eject IRQ</span></span>
<a name="user-content-0974" href="#user-content-0974" color="#6e7781" class="line-number">$0974</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#20h</span>                   <span class="hljs-comment" color="#6a737d">; set bit 5</span></span>
<a name="user-content-0977" href="#user-content-0977" color="#6e7781" class="line-number">$0977</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#~80h</span>                 <span class="hljs-comment" color="#6a737d">; reset bit 7</span></span>
<a name="user-content-097A" href="#user-content-097A" color="#6e7781" class="line-number">$097A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-097B" href="#user-content-097B" color="#6e7781" class="line-number">$097B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-097C" href="#user-content-097C" color="#6e7781" class="line-number">$097C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_dev_card0"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Similar to prepare_selected_game but:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   Conditional execution.</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   Does not assume cart is inserted or powered.</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   Check startup action instead of $2001.3~0 being 0b0xx1.</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   Ensures the game struct in ROM is valid.</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; When this returns 0, it leaves the cart powered.</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Returns:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   A:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;     0 = banks perpared</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;     1 = no cart inserted</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;     2 = error:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;           unexpected game ID in $2001</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;           expected game ID in $2001</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;           selected game ID has no valid entry in ROM</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Clobbers: B, XP</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_dev_card0" class="hljs-symbol" color="#e36209">_dev_card0</a>:</span>
<a name="user-content-097D" href="#user-content-097D" color="#6e7781" class="line-number">$097D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-097E" href="#user-content-097E" color="#6e7781" class="line-number">$097E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-097F" href="#user-content-097F" color="#6e7781" class="line-number">$097F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-0981" href="#user-content-0981" color="#6e7781" class="line-number">$0981</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-skip_if_01_bit6_or_not_bit7" class="hljs-variable" color="#005cc5">skip_if_01_bit6_or_not_bit7</a></span>
<a name="user-content-0984" href="#user-content-0984" color="#6e7781" class="line-number">$0984</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">IX</span></span>
<a name="user-content-0985" href="#user-content-0985" color="#6e7781" class="line-number">$0985</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-0986" href="#user-content-0986" color="#6e7781" class="line-number">$0986</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:53h]</span>, <span class="hljs-number" color="#005cc5">#02h</span>                  <span class="hljs-comment" color="#6a737d">; if cart is inserted,</span></span>
<a name="user-content-0989" href="#user-content-0989" color="#6e7781" class="line-number">$0989</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-dc0__cart_inserted" class="hljs-variable" color="#005cc5">dc0__cart_inserted</a>           <span class="hljs-comment" color="#6a737d">; continue</span></span>
<a name="user-content-098B" href="#user-content-098B" color="#6e7781" class="line-number">$098B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#01h</span>                          <span class="hljs-comment" color="#6a737d">; otherwise, return 1</span></span>
<a name="user-content-098D" href="#user-content-098D" color="#6e7781" class="line-number">$098D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <a href="#user-content-dc0__return1" class="hljs-variable" color="#005cc5">dc0__return1</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-dc0__cart_inserted"><a href="#user-content-dc0__cart_inserted" class="hljs-symbol" color="#e36209">dc0__cart_inserted</a>:</span>
<a name="user-content-098F" href="#user-content-098F" color="#6e7781" class="line-number">$098F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span>[BR:80h]</span>                      <span class="hljs-comment" color="#6a737d">; back up LCD controller settings</span></span>
<a name="user-content-0991" href="#user-content-0991" color="#6e7781" class="line-number">$0991</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:80h]</span>, <span class="hljs-number" color="#005cc5">#00h</span>                   <span class="hljs-comment" color="#6a737d">; disable LCD controller</span></span>
<a name="user-content-0994" href="#user-content-0994" color="#6e7781" class="line-number">$0994</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[BR:71h]</span>                      <span class="hljs-comment" color="#6a737d">; back up cart power/volume</span></span>
<a name="user-content-0996" href="#user-content-0996" color="#6e7781" class="line-number">$0996</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BA</span>                             <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0997" href="#user-content-0997" color="#6e7781" class="line-number">$0997</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-power_cart" class="hljs-variable" color="#005cc5">power_cart</a></span>
<a name="user-content-099A" href="#user-content-099A" color="#6e7781" class="line-number">$099A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-wait_8000_cycles" class="hljs-variable" color="#005cc5">wait_8000_cycles</a></span>
<a name="user-content-099D" href="#user-content-099D" color="#6e7781" class="line-number">$099D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:28h]</span>, <span class="hljs-number" color="#005cc5">#02h</span>                   <span class="hljs-comment" color="#6a737d">; clear cart eject IRQ</span></span>
<a name="user-content-09A0" href="#user-content-09A0" color="#6e7781" class="line-number">$09A0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-select_boot" class="hljs-variable" color="#005cc5">select_boot</a></span>
<a name="user-content-09A3" href="#user-content-09A3" color="#6e7781" class="line-number">$09A3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-dc0__verify_selected_game" class="hljs-variable" color="#005cc5">dc0__verify_selected_game</a>   <span class="hljs-comment" color="#6a737d">; 0 = banks were selected (or didn&#x27;t need to be)</span></span>
<a name="user-content-09A5" href="#user-content-09A5" color="#6e7781" class="line-number">$09A5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#08h</span>                  <span class="hljs-comment" color="#6a737d">; we don&#x27;t expect a valid game index in this case so,</span></span>
<a name="user-content-09A8" href="#user-content-09A8" color="#6e7781" class="line-number">$09A8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-dc0__return3" class="hljs-variable" color="#005cc5">dc0__return3</a>                <span class="hljs-comment" color="#6a737d">; return 2</span></span>
<a name="user-content-09AA" href="#user-content-09AA" color="#6e7781" class="line-number">$09AA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <a href="#user-content-dc0__leave_powered" class="hljs-variable" color="#005cc5">dc0__leave_powered</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-dc0__verify_selected_game"><a href="#user-content-dc0__verify_selected_game" class="hljs-symbol" color="#e36209">dc0__verify_selected_game</a>:</span>
<a name="user-content-09AC" href="#user-content-09AC" color="#6e7781" class="line-number">$09AC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#08h</span>                  <span class="hljs-comment" color="#6a737d">; if bits 2~0 don&#x27;t contain a game index,</span></span>
<a name="user-content-09AF" href="#user-content-09AF" color="#6e7781" class="line-number">$09AF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-dc0__return3" class="hljs-variable" color="#005cc5">dc0__return3</a>                 <span class="hljs-comment" color="#6a737d">; return 2</span></span>
<a name="user-content-09B1" href="#user-content-09B1" color="#6e7781" class="line-number">$09B1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[BR:01h]</span>                      <span class="hljs-comment" color="#6a737d">; otherwise, load the game index</span></span>
<a name="user-content-09B3" href="#user-content-09B3" color="#6e7781" class="line-number">$09B3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#07h</span>                         <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-09B5" href="#user-content-09B5" color="#6e7781" class="line-number">$09B5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">L</span>, <span class="hljs-number" color="#005cc5">#60h</span>                          <span class="hljs-comment" color="#6a737d">; size of a game struct</span></span>
<a name="user-content-09B7" href="#user-content-09B7" color="#6e7781" class="line-number">$09B7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">MLT</span>                                <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-09B9" href="#user-content-09B9" color="#6e7781" class="line-number">$09B9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-number" color="#005cc5">#1050h</span>                       <span class="hljs-comment" color="#6a737d">; read from $041050 + 96 * ?</span></span>
<a name="user-content-09BC" href="#user-content-09BC" color="#6e7781" class="line-number">$09BC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">ADD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-variable language_" color="#d73a49">HL</span>                          <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-09BE" href="#user-content-09BE" color="#6e7781" class="line-number">$09BE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">IP</span>                             <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-09BF" href="#user-content-09BF" color="#6e7781" class="line-number">$09BF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">XP</span>, <span class="hljs-number" color="#005cc5">#04h</span>                         <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-09C2" href="#user-content-09C2" color="#6e7781" class="line-number">$09C2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span>[IX]</span>                          <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-09C3" href="#user-content-09C3" color="#6e7781" class="line-number">$09C3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">IP</span>                              <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-09C4" href="#user-content-09C4" color="#6e7781" class="line-number">$09C4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span class="hljs-number" color="#005cc5">#00h</span>                          <span class="hljs-comment" color="#6a737d">; if it&#x27;s 0 (empty),</span></span>
<a name="user-content-09C7" href="#user-content-09C7" color="#6e7781" class="line-number">$09C7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-dc0__return3" class="hljs-variable" color="#005cc5">dc0__return3</a>                 <span class="hljs-comment" color="#6a737d">; return 2</span></span>
<a name="user-content-09C9" href="#user-content-09C9" color="#6e7781" class="line-number">$09C9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span class="hljs-number" color="#005cc5">#0FFh</span>                         <span class="hljs-comment" color="#6a737d">; if it&#x27;s 0xff (erased),</span></span>
<a name="user-content-09CC" href="#user-content-09CC" color="#6e7781" class="line-number">$09CC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-dc0__return3" class="hljs-variable" color="#005cc5">dc0__return3</a>                 <span class="hljs-comment" color="#6a737d">; return 2</span></span>
<a name="user-content-09CE" href="#user-content-09CE" color="#6e7781" class="line-number">$09CE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-flash_prepare_game" class="hljs-variable" color="#005cc5">flash_prepare_game</a>             <span class="hljs-comment" color="#6a737d">; otherwise select game in A</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-dc0__leave_powered"><a href="#user-content-dc0__leave_powered" class="hljs-symbol" color="#e36209">dc0__leave_powered</a>:</span>
<a name="user-content-09D1" href="#user-content-09D1" color="#6e7781" class="line-number">$09D1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#40h</span>                   <span class="hljs-comment" color="#6a737d">; ??</span></span>
<a name="user-content-09D4" href="#user-content-09D4" color="#6e7781" class="line-number">$09D4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BA</span></span>
<a name="user-content-09D5" href="#user-content-09D5" color="#6e7781" class="line-number">$09D5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">XOR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                            <span class="hljs-comment" color="#6a737d">; return 0</span></span>
<a name="user-content-09D6" href="#user-content-09D6" color="#6e7781" class="line-number">$09D6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <a href="#user-content-dc0__return2" class="hljs-variable" color="#005cc5">dc0__return2</a>                    <span class="hljs-comment" color="#6a737d">; leave cart powered</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-dc0__return3"><a href="#user-content-dc0__return3" class="hljs-symbol" color="#e36209">dc0__return3</a>:</span>
<a name="user-content-09D8" href="#user-content-09D8" color="#6e7781" class="line-number">$09D8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BA</span></span>
<a name="user-content-09D9" href="#user-content-09D9" color="#6e7781" class="line-number">$09D9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:71h]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                      <span class="hljs-comment" color="#6a737d">; restore cart power/volume</span></span>
<a name="user-content-09DB" href="#user-content-09DB" color="#6e7781" class="line-number">$09DB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#02h</span>                          <span class="hljs-comment" color="#6a737d">; return 2</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-dc0__return2"><a href="#user-content-dc0__return2" class="hljs-symbol" color="#e36209">dc0__return2</a>:</span>
<a name="user-content-09DD" href="#user-content-09DD" color="#6e7781" class="line-number">$09DD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:80h]</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                      <span class="hljs-comment" color="#6a737d">; restore LCD controller settings</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-dc0__return1"><a href="#user-content-dc0__return1" class="hljs-symbol" color="#e36209">dc0__return1</a>:</span>
<a name="user-content-09DF" href="#user-content-09DF" color="#6e7781" class="line-number">$09DF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-09E0" href="#user-content-09E0" color="#6e7781" class="line-number">$09E0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">IX</span></span>
<a name="user-content-09E1" href="#user-content-09E1" color="#6e7781" class="line-number">$09E1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-09E2" href="#user-content-09E2" color="#6e7781" class="line-number">$09E2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-09E3" href="#user-content-09E3" color="#6e7781" class="line-number">$09E3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_dev_card1"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Prepares bank selections only if cart is inserted</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; and startup action is 0/2 (or not a dev cart).</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Powers on cart if one&#x27;s inserted.</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Clobbers: BA, XP</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_dev_card1" class="hljs-symbol" color="#e36209">_dev_card1</a>:</span>
<a name="user-content-09E4" href="#user-content-09E4" color="#6e7781" class="line-number">$09E4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-09E5" href="#user-content-09E5" color="#6e7781" class="line-number">$09E5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-09E6" href="#user-content-09E6" color="#6e7781" class="line-number">$09E6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-09E8" href="#user-content-09E8" color="#6e7781" class="line-number">$09E8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-skip_if_01_bit6_or_not_bit7" class="hljs-variable" color="#005cc5">skip_if_01_bit6_or_not_bit7</a></span>
<a name="user-content-09EB" href="#user-content-09EB" color="#6e7781" class="line-number">$09EB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span>[BR:80h]</span>                      <span class="hljs-comment" color="#6a737d">; back up LCD controller config</span></span>
<a name="user-content-09ED" href="#user-content-09ED" color="#6e7781" class="line-number">$09ED</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:80h]</span>, <span class="hljs-number" color="#005cc5">#00h</span>                   <span class="hljs-comment" color="#6a737d">; disable LCD controller</span></span>
<a name="user-content-09F0" href="#user-content-09F0" color="#6e7781" class="line-number">$09F0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">B</span></span>
<a name="user-content-09F2" href="#user-content-09F2" color="#6e7781" class="line-number">$09F2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">IX</span></span>
<a name="user-content-09F3" href="#user-content-09F3" color="#6e7781" class="line-number">$09F3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-09F4" href="#user-content-09F4" color="#6e7781" class="line-number">$09F4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:53h]</span>, <span class="hljs-number" color="#005cc5">#02h</span>                  <span class="hljs-comment" color="#6a737d">; if cart is inserted,</span></span>
<a name="user-content-09F7" href="#user-content-09F7" color="#6e7781" class="line-number">$09F7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-dc1__prepare_autoboot_only" class="hljs-variable" color="#005cc5">dc1__prepare_autoboot_only</a>   <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-09F9" href="#user-content-09F9" color="#6e7781" class="line-number">$09F9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#01h</span>                          <span class="hljs-comment" color="#6a737d">; otherwise return 1</span></span>
<a name="user-content-09FB" href="#user-content-09FB" color="#6e7781" class="line-number">$09FB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <a href="#user-content-dc1__return" class="hljs-variable" color="#005cc5">dc1__return</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-dc1__prepare_autoboot_only"><a href="#user-content-dc1__prepare_autoboot_only" class="hljs-symbol" color="#e36209">dc1__prepare_autoboot_only</a>:</span>
<a name="user-content-09FD" href="#user-content-09FD" color="#6e7781" class="line-number">$09FD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-cart_slot_on" class="hljs-variable" color="#005cc5">cart_slot_on</a></span>
<a name="user-content-0A00" href="#user-content-0A00" color="#6e7781" class="line-number">$0A00</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-select_boot" class="hljs-variable" color="#005cc5">select_boot</a></span>
<a name="user-content-0A03" href="#user-content-0A03" color="#6e7781" class="line-number">$0A03</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-dc1__return" class="hljs-variable" color="#005cc5">dc1__return</a>                  <span class="hljs-comment" color="#6a737d">; done selecting banks, so return</span></span>
<a name="user-content-0A05" href="#user-content-0A05" color="#6e7781" class="line-number">$0A05</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">IP</span></span>
<a name="user-content-0A06" href="#user-content-0A06" color="#6e7781" class="line-number">$0A06</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">XP</span>, <span class="hljs-number" color="#005cc5">#07h</span>                         <span class="hljs-comment" color="#6a737d">; set external page 1 to load bank 1</span></span>
<a name="user-content-0A09" href="#user-content-0A09" color="#6e7781" class="line-number">$0A09</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#01h</span>                          <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0A0B" href="#user-content-0A0B" color="#6e7781" class="line-number">$0A0B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-flash_select_bank" class="hljs-variable" color="#005cc5">flash_select_bank</a>              <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0A0E" href="#user-content-0A0E" color="#6e7781" class="line-number">$0A0E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">IP</span></span>
<a name="user-content-0A0F" href="#user-content-0A0F" color="#6e7781" class="line-number">$0A0F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#0FFh</span>                         <span class="hljs-comment" color="#6a737d">; return -1</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-dc1__return"><a href="#user-content-dc1__return" class="hljs-symbol" color="#e36209">dc1__return</a>:</span>
<a name="user-content-0A11" href="#user-content-0A11" color="#6e7781" class="line-number">$0A11</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-0A12" href="#user-content-0A12" color="#6e7781" class="line-number">$0A12</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">IX</span></span>
<a name="user-content-0A13" href="#user-content-0A13" color="#6e7781" class="line-number">$0A13</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">B</span></span>
<a name="user-content-0A15" href="#user-content-0A15" color="#6e7781" class="line-number">$0A15</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:80h]</span>, <span class="hljs-variable language_" color="#d73a49">B</span></span>
<a name="user-content-0A17" href="#user-content-0A17" color="#6e7781" class="line-number">$0A17</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0A18" href="#user-content-0A18" color="#6e7781" class="line-number">$0A18</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0A19" href="#user-content-0A19" color="#6e7781" class="line-number">$0A19</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-skip_if_01_bit6_or_not_bit7"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; MUST push EP, BR, SC (maybe from INT) before calling</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-skip_if_01_bit6_or_not_bit7" class="hljs-symbol" color="#e36209">skip_if_01_bit6_or_not_bit7</a>:</span>
<a name="user-content-0A1A" href="#user-content-0A1A" color="#6e7781" class="line-number">$0A1A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-set_br" class="hljs-variable" color="#005cc5">set_br</a></span>
<a name="user-content-0A1D" href="#user-content-0A1D" color="#6e7781" class="line-number">$0A1D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#80h</span>                  <span class="hljs-comment" color="#6a737d">; if bit 7 is 0,</span></span>
<a name="user-content-0A20" href="#user-content-0A20" color="#6e7781" class="line-number">$0A20</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-si2__do_skip" class="hljs-variable" color="#005cc5">si2__do_skip</a>                 <span class="hljs-comment" color="#6a737d">; perform skip</span></span>
<a name="user-content-0A22" href="#user-content-0A22" color="#6e7781" class="line-number">$0A22</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#40h</span>                  <span class="hljs-comment" color="#6a737d">; if bit 6 is 0,</span></span>
<a name="user-content-0A25" href="#user-content-0A25" color="#6e7781" class="line-number">$0A25</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-si2__return" class="hljs-variable" color="#005cc5">si2__return</a>                  <span class="hljs-comment" color="#6a737d">; don&#x27;t skip</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-si2__do_skip"><a href="#user-content-si2__do_skip" class="hljs-symbol" color="#e36209">si2__do_skip</a>:</span>
<a name="user-content-0A27" href="#user-content-0A27" color="#6e7781" class="line-number">$0A27</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">ADD</span> <span class="hljs-variable language_" color="#d73a49">SP</span>, <span class="hljs-number" color="#005cc5">#0003h</span></span>
<a name="user-content-0A2B" href="#user-content-0A2B" color="#6e7781" class="line-number">$0A2B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0A2C" href="#user-content-0A2C" color="#6e7781" class="line-number">$0A2C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0A2D" href="#user-content-0A2D" color="#6e7781" class="line-number">$0A2D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-si2__return"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-si2__return" class="hljs-symbol" color="#e36209">si2__return</a>:</span>
<a name="user-content-0A2E" href="#user-content-0A2E" color="#6e7781" class="line-number">$0A2E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-select_boot"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; If the startup action bit 0 is 0, prepare game 0.</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Otherwise, do further checks.</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Returns:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   Z: 0 = ready to boot, 1 = do more checks</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Clobbers: A, XP, IX</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-select_boot" class="hljs-symbol" color="#e36209">select_boot</a>:</span>
<a name="user-content-0A2F" href="#user-content-0A2F" color="#6e7781" class="line-number">$0A2F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-flash_detect" class="hljs-variable" color="#005cc5">flash_detect</a></span>
<a name="user-content-0A32" href="#user-content-0A32" color="#6e7781" class="line-number">$0A32</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-sb__return_fail" class="hljs-variable" color="#005cc5">sb__return_fail</a>             <span class="hljs-comment" color="#6a737d">; if it&#x27;s not a flash cart</span></span>
<a name="user-content-0A34" href="#user-content-0A34" color="#6e7781" class="line-number">$0A34</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">IP</span></span>
<a name="user-content-0A35" href="#user-content-0A35" color="#6e7781" class="line-number">$0A35</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">XP</span>, <span class="hljs-number" color="#005cc5">#07h</span>                         <span class="hljs-comment" color="#6a737d">; bank register</span></span>
<a name="user-content-0A38" href="#user-content-0A38" color="#6e7781" class="line-number">$0A38</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#00h</span>                          <span class="hljs-comment" color="#6a737d">; value to write</span></span>
<a name="user-content-0A3A" href="#user-content-0A3A" color="#6e7781" class="line-number">$0A3A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-flash_select_bank" class="hljs-variable" color="#005cc5">flash_select_bank</a></span>
<a name="user-content-0A3D" href="#user-content-0A3D" color="#6e7781" class="line-number">$0A3D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">XP</span>, <span class="hljs-number" color="#005cc5">#04h</span>                         <span class="hljs-comment" color="#6a737d">; read startup action</span></span>
<a name="user-content-0A40" href="#user-content-0A40" color="#6e7781" class="line-number">$0A40</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-number" color="#005cc5">#1300h</span>                       <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0A43" href="#user-content-0A43" color="#6e7781" class="line-number">$0A43</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[IX]</span>                          <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0A44" href="#user-content-0A44" color="#6e7781" class="line-number">$0A44</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">IP</span></span>
<a name="user-content-0A45" href="#user-content-0A45" color="#6e7781" class="line-number">$0A45</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#01h</span>                         <span class="hljs-comment" color="#6a737d">; if it&#x27;s 0,</span></span>
<a name="user-content-0A47" href="#user-content-0A47" color="#6e7781" class="line-number">$0A47</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-sb__return" class="hljs-variable" color="#005cc5">sb__return</a></span>
<a name="user-content-0A49" href="#user-content-0A49" color="#6e7781" class="line-number">$0A49</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">XOR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                            <span class="hljs-comment" color="#6a737d">; start the first game automatically</span></span>
<a name="user-content-0A4A" href="#user-content-0A4A" color="#6e7781" class="line-number">$0A4A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-flash_prepare_game" class="hljs-variable" color="#005cc5">flash_prepare_game</a>             <span class="hljs-comment" color="#6a737d">; ...</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-sb__return_fail"><a href="#user-content-sb__return_fail" class="hljs-symbol" color="#e36209">sb__return_fail</a>:</span>
<a name="user-content-0A4D" href="#user-content-0A4D" color="#6e7781" class="line-number">$0A4D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">XOR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                            <span class="hljs-comment" color="#6a737d">; fail out</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-sb__return"><a href="#user-content-sb__return" class="hljs-symbol" color="#e36209">sb__return</a>:</span>
<a name="user-content-0A4E" href="#user-content-0A4E" color="#6e7781" class="line-number">$0A4E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_enable_cart_eject_irq"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Arguments:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   A: cart eject IRQ priority</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Clobbers: B</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_enable_cart_eject_irq" class="hljs-symbol" color="#e36209">_enable_cart_eject_irq</a>:</span>
<a name="user-content-0A4F" href="#user-content-0A4F" color="#6e7781" class="line-number">$0A4F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<a name="user-content-0A50" href="#user-content-0A50" color="#6e7781" class="line-number">$0A50</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0A51" href="#user-content-0A51" color="#6e7781" class="line-number">$0A51</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0A52" href="#user-content-0A52" color="#6e7781" class="line-number">$0A52</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-set_br" class="hljs-variable" color="#005cc5">set_br</a></span>
<a name="user-content-0A55" href="#user-content-0A55" color="#6e7781" class="line-number">$0A55</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">SWAP</span> <span class="hljs-variable language_" color="#d73a49">A</span></span>
<a name="user-content-0A56" href="#user-content-0A56" color="#6e7781" class="line-number">$0A56</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#30h</span></span>
<a name="user-content-0A58" href="#user-content-0A58" color="#6e7781" class="line-number">$0A58</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<a name="user-content-0A59" href="#user-content-0A59" color="#6e7781" class="line-number">$0A59</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-0A5B" href="#user-content-0A5B" color="#6e7781" class="line-number">$0A5B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span>[BR:21h]</span>                      <span class="hljs-comment" color="#6a737d">; get IRQ priorities</span></span>
<a name="user-content-0A5D" href="#user-content-0A5D" color="#6e7781" class="line-number">$0A5D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span class="hljs-number" color="#005cc5">#0CFh</span>                        <span class="hljs-comment" color="#6a737d">; clear cart eject&#x27;s</span></span>
<a name="user-content-0A60" href="#user-content-0A60" color="#6e7781" class="line-number">$0A60</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                             <span class="hljs-comment" color="#6a737d">; set it to value in A</span></span>
<a name="user-content-0A61" href="#user-content-0A61" color="#6e7781" class="line-number">$0A61</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:21h]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                      <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0A63" href="#user-content-0A63" color="#6e7781" class="line-number">$0A63</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<a name="user-content-0A64" href="#user-content-0A64" color="#6e7781" class="line-number">$0A64</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:55h]</span>, <span class="hljs-number" color="#005cc5">#01h</span>                   <span class="hljs-comment" color="#6a737d">; set input level check time for ?? to 4ms?</span></span>
<a name="user-content-0A67" href="#user-content-0A67" color="#6e7781" class="line-number">$0A67</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:51h]</span>, <span class="hljs-number" color="#005cc5">#~02h</span>                 <span class="hljs-comment" color="#6a737d">; set cart eject IRQ to rising edge (ejected)</span></span>
<a name="user-content-0A6A" href="#user-content-0A6A" color="#6e7781" class="line-number">$0A6A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-wait_8000_cycles" class="hljs-variable" color="#005cc5">wait_8000_cycles</a></span>
<a name="user-content-0A6D" href="#user-content-0A6D" color="#6e7781" class="line-number">$0A6D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:28h]</span>, <span class="hljs-number" color="#005cc5">#02h</span>                   <span class="hljs-comment" color="#6a737d">; clear cart eject</span></span>
<a name="user-content-0A70" href="#user-content-0A70" color="#6e7781" class="line-number">$0A70</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:24h]</span>, <span class="hljs-number" color="#005cc5">#02h</span>                   <span class="hljs-comment" color="#6a737d">; enable cart eject IRQ</span></span>
<a name="user-content-0A73" href="#user-content-0A73" color="#6e7781" class="line-number">$0A73</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0A74" href="#user-content-0A74" color="#6e7781" class="line-number">$0A74</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0A75" href="#user-content-0A75" color="#6e7781" class="line-number">$0A75</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_disable_cart_eject_irq"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_disable_cart_eject_irq" class="hljs-symbol" color="#e36209">_disable_cart_eject_irq</a>:</span>
<a name="user-content-0A76" href="#user-content-0A76" color="#6e7781" class="line-number">$0A76</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0A77" href="#user-content-0A77" color="#6e7781" class="line-number">$0A77</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0A78" href="#user-content-0A78" color="#6e7781" class="line-number">$0A78</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-set_br" class="hljs-variable" color="#005cc5">set_br</a></span>
<a name="user-content-0A7B" href="#user-content-0A7B" color="#6e7781" class="line-number">$0A7B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:24h]</span>, <span class="hljs-number" color="#005cc5">#~02h</span>                 <span class="hljs-comment" color="#6a737d">; disable cart eject IRQ</span></span>
<a name="user-content-0A7E" href="#user-content-0A7E" color="#6e7781" class="line-number">$0A7E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0A7F" href="#user-content-0A7F" color="#6e7781" class="line-number">$0A7F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0A80" href="#user-content-0A80" color="#6e7781" class="line-number">$0A80</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_unknown_eject4"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_unknown_eject4" class="hljs-symbol" color="#e36209">_unknown_eject4</a>:</span>
<a name="user-content-0A81" href="#user-content-0A81" color="#6e7781" class="line-number">$0A81</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<a name="user-content-0A82" href="#user-content-0A82" color="#6e7781" class="line-number">$0A82</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0A83" href="#user-content-0A83" color="#6e7781" class="line-number">$0A83</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0A84" href="#user-content-0A84" color="#6e7781" class="line-number">$0A84</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BA</span></span>
<a name="user-content-0A85" href="#user-content-0A85" color="#6e7781" class="line-number">$0A85</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-set_br" class="hljs-variable" color="#005cc5">set_br</a></span>
<a name="user-content-0A88" href="#user-content-0A88" color="#6e7781" class="line-number">$0A88</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">SC</span>                            <span class="hljs-comment" color="#6a737d">; get C and Z</span></span>
<a name="user-content-0A8A" href="#user-content-0A8A" color="#6e7781" class="line-number">$0A8A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">SRL</span> <span class="hljs-variable language_" color="#d73a49">A</span>                               <span class="hljs-comment" color="#6a737d">; ...shift to top two bits</span></span>
<a name="user-content-0A8C" href="#user-content-0A8C" color="#6e7781" class="line-number">$0A8C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">SRL</span> <span class="hljs-variable language_" color="#d73a49">A</span>                               <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0A8E" href="#user-content-0A8E" color="#6e7781" class="line-number">$0A8E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#30h</span>                         <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0A90" href="#user-content-0A90" color="#6e7781" class="line-number">$0A90</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span>[BR:21h]</span>                      <span class="hljs-comment" color="#6a737d">; compare with clock timer IRQs&#x27; priority</span></span>
<a name="user-content-0A92" href="#user-content-0A92" color="#6e7781" class="line-number">$0A92</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span class="hljs-number" color="#005cc5">#30h</span>                         <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0A95" href="#user-content-0A95" color="#6e7781" class="line-number">$0A95</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                             <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0A96" href="#user-content-0A96" color="#6e7781" class="line-number">$0A96</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">XOR</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#01h</span>                        <span class="hljs-comment" color="#6a737d">; invert Z, so 0 = not equal</span></span>
<a name="user-content-0A98" href="#user-content-0A98" color="#6e7781" class="line-number">$0A98</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-loc_0x0AA2" class="hljs-variable" color="#005cc5">loc_0x0AA2</a>                   <span class="hljs-comment" color="#6a737d">; return if they&#x27;re not equal</span></span>
<a name="user-content-0A9A" href="#user-content-0A9A" color="#6e7781" class="line-number">$0A9A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:28h]</span>, <span class="hljs-number" color="#005cc5">#02h</span>                  <span class="hljs-comment" color="#6a737d">; check if cart eject fired</span></span>
<a name="user-content-0A9D" href="#user-content-0A9D" color="#6e7781" class="line-number">$0A9D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-loc_0x0AA2" class="hljs-variable" color="#005cc5">loc_0x0AA2</a>                   <span class="hljs-comment" color="#6a737d">; if not, return</span></span>
<a name="user-content-0A9F" href="#user-content-0A9F" color="#6e7781" class="line-number">$0A9F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:28h]</span>, <span class="hljs-number" color="#005cc5">#02h</span>                   <span class="hljs-comment" color="#6a737d">; if so, clear</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-loc_0x0AA2"><a href="#user-content-loc_0x0AA2" class="hljs-symbol" color="#e36209">loc_0x0AA2</a>:</span>
<a name="user-content-0AA2" href="#user-content-0AA2" color="#6e7781" class="line-number">$0AA2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BA</span></span>
<a name="user-content-0AA3" href="#user-content-0AA3" color="#6e7781" class="line-number">$0AA3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0AA4" href="#user-content-0AA4" color="#6e7781" class="line-number">$0AA4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0AA5" href="#user-content-0AA5" color="#6e7781" class="line-number">$0AA5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_enter_high_speed_operation"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_enter_high_speed_operation" class="hljs-symbol" color="#e36209">_enter_high_speed_operation</a>:</span>
<a name="user-content-0AA6" href="#user-content-0AA6" color="#6e7781" class="line-number">$0AA6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0AA7" href="#user-content-0AA7" color="#6e7781" class="line-number">$0AA7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0AA8" href="#user-content-0AA8" color="#6e7781" class="line-number">$0AA8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-set_br" class="hljs-variable" color="#005cc5">set_br</a></span>
<a name="user-content-0AAB" href="#user-content-0AAB" color="#6e7781" class="line-number">$0AAB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-0AAD" href="#user-content-0AAD" color="#6e7781" class="line-number">$0AAD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <a href="#user-content-enter_high_speed_operation" class="hljs-variable" color="#005cc5">enter_high_speed_operation</a></span>
<a name="user-content-0AAF" href="#user-content-0AAF" color="#6e7781" class="line-number">$0AAF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0AB0" href="#user-content-0AB0" color="#6e7781" class="line-number">$0AB0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0AB1" href="#user-content-0AB1" color="#6e7781" class="line-number">$0AB1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-enter_high_speed_operation"><a href="#user-content-enter_high_speed_operation" class="hljs-symbol" color="#e36209">enter_high_speed_operation</a>:</span>
<a name="user-content-0AB2" href="#user-content-0AB2" color="#6e7781" class="line-number">$0AB2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">IX</span></span>
<a name="user-content-0AB3" href="#user-content-0AB3" color="#6e7781" class="line-number">$0AB3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#~01h</span>                 <span class="hljs-comment" color="#6a737d">; write 00 (intended) to VD1C (mid operating voltage)</span></span>
<a name="user-content-0AB6" href="#user-content-0AB6" color="#6e7781" class="line-number">$0AB6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-number" color="#005cc5">#20</span>                          <span class="hljs-comment" color="#6a737d">; wait 83 cycles</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-ehso__wait_80"><a href="#user-content-ehso__wait_80" class="hljs-symbol" color="#e36209">ehso__wait_80</a>:</span>
<a name="user-content-0AB9" href="#user-content-0AB9" color="#6e7781" class="line-number">$0AB9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DEC</span> <span class="hljs-variable language_" color="#d73a49">IX</span></span>
<a name="user-content-0ABA" href="#user-content-0ABA" color="#6e7781" class="line-number">$0ABA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-ehso__wait_80" class="hljs-variable" color="#005cc5">ehso__wait_80</a></span>
<a name="user-content-0ABC" href="#user-content-0ABC" color="#6e7781" class="line-number">$0ABC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#04h</span>                   <span class="hljs-comment" color="#6a737d">; write 1 to OSCC</span></span>
<a name="user-content-0ABF" href="#user-content-0ABF" color="#6e7781" class="line-number">$0ABF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-number" color="#005cc5">#409</span>                         <span class="hljs-comment" color="#6a737d">; wait 1639 cycles</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-ehso__wait_1636"><a href="#user-content-ehso__wait_1636" class="hljs-symbol" color="#e36209">ehso__wait_1636</a>:</span>
<a name="user-content-0AC2" href="#user-content-0AC2" color="#6e7781" class="line-number">$0AC2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DEC</span> <span class="hljs-variable language_" color="#d73a49">IX</span></span>
<a name="user-content-0AC3" href="#user-content-0AC3" color="#6e7781" class="line-number">$0AC3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-ehso__wait_1636" class="hljs-variable" color="#005cc5">ehso__wait_1636</a></span>
<a name="user-content-0AC5" href="#user-content-0AC5" color="#6e7781" class="line-number">$0AC5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#08h</span>                   <span class="hljs-comment" color="#6a737d">; clock CPU with OSC3</span></span>
<a name="user-content-0AC8" href="#user-content-0AC8" color="#6e7781" class="line-number">$0AC8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#10h</span>                   <span class="hljs-comment" color="#6a737d">; ??</span></span>
<a name="user-content-0ACB" href="#user-content-0ACB" color="#6e7781" class="line-number">$0ACB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">IX</span></span>
<a name="user-content-0ACC" href="#user-content-0ACC" color="#6e7781" class="line-number">$0ACC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_enter_low_speed_operation"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_enter_low_speed_operation" class="hljs-symbol" color="#e36209">_enter_low_speed_operation</a>:</span>
<a name="user-content-0ACD" href="#user-content-0ACD" color="#6e7781" class="line-number">$0ACD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0ACE" href="#user-content-0ACE" color="#6e7781" class="line-number">$0ACE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0ACF" href="#user-content-0ACF" color="#6e7781" class="line-number">$0ACF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-set_br" class="hljs-variable" color="#005cc5">set_br</a></span>
<a name="user-content-0AD2" href="#user-content-0AD2" color="#6e7781" class="line-number">$0AD2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-0AD4" href="#user-content-0AD4" color="#6e7781" class="line-number">$0AD4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <a href="#user-content-enter_low_speed_operation" class="hljs-variable" color="#005cc5">enter_low_speed_operation</a></span>
<a name="user-content-0AD6" href="#user-content-0AD6" color="#6e7781" class="line-number">$0AD6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0AD7" href="#user-content-0AD7" color="#6e7781" class="line-number">$0AD7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0AD8" href="#user-content-0AD8" color="#6e7781" class="line-number">$0AD8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-enter_low_speed_operation"><a href="#user-content-enter_low_speed_operation" class="hljs-symbol" color="#e36209">enter_low_speed_operation</a>:</span>
<a name="user-content-0AD9" href="#user-content-0AD9" color="#6e7781" class="line-number">$0AD9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#~10h</span>                 <span class="hljs-comment" color="#6a737d">; ??</span></span>
<a name="user-content-0ADC" href="#user-content-0ADC" color="#6e7781" class="line-number">$0ADC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#~08h</span>                 <span class="hljs-comment" color="#6a737d">; clock CPU with OSC1</span></span>
<a name="user-content-0ADF" href="#user-content-0ADF" color="#6e7781" class="line-number">$0ADF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#~04h</span>                 <span class="hljs-comment" color="#6a737d">; turn off OSC3</span></span>
<a name="user-content-0AE2" href="#user-content-0AE2" color="#6e7781" class="line-number">$0AE2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#01h</span>                   <span class="hljs-comment" color="#6a737d">; write 01 (intended) to VD1C (lowest operating voltage)</span></span>
<a name="user-content-0AE5" href="#user-content-0AE5" color="#6e7781" class="line-number">$0AE5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_cart_slot_off"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_cart_slot_off" class="hljs-symbol" color="#e36209">_cart_slot_off</a>:</span>
<a name="user-content-0AE6" href="#user-content-0AE6" color="#6e7781" class="line-number">$0AE6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0AE7" href="#user-content-0AE7" color="#6e7781" class="line-number">$0AE7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0AE8" href="#user-content-0AE8" color="#6e7781" class="line-number">$0AE8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-set_br" class="hljs-variable" color="#005cc5">set_br</a></span>
<a name="user-content-0AEB" href="#user-content-0AEB" color="#6e7781" class="line-number">$0AEB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-0AED" href="#user-content-0AED" color="#6e7781" class="line-number">$0AED</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <a href="#user-content-cart_slot_off" class="hljs-variable" color="#005cc5">cart_slot_off</a></span>
<a name="user-content-0AEF" href="#user-content-0AEF" color="#6e7781" class="line-number">$0AEF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0AF0" href="#user-content-0AF0" color="#6e7781" class="line-number">$0AF0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0AF1" href="#user-content-0AF1" color="#6e7781" class="line-number">$0AF1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-cart_slot_off"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-cart_slot_off" class="hljs-symbol" color="#e36209">cart_slot_off</a>:</span>
<a name="user-content-0AF2" href="#user-content-0AF2" color="#6e7781" class="line-number">$0AF2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#~40h</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-unpower_cart"><a href="#user-content-unpower_cart" class="hljs-symbol" color="#e36209">unpower_cart</a>:</span>
<a name="user-content-0AF5" href="#user-content-0AF5" color="#6e7781" class="line-number">$0AF5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:71h]</span>, <span class="hljs-number" color="#005cc5">#04h</span>                   <span class="hljs-comment" color="#6a737d">; turn off cart power</span></span>
<a name="user-content-0AF8" href="#user-content-0AF8" color="#6e7781" class="line-number">$0AF8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_cart_slot_on"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_cart_slot_on" class="hljs-symbol" color="#e36209">_cart_slot_on</a>:</span>
<a name="user-content-0AF9" href="#user-content-0AF9" color="#6e7781" class="line-number">$0AF9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0AFA" href="#user-content-0AFA" color="#6e7781" class="line-number">$0AFA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0AFB" href="#user-content-0AFB" color="#6e7781" class="line-number">$0AFB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-set_br" class="hljs-variable" color="#005cc5">set_br</a></span>
<a name="user-content-0AFE" href="#user-content-0AFE" color="#6e7781" class="line-number">$0AFE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-0B00" href="#user-content-0B00" color="#6e7781" class="line-number">$0B00</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <a href="#user-content-cart_slot_on" class="hljs-variable" color="#005cc5">cart_slot_on</a></span>
<a name="user-content-0B02" href="#user-content-0B02" color="#6e7781" class="line-number">$0B02</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0B03" href="#user-content-0B03" color="#6e7781" class="line-number">$0B03</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0B04" href="#user-content-0B04" color="#6e7781" class="line-number">$0B04</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-cart_slot_on"><a href="#user-content-cart_slot_on" class="hljs-symbol" color="#e36209">cart_slot_on</a>:</span>
<a name="user-content-0B05" href="#user-content-0B05" color="#6e7781" class="line-number">$0B05</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#40h</span>                   <span class="hljs-comment" color="#6a737d">; ??</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-power_cart"><a href="#user-content-power_cart" class="hljs-symbol" color="#e36209">power_cart</a>:</span>
<a name="user-content-0B08" href="#user-content-0B08" color="#6e7781" class="line-number">$0B08</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">IX</span></span>
<a name="user-content-0B09" href="#user-content-0B09" color="#6e7781" class="line-number">$0B09</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BA</span></span>
<a name="user-content-0B0A" href="#user-content-0B0A" color="#6e7781" class="line-number">$0B0A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:71h]</span>, <span class="hljs-number" color="#005cc5">#~04h</span>                 <span class="hljs-comment" color="#6a737d">; power the cart</span></span>
<a name="user-content-0B0D" href="#user-content-0B0D" color="#6e7781" class="line-number">$0B0D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#80h</span>                   <span class="hljs-comment" color="#6a737d">; ??</span></span>
<a name="user-content-0B10" href="#user-content-0B10" color="#6e7781" class="line-number">$0B10</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-number" color="#005cc5">#0032h</span>                       <span class="hljs-comment" color="#6a737d">; wait for 203 cycles</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-pc__wait_200"><a href="#user-content-pc__wait_200" class="hljs-symbol" color="#e36209">pc__wait_200</a>:</span>
<a name="user-content-0B13" href="#user-content-0B13" color="#6e7781" class="line-number">$0B13</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DEC</span> <span class="hljs-variable language_" color="#d73a49">IX</span></span>
<a name="user-content-0B14" href="#user-content-0B14" color="#6e7781" class="line-number">$0B14</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-pc__wait_200" class="hljs-variable" color="#005cc5">pc__wait_200</a></span>
<a name="user-content-0B16" href="#user-content-0B16" color="#6e7781" class="line-number">$0B16</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[2AAAh]</span>                       <span class="hljs-comment" color="#6a737d">; dummy read to cancel any half-input flash commands</span></span>
<a name="user-content-0B1A" href="#user-content-0B1A" color="#6e7781" class="line-number">$0B1A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#80h</span>                   <span class="hljs-comment" color="#6a737d">; ??</span></span>
<a name="user-content-0B1D" href="#user-content-0B1D" color="#6e7781" class="line-number">$0B1D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BA</span></span>
<a name="user-content-0B1E" href="#user-content-0B1E" color="#6e7781" class="line-number">$0B1E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">IX</span></span>
<a name="user-content-0B1F" href="#user-content-0B1F" color="#6e7781" class="line-number">$0B1F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_cart_detect"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Returns</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   Z: 1=cart is inserted</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_cart_detect" class="hljs-symbol" color="#e36209">_cart_detect</a>:</span>
<a name="user-content-0B20" href="#user-content-0B20" color="#6e7781" class="line-number">$0B20</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<a name="user-content-0B21" href="#user-content-0B21" color="#6e7781" class="line-number">$0B21</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0B22" href="#user-content-0B22" color="#6e7781" class="line-number">$0B22</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0B23" href="#user-content-0B23" color="#6e7781" class="line-number">$0B23</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-set_br" class="hljs-variable" color="#005cc5">set_br</a></span>
<a name="user-content-0B26" href="#user-content-0B26" color="#6e7781" class="line-number">$0B26</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:53h]</span>, <span class="hljs-number" color="#005cc5">#02h</span></span>
<a name="user-content-0B29" href="#user-content-0B29" color="#6e7781" class="line-number">$0B29</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">XOR</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#01h</span></span>
<a name="user-content-0B2B" href="#user-content-0B2B" color="#6e7781" class="line-number">$0B2B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0B2C" href="#user-content-0B2C" color="#6e7781" class="line-number">$0B2C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0B2D" href="#user-content-0B2D" color="#6e7781" class="line-number">$0B2D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_read_structure"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Arguments:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   IX: start address of structure</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_read_structure" class="hljs-symbol" color="#e36209">_read_structure</a>:</span>
<a name="user-content-0B2E" href="#user-content-0B2E" color="#6e7781" class="line-number">$0B2E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span>                             <span class="hljs-comment" color="#6a737d">; omg just use PUSH ALE</span></span>
<a name="user-content-0B2F" href="#user-content-0B2F" color="#6e7781" class="line-number">$0B2F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0B30" href="#user-content-0B30" color="#6e7781" class="line-number">$0B30</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-set_br" class="hljs-variable" color="#005cc5">set_br</a></span>
<a name="user-content-0B33" href="#user-content-0B33" color="#6e7781" class="line-number">$0B33</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">IP</span></span>
<a name="user-content-0B34" href="#user-content-0B34" color="#6e7781" class="line-number">$0B34</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">IX</span></span>
<a name="user-content-0B35" href="#user-content-0B35" color="#6e7781" class="line-number">$0B35</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">IY</span></span>
<a name="user-content-0B36" href="#user-content-0B36" color="#6e7781" class="line-number">$0B36</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-0B37" href="#user-content-0B37" color="#6e7781" class="line-number">$0B37</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">B</span></span>
<a name="user-content-0B39" href="#user-content-0B39" color="#6e7781" class="line-number">$0B39</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-0B3B" href="#user-content-0B3B" color="#6e7781" class="line-number">$0B3B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[IX]</span>                          <span class="hljs-comment" color="#6a737d">; read byte $00</span></span>
<a name="user-content-0B3C" href="#user-content-0B3C" color="#6e7781" class="line-number">$0B3C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#01h</span>                         <span class="hljs-comment" color="#6a737d">; if bit 0 is 0,</span></span>
<a name="user-content-0B3E" href="#user-content-0B3E" color="#6e7781" class="line-number">$0B3E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">SC</span>                            <span class="hljs-comment" color="#6a737d">; (save result for later)</span></span>
<a name="user-content-0B40" href="#user-content-0B40" color="#6e7781" class="line-number">$0B40</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-loc_0x0B4E" class="hljs-variable" color="#005cc5">loc_0x0B4E</a>                   <span class="hljs-comment" color="#6a737d">;</span></span>
<a name="user-content-0B42" href="#user-content-0B42" color="#6e7781" class="line-number">$0B42</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">ADD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-number" color="#005cc5">#000Ah</span>                      <span class="hljs-comment" color="#6a737d">; read byte $0A</span></span>
<a name="user-content-0B45" href="#user-content-0B45" color="#6e7781" class="line-number">$0B45</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">H</span>, <span>[IX]</span>                          <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0B46" href="#user-content-0B46" color="#6e7781" class="line-number">$0B46</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DEC</span> <span class="hljs-variable language_" color="#d73a49">IX</span>                              <span class="hljs-comment" color="#6a737d">; read byte $09</span></span>
<a name="user-content-0B47" href="#user-content-0B47" color="#6e7781" class="line-number">$0B47</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">L</span>, <span>[IX]</span>                          <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0B48" href="#user-content-0B48" color="#6e7781" class="line-number">$0B48</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DEC</span> <span class="hljs-variable language_" color="#d73a49">IX</span>                              <span class="hljs-comment" color="#6a737d">; read byte $08</span></span>
<a name="user-content-0B49" href="#user-content-0B49" color="#6e7781" class="line-number">$0B49</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-0B4A" href="#user-content-0B4A" color="#6e7781" class="line-number">$0B4A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span>[IX]</span>                          <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0B4B" href="#user-content-0B4B" color="#6e7781" class="line-number">$0B4B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DEC</span> <span class="hljs-variable language_" color="#d73a49">IX</span>                              <span class="hljs-comment" color="#6a737d">; addr $07</span></span>
<a name="user-content-0B4C" href="#user-content-0B4C" color="#6e7781" class="line-number">$0B4C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <a href="#user-content-loc_0x0B51" class="hljs-variable" color="#005cc5">loc_0x0B51</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-loc_0x0B4E"><a href="#user-content-loc_0x0B4E" class="hljs-symbol" color="#e36209">loc_0x0B4E</a>:</span>
<a name="user-content-0B4E" href="#user-content-0B4E" color="#6e7781" class="line-number">$0B4E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">ADD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-number" color="#005cc5">#0007h</span>                      <span class="hljs-comment" color="#6a737d">; addr $07</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-loc_0x0B51"><a href="#user-content-loc_0x0B51" class="hljs-symbol" color="#e36209">loc_0x0B51</a>:</span>
<a name="user-content-0B51" href="#user-content-0B51" color="#6e7781" class="line-number">$0B51</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BA</span></span>
<a name="user-content-0B52" href="#user-content-0B52" color="#6e7781" class="line-number">$0B52</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span>[IX]</span>                          <span class="hljs-comment" color="#6a737d">; read byte $07</span></span>
<a name="user-content-0B53" href="#user-content-0B53" color="#6e7781" class="line-number">$0B53</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DEC</span> <span class="hljs-variable language_" color="#d73a49">IX</span>                              <span class="hljs-comment" color="#6a737d">; read byte $06</span></span>
<a name="user-content-0B54" href="#user-content-0B54" color="#6e7781" class="line-number">$0B54</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[IX]</span>                          <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0B55" href="#user-content-0B55" color="#6e7781" class="line-number">$0B55</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DEC</span> <span class="hljs-variable language_" color="#d73a49">IX</span>                              <span class="hljs-comment" color="#6a737d">; read byte $05</span></span>
<a name="user-content-0B56" href="#user-content-0B56" color="#6e7781" class="line-number">$0B56</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">H</span>, <span>[IX]</span>                          <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0B57" href="#user-content-0B57" color="#6e7781" class="line-number">$0B57</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DEC</span> <span class="hljs-variable language_" color="#d73a49">IX</span>                              <span class="hljs-comment" color="#6a737d">; read byte $04</span></span>
<a name="user-content-0B58" href="#user-content-0B58" color="#6e7781" class="line-number">$0B58</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">L</span>, <span>[IX]</span>                          <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0B59" href="#user-content-0B59" color="#6e7781" class="line-number">$0B59</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DEC</span> <span class="hljs-variable language_" color="#d73a49">IX</span>                              <span class="hljs-comment" color="#6a737d">; addr $03</span></span>
<a name="user-content-0B5A" href="#user-content-0B5A" color="#6e7781" class="line-number">$0B5A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">YP</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                            <span class="hljs-comment" color="#6a737d">; byte $06 to YP</span></span>
<a name="user-content-0B5C" href="#user-content-0B5C" color="#6e7781" class="line-number">$0B5C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IY</span>, <span class="hljs-variable language_" color="#d73a49">HL</span>                           <span class="hljs-comment" color="#6a737d">; bytes $05~04 to IY</span></span>
<a name="user-content-0B5E" href="#user-content-0B5E" color="#6e7781" class="line-number">$0B5E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[IX]</span>                          <span class="hljs-comment" color="#6a737d">; read byte $03</span></span>
<a name="user-content-0B5F" href="#user-content-0B5F" color="#6e7781" class="line-number">$0B5F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DEC</span> <span class="hljs-variable language_" color="#d73a49">IX</span>                              <span class="hljs-comment" color="#6a737d">; read byte $02</span></span>
<a name="user-content-0B60" href="#user-content-0B60" color="#6e7781" class="line-number">$0B60</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">H</span>, <span>[IX]</span>                          <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0B61" href="#user-content-0B61" color="#6e7781" class="line-number">$0B61</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DEC</span> <span class="hljs-variable language_" color="#d73a49">IX</span>                              <span class="hljs-comment" color="#6a737d">; read byte $01</span></span>
<a name="user-content-0B62" href="#user-content-0B62" color="#6e7781" class="line-number">$0B62</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">L</span>, <span>[IX]</span>                          <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0B63" href="#user-content-0B63" color="#6e7781" class="line-number">$0B63</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">XP</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                            <span class="hljs-comment" color="#6a737d">; byte $03 to XP, why is this necessary?</span></span>
<a name="user-content-0B65" href="#user-content-0B65" color="#6e7781" class="line-number">$0B65</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-variable language_" color="#d73a49">HL</span>                           <span class="hljs-comment" color="#6a737d">; bytes $02~$01 to IX</span></span>
<a name="user-content-0B67" href="#user-content-0B67" color="#6e7781" class="line-number">$0B67</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#80h</span>                   <span class="hljs-comment" color="#6a737d">; ??</span></span>
<a name="user-content-0B6A" href="#user-content-0B6A" color="#6e7781" class="line-number">$0B6A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[IX]</span>, <span class="hljs-number" color="#005cc5">#0FFh</span>                      <span class="hljs-comment" color="#6a737d">; write 0xFF to IX</span></span>
<a name="user-content-0B6C" href="#user-content-0B6C" color="#6e7781" class="line-number">$0B6C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#80h</span>                   <span class="hljs-comment" color="#6a737d">; ???</span></span>
<a name="user-content-0B6F" href="#user-content-0B6F" color="#6e7781" class="line-number">$0B6F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[IY]</span>                          <span class="hljs-comment" color="#6a737d">; read byte into A</span></span>
<a name="user-content-0B70" href="#user-content-0B70" color="#6e7781" class="line-number">$0B70</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:02h]</span>, <span class="hljs-number" color="#005cc5">#80h</span>                   <span class="hljs-comment" color="#6a737d">; ????</span></span>
<a name="user-content-0B73" href="#user-content-0B73" color="#6e7781" class="line-number">$0B73</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                             <span class="hljs-comment" color="#6a737d">; compare with byte $07</span></span>
<a name="user-content-0B74" href="#user-content-0B74" color="#6e7781" class="line-number">$0B74</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BA</span>                              <span class="hljs-comment" color="#6a737d">; restore B=byte $08, A=state of byte $00 bit 0</span></span>
<a name="user-content-0B75" href="#user-content-0B75" color="#6e7781" class="line-number">$0B75</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">SC</span>                             <span class="hljs-comment" color="#6a737d">; store result of CP</span></span>
<a name="user-content-0B76" href="#user-content-0B76" color="#6e7781" class="line-number">$0B76</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                            <span class="hljs-comment" color="#6a737d">; re-check byte $00 bit 0</span></span>
<a name="user-content-0B78" href="#user-content-0B78" color="#6e7781" class="line-number">$0B78</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-loc_0x0B82" class="hljs-variable" color="#005cc5">loc_0x0B82</a>                   <span class="hljs-comment" color="#6a737d">; which allows B to definitely be byte $08</span></span>
<a name="user-content-0B7A" href="#user-content-0B7A" color="#6e7781" class="line-number">$0B7A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">SC</span>                              <span class="hljs-comment" color="#6a737d">; just popped to allow POP BA</span></span>
<a name="user-content-0B7B" href="#user-content-0B7B" color="#6e7781" class="line-number">$0B7B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">L</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                             <span class="hljs-comment" color="#6a737d">; L=byte $08</span></span>
<a name="user-content-0B7C" href="#user-content-0B7C" color="#6e7781" class="line-number">$0B7C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BA</span>                              <span class="hljs-comment" color="#6a737d">; (from $0B49) B=byte $0A, A=byte $09</span></span>
<a name="user-content-0B7D" href="#user-content-0B7D" color="#6e7781" class="line-number">$0B7D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">H</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                             <span class="hljs-comment" color="#6a737d">; H=byte $09</span></span>
<a name="user-content-0B7E" href="#user-content-0B7E" color="#6e7781" class="line-number">$0B7E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                             <span class="hljs-comment" color="#6a737d">; A=byte $0A</span></span>
<a name="user-content-0B7F" href="#user-content-0B7F" color="#6e7781" class="line-number">$0B7F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">SC</span>                             <span class="hljs-comment" color="#6a737d">; pushed back to stack unchanged</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-loc_0x0B82">    <span class="hljs-comment" color="#6a737d">; subroutine should fetch [SP+3] for the result of</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-comment" color="#6a737d">; the compare then put its result in its place</span></span>
<a name="user-content-0B80" href="#user-content-0B80" color="#6e7781" class="line-number">$0B80</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <a href="#user-content-call_a_hl" class="hljs-variable" color="#005cc5">call_a_hl</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-loc_0x0B82" class="hljs-symbol" color="#e36209">loc_0x0B82</a>:</span>
<a name="user-content-0B82" href="#user-content-0B82" color="#6e7781" class="line-number">$0B82</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BA</span>                              <span class="hljs-comment" color="#6a737d">; B=B before call, A=SC from $0B75 or $0B7F</span></span>
<a name="user-content-0B83" href="#user-content-0B83" color="#6e7781" class="line-number">$0B83</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#01h</span>                         <span class="hljs-comment" color="#6a737d">; A=Z, result of compare with byte $07</span></span>
<a name="user-content-0B85" href="#user-content-0B85" color="#6e7781" class="line-number">$0B85</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-0B86" href="#user-content-0B86" color="#6e7781" class="line-number">$0B86</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">IY</span></span>
<a name="user-content-0B87" href="#user-content-0B87" color="#6e7781" class="line-number">$0B87</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">IX</span></span>
<a name="user-content-0B88" href="#user-content-0B88" color="#6e7781" class="line-number">$0B88</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">IP</span></span>
<a name="user-content-0B89" href="#user-content-0B89" color="#6e7781" class="line-number">$0B89</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0B8A" href="#user-content-0B8A" color="#6e7781" class="line-number">$0B8A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0B8B" href="#user-content-0B8B" color="#6e7781" class="line-number">$0B8B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-call_a_hl"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Used by _read_structure</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Arguments</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   A: code page</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   HL: subroutine address</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   [SP+3]: compare byte result (from SC)</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Clobbers: any/all</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-call_a_hl" class="hljs-symbol" color="#e36209">call_a_hl</a>:</span>
<a name="user-content-0B8C" href="#user-content-0B8C" color="#6e7781" class="line-number">$0B8C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">NB</span>, <span class="hljs-variable language_" color="#d73a49">A</span></span>
<a name="user-content-0B8E" href="#user-content-0B8E" color="#6e7781" class="line-number">$0B8E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JP</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_set_prc_rate"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Arguments</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   A: rate divider</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_set_prc_rate" class="hljs-symbol" color="#e36209">_set_prc_rate</a>:</span>
<a name="user-content-0B8F" href="#user-content-0B8F" color="#6e7781" class="line-number">$0B8F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0B90" href="#user-content-0B90" color="#6e7781" class="line-number">$0B90</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-0B91" href="#user-content-0B91" color="#6e7781" class="line-number">$0B91</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#07h</span>                         <span class="hljs-comment" color="#6a737d">; limit to 3 bits</span></span>
<a name="user-content-0B93" href="#user-content-0B93" color="#6e7781" class="line-number">$0B93</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">SLL</span> <span class="hljs-variable language_" color="#d73a49">A</span>                               <span class="hljs-comment" color="#6a737d">; position</span></span>
<a name="user-content-0B95" href="#user-content-0B95" color="#6e7781" class="line-number">$0B95</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-0B98" href="#user-content-0B98" color="#6e7781" class="line-number">$0B98</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">HL</span>, <span class="hljs-number" color="#005cc5">#2081h</span></span>
<a name="user-content-0B9B" href="#user-content-0B9B" color="#6e7781" class="line-number">$0B9B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[HL]</span>, <span class="hljs-number" color="#005cc5">#0F1h</span>                     <span class="hljs-comment" color="#6a737d">; reset those bits</span></span>
<a name="user-content-0B9E" href="#user-content-0B9E" color="#6e7781" class="line-number">$0B9E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[HL]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                          <span class="hljs-comment" color="#6a737d">; insert new value</span></span>
<a name="user-content-0BA0" href="#user-content-0BA0" color="#6e7781" class="line-number">$0BA0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-0BA1" href="#user-content-0BA1" color="#6e7781" class="line-number">$0BA1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0BA2" href="#user-content-0BA2" color="#6e7781" class="line-number">$0BA2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_get_prc_rate"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Returns</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   A: rate divider value</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_get_prc_rate" class="hljs-symbol" color="#e36209">_get_prc_rate</a>:</span>
<a name="user-content-0BA3" href="#user-content-0BA3" color="#6e7781" class="line-number">$0BA3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0BA4" href="#user-content-0BA4" color="#6e7781" class="line-number">$0BA4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0BA5" href="#user-content-0BA5" color="#6e7781" class="line-number">$0BA5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-set_br" class="hljs-variable" color="#005cc5">set_br</a></span>
<a name="user-content-0BA8" href="#user-content-0BA8" color="#6e7781" class="line-number">$0BA8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[BR:81h]</span></span>
<a name="user-content-0BAA" href="#user-content-0BAA" color="#6e7781" class="line-number">$0BAA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#0Eh</span></span>
<a name="user-content-0BAC" href="#user-content-0BAC" color="#6e7781" class="line-number">$0BAC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">SRL</span> <span class="hljs-variable language_" color="#d73a49">A</span></span>
<a name="user-content-0BAE" href="#user-content-0BAE" color="#6e7781" class="line-number">$0BAE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0BAF" href="#user-content-0BAF" color="#6e7781" class="line-number">$0BAF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0BB0" href="#user-content-0BB0" color="#6e7781" class="line-number">$0BB0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_game_id_valid"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; This has to do with the Game Select screen</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Returns</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   Z: 1=$2001 bits 2~0 are a valid game index</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_game_id_valid" class="hljs-symbol" color="#e36209">_game_id_valid</a>:</span>
<a name="user-content-0BB1" href="#user-content-0BB1" color="#6e7781" class="line-number">$0BB1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">SC</span></span>
<a name="user-content-0BB2" href="#user-content-0BB2" color="#6e7781" class="line-number">$0BB2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0BB3" href="#user-content-0BB3" color="#6e7781" class="line-number">$0BB3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0BB4" href="#user-content-0BB4" color="#6e7781" class="line-number">$0BB4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-set_br" class="hljs-variable" color="#005cc5">set_br</a></span>
<a name="user-content-0BB7" href="#user-content-0BB7" color="#6e7781" class="line-number">$0BB7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:01h]</span>, <span class="hljs-number" color="#005cc5">#08h</span></span>
<a name="user-content-0BBA" href="#user-content-0BBA" color="#6e7781" class="line-number">$0BBA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">BR</span></span>
<a name="user-content-0BBB" href="#user-content-0BBB" color="#6e7781" class="line-number">$0BBB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">EP</span></span>
<a name="user-content-0BBC" href="#user-content-0BBC" color="#6e7781" class="line-number">$0BBC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-_ir_pulse"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Write to IR bit, wait, then reset IR bit</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Arguments:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   IY = $2061</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   B = cycles to wait / 4</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-_ir_pulse" class="hljs-symbol" color="#e36209">_ir_pulse</a>:</span>
<a name="user-content-0BBD" href="#user-content-0BBD" color="#6e7781" class="line-number">$0BBD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[IY]</span>, <span class="hljs-number" color="#005cc5">#02h</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-irp__wait"><a href="#user-content-irp__wait" class="hljs-symbol" color="#e36209">irp__wait</a>:</span>
<a name="user-content-0BBF" href="#user-content-0BBF" color="#6e7781" class="line-number">$0BBF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DJR</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-irp__wait" class="hljs-variable" color="#005cc5">irp__wait</a></span>
<a name="user-content-0BC1" href="#user-content-0BC1" color="#6e7781" class="line-number">$0BC1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[IY]</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-0BC3" href="#user-content-0BC3" color="#6e7781" class="line-number">$0BC3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RETE</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-set_br"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Set [BR:ll] indexing for hardware registers.</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Returns:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   EP: page for [BR:ll] (set to 0)</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   BR: BR set to $20 for hardware register space</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-set_br" class="hljs-symbol" color="#e36209">set_br</a>:</span>
<a name="user-content-0BC4" href="#user-content-0BC4" color="#6e7781" class="line-number">$0BC4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">EP</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-0BC7" href="#user-content-0BC7" color="#6e7781" class="line-number">$0BC7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BR</span>, <span class="hljs-number" color="#005cc5">#20h</span></span>
<a name="user-content-0BC9" href="#user-content-0BC9" color="#6e7781" class="line-number">$0BC9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-wait_8000_cycles"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-wait_8000_cycles" class="hljs-symbol" color="#e36209">wait_8000_cycles</a>:                       <span class="hljs-comment" color="#6a737d">; including the CARL to get here</span></span>
<a name="user-content-0BCA" href="#user-content-0BCA" color="#6e7781" class="line-number">$0BCA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">IX</span></span>
<a name="user-content-0BCB" href="#user-content-0BCB" color="#6e7781" class="line-number">$0BCB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-number" color="#005cc5">#1995</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-w8kc__loop"><a href="#user-content-w8kc__loop" class="hljs-symbol" color="#e36209">w8kc__loop</a>:</span>
<a name="user-content-0BCE" href="#user-content-0BCE" color="#6e7781" class="line-number">$0BCE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DEC</span> <span class="hljs-variable language_" color="#d73a49">IX</span></span>
<a name="user-content-0BCF" href="#user-content-0BCF" color="#6e7781" class="line-number">$0BCF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-w8kc__loop" class="hljs-variable" color="#005cc5">w8kc__loop</a></span>
<a name="user-content-0BD1" href="#user-content-0BD1" color="#6e7781" class="line-number">$0BD1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">IX</span></span>
<a name="user-content-0BD2" href="#user-content-0BD2" color="#6e7781" class="line-number">$0BD2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-read_keys_buffer"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Arguments:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   H: previous inverted keypad state</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Returns:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   A: newly pressed keys</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   H: keys being pressed, new or old</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Clobbers: B</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-read_keys_buffer" class="hljs-symbol" color="#e36209">read_keys_buffer</a>:</span>
<a name="user-content-0BD3" href="#user-content-0BD3" color="#6e7781" class="line-number">$0BD3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span>[BR:52h]</span>                      <span class="hljs-comment" color="#6a737d">; read current keymap state</span></span>
<a name="user-content-0BD5" href="#user-content-0BD5" color="#6e7781" class="line-number">$0BD5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CPL</span> <span class="hljs-variable language_" color="#d73a49">B</span>                               <span class="hljs-comment" color="#6a737d">; invert so 1 is pressed</span></span>
<a name="user-content-0BD7" href="#user-content-0BD7" color="#6e7781" class="line-number">$0BD7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">H</span></span>
<a name="user-content-0BD8" href="#user-content-0BD8" color="#6e7781" class="line-number">$0BD8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">H</span>, <span class="hljs-variable language_" color="#d73a49">B</span></span>
<a name="user-content-0BD9" href="#user-content-0BD9" color="#6e7781" class="line-number">$0BD9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">XOR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                            <span class="hljs-comment" color="#6a737d">; 0 out any keys that were pressed last time</span></span>
<a name="user-content-0BDA" href="#user-content-0BDA" color="#6e7781" class="line-number">$0BDA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                            <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0BDB" href="#user-content-0BDB" color="#6e7781" class="line-number">$0BDB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-load_tilemap"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Arguments:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   IY: tilemap source</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Returns:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   IX: $1360 (start of tilemap memory)</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Clobbers: L</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-load_tilemap" class="hljs-symbol" color="#e36209">load_tilemap</a>:</span>
<a name="user-content-0BDC" href="#user-content-0BDC" color="#6e7781" class="line-number">$0BDC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-number" color="#005cc5">#1360h</span>                       <span class="hljs-comment" color="#6a737d">; tilemap base</span></span>
<a name="user-content-0BDF" href="#user-content-0BDF" color="#6e7781" class="line-number">$0BDF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">L</span>, <span class="hljs-number" color="#005cc5">#00h</span>                          <span class="hljs-comment" color="#6a737d">; loop 0 to 96 (exclusive), a full 12x8 screen</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-ltm__loop"><a href="#user-content-ltm__loop" class="hljs-symbol" color="#e36209">ltm__loop</a>:</span>
<a name="user-content-0BE1" href="#user-content-0BE1" color="#6e7781" class="line-number">$0BE1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span>[IY+L]</span>                        <span class="hljs-comment" color="#6a737d">; read from map starting at IY</span></span>
<a name="user-content-0BE3" href="#user-content-0BE3" color="#6e7781" class="line-number">$0BE3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[IX+L]</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                        <span class="hljs-comment" color="#6a737d">; copy into IX</span></span>
<a name="user-content-0BE5" href="#user-content-0BE5" color="#6e7781" class="line-number">$0BE5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">L</span></span>
<a name="user-content-0BE6" href="#user-content-0BE6" color="#6e7781" class="line-number">$0BE6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">L</span>, <span class="hljs-number" color="#005cc5">#60h</span></span>
<a name="user-content-0BE9" href="#user-content-0BE9" color="#6e7781" class="line-number">$0BE9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-ltm__loop" class="hljs-variable" color="#005cc5">ltm__loop</a></span>
<a name="user-content-0BEB" href="#user-content-0BEB" color="#6e7781" class="line-number">$0BEB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-load_middle_5_tilemap"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Arguments:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   IY: tilemap source</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Returns:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   IX: $1378 (top of names list)</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Clobbers: L</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-load_middle_5_tilemap" class="hljs-symbol" color="#e36209">load_middle_5_tilemap</a>:                  <span class="hljs-comment" color="#6a737d">; middle 5 rows</span></span>
<a name="user-content-0BEC" href="#user-content-0BEC" color="#6e7781" class="line-number">$0BEC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-number" color="#005cc5">#1378h</span>                       <span class="hljs-comment" color="#6a737d">; start of row 2 (0-based)</span></span>
<a name="user-content-0BEF" href="#user-content-0BEF" color="#6e7781" class="line-number">$0BEF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">L</span>, <span class="hljs-number" color="#005cc5">#00h</span>                          <span class="hljs-comment" color="#6a737d">; loop from 0 to 60 (exclusive), a 12x5 subsection</span></span>
<a name="user-content-0BF1" href="#user-content-0BF1" color="#6e7781" class="line-number">$0BF1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:80h]</span>, <span class="hljs-number" color="#005cc5">#~08h</span>                 <span class="hljs-comment" color="#6a737d">; disable LCD controller</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-lm5tm__loop"><a href="#user-content-lm5tm__loop" class="hljs-symbol" color="#e36209">lm5tm__loop</a>:</span>
<a name="user-content-0BF4" href="#user-content-0BF4" color="#6e7781" class="line-number">$0BF4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span>[IY+L]</span>                        <span class="hljs-comment" color="#6a737d">; read from map starting at IY</span></span>
<a name="user-content-0BF6" href="#user-content-0BF6" color="#6e7781" class="line-number">$0BF6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[IX+L]</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                        <span class="hljs-comment" color="#6a737d">; copy into IX</span></span>
<a name="user-content-0BF8" href="#user-content-0BF8" color="#6e7781" class="line-number">$0BF8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">L</span></span>
<a name="user-content-0BF9" href="#user-content-0BF9" color="#6e7781" class="line-number">$0BF9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">L</span>, <span class="hljs-number" color="#005cc5">#3Ch</span></span>
<a name="user-content-0BFC" href="#user-content-0BFC" color="#6e7781" class="line-number">$0BFC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-lm5tm__loop" class="hljs-variable" color="#005cc5">lm5tm__loop</a></span>
<a name="user-content-0BFE" href="#user-content-0BFE" color="#6e7781" class="line-number">$0BFE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-copy_one_frame"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Copy one frame while the LCD controller is disabled</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Will disable it again by the end of the function</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-copy_one_frame" class="hljs-symbol" color="#e36209">copy_one_frame</a>:</span>
<a name="user-content-0BFF" href="#user-content-0BFF" color="#6e7781" class="line-number">$0BFF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:27h]</span>, <span class="hljs-number" color="#005cc5">#80h</span>                   <span class="hljs-comment" color="#6a737d">; clear Frame Copy Complete</span></span>
<a name="user-content-0C02" href="#user-content-0C02" color="#6e7781" class="line-number">$0C02</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:80h]</span>, <span class="hljs-number" color="#005cc5">#08h</span>                   <span class="hljs-comment" color="#6a737d">; enable frame copy</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-cof__wait_for_vsync"><a href="#user-content-cof__wait_for_vsync" class="hljs-symbol" color="#e36209">cof__wait_for_vsync</a>:</span>
<a name="user-content-0C05" href="#user-content-0C05" color="#6e7781" class="line-number">$0C05</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:27h]</span>, <span class="hljs-number" color="#005cc5">#80h</span>                  <span class="hljs-comment" color="#6a737d">; wait for Frame Copy Complete to trigger</span></span>
<a name="user-content-0C08" href="#user-content-0C08" color="#6e7781" class="line-number">$0C08</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-cof__wait_for_vsync" class="hljs-variable" color="#005cc5">cof__wait_for_vsync</a></span>
<a name="user-content-0C0A" href="#user-content-0C0A" color="#6e7781" class="line-number">$0C0A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:80h]</span>, <span class="hljs-number" color="#005cc5">#~08h</span>                 <span class="hljs-comment" color="#6a737d">; disable LCD controller</span></span>
<a name="user-content-0C0D" href="#user-content-0C0D" color="#6e7781" class="line-number">$0C0D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-game_select_screen"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Arguments:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   A: number of game structs loaded</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Clobbers: B, HL, IX, IY</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-game_select_screen" class="hljs-symbol" color="#e36209">game_select_screen</a>:</span>
<a name="user-content-0C0E" href="#user-content-0C0E" color="#6e7781" class="line-number">$0C0E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DEC</span> <span class="hljs-variable language_" color="#d73a49">A</span>                               <span class="hljs-comment" color="#6a737d">; get starting index of final row</span></span>
<a name="user-content-0C0F" href="#user-content-0C0F" color="#6e7781" class="line-number">$0C0F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">L</span>, <span class="hljs-number" color="#005cc5">#12</span>                           <span class="hljs-comment" color="#6a737d">; ...a row is 12 tiles wide (screen width)</span></span>
<a name="user-content-0C11" href="#user-content-0C11" color="#6e7781" class="line-number">$0C11</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">MLT</span>                                <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0C13" href="#user-content-0C13" color="#6e7781" class="line-number">$0C13</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[FinalNameRowStart]</span>, <span class="hljs-variable language_" color="#d73a49">L</span>           <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0C17" href="#user-content-0C17" color="#6e7781" class="line-number">$0C17</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">L</span>, <span class="hljs-number" color="#005cc5">#48</span>                           <span class="hljs-comment" color="#6a737d">; if L &lt; 48,</span></span>
<a name="user-content-0C1A" href="#user-content-0C1A" color="#6e7781" class="line-number">$0C1A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">C</span>, <a href="#user-content-gss__min_final" class="hljs-variable" color="#005cc5">gss__min_final</a></span>
<a name="user-content-0C1C" href="#user-content-0C1C" color="#6e7781" class="line-number">$0C1C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">L</span>, <span class="hljs-number" color="#005cc5">#48</span>                           <span class="hljs-comment" color="#6a737d">; 48 is the start of the 5th entry, basing 0 at the first entry</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-gss__min_final"><a href="#user-content-gss__min_final" class="hljs-symbol" color="#e36209">gss__min_final</a>:</span>
<a name="user-content-0C1E" href="#user-content-0C1E" color="#6e7781" class="line-number">$0C1E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[FinalNameRowStartMin48]</span>, <span class="hljs-variable language_" color="#d73a49">L</span></span>
<a name="user-content-0C22" href="#user-content-0C22" color="#6e7781" class="line-number">$0C22</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IY</span>, <span class="hljs-number" color="#005cc5">#GameSelectMap</span>               <span class="hljs-comment" color="#6a737d">; load the base tilemap (not the five name lines)</span></span>
<a name="user-content-0C25" href="#user-content-0C25" color="#6e7781" class="line-number">$0C25</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-load_tilemap" class="hljs-variable" color="#005cc5">load_tilemap</a></span>
<a name="user-content-0C28" href="#user-content-0C28" color="#6e7781" class="line-number">$0C28</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-number" color="#005cc5">#CurrentRowStart</span></span>
<a name="user-content-0C2B" href="#user-content-0C2B" color="#6e7781" class="line-number">$0C2B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IY</span>, <span class="hljs-number" color="#005cc5">#MoveCooldown</span></span>
<a name="user-content-0C2E" href="#user-content-0C2E" color="#6e7781" class="line-number">$0C2E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">XOR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">A</span></span>
<a name="user-content-0C2F" href="#user-content-0C2F" color="#6e7781" class="line-number">$0C2F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[KeyHistory]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                  <span class="hljs-comment" color="#6a737d">; no keys pressed</span></span>
<a name="user-content-0C33" href="#user-content-0C33" color="#6e7781" class="line-number">$0C33</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[BR:52h]</span>                      <span class="hljs-comment" color="#6a737d">; take cpl of keymap (so 1=pressed)</span></span>
<a name="user-content-0C35" href="#user-content-0C35" color="#6e7781" class="line-number">$0C35</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CPL</span> <span class="hljs-variable language_" color="#d73a49">A</span>                               <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0C37" href="#user-content-0C37" color="#6e7781" class="line-number">$0C37</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">H</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                             <span class="hljs-comment" color="#6a737d">; ...into H</span></span>
<a name="user-content-0C38" href="#user-content-0C38" color="#6e7781" class="line-number">$0C38</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">XOR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                            <span class="hljs-comment" color="#6a737d">; draw names from first name</span></span>
<a name="user-content-0C39" href="#user-content-0C39" color="#6e7781" class="line-number">$0C39</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">L</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                             <span class="hljs-comment" color="#6a737d">; with the first name selected</span></span>
<a name="user-content-0C3A" href="#user-content-0C3A" color="#6e7781" class="line-number">$0C3A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[IX]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                          <span class="hljs-comment" color="#6a737d">; CurrentRowStart = 0</span></span>
<a name="user-content-0C3B" href="#user-content-0C3B" color="#6e7781" class="line-number">$0C3B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-draw_game_names" class="hljs-variable" color="#005cc5">draw_game_names</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-gss__main_loop"><a href="#user-content-gss__main_loop" class="hljs-symbol" color="#e36209">gss__main_loop</a>:</span>
<a name="user-content-0C3E" href="#user-content-0C3E" color="#6e7781" class="line-number">$0C3E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:27h]</span>, <span class="hljs-number" color="#005cc5">#40h</span>                   <span class="hljs-comment" color="#6a737d">; clear frame divided overflow</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-gss__ml__wait_for_framediv_overflow"><a href="#user-content-gss__ml__wait_for_framediv_overflow" class="hljs-symbol" color="#e36209">gss__ml__wait_for_framediv_overflow</a>:</span>
<a name="user-content-0C41" href="#user-content-0C41" color="#6e7781" class="line-number">$0C41</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:27h]</span>, <span class="hljs-number" color="#005cc5">#40h</span></span>
<a name="user-content-0C44" href="#user-content-0C44" color="#6e7781" class="line-number">$0C44</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-gss__ml__wait_for_framediv_overflow" class="hljs-variable" color="#005cc5">gss__ml__wait_for_framediv_overflow</a></span>
<a name="user-content-0C46" href="#user-content-0C46" color="#6e7781" class="line-number">$0C46</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-init_display_without_wait" class="hljs-variable" color="#005cc5">init_display_without_wait</a></span>
<a name="user-content-0C49" href="#user-content-0C49" color="#6e7781" class="line-number">$0C49</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-apply_default_contrast1" class="hljs-variable" color="#005cc5">apply_default_contrast1</a></span>
<a name="user-content-0C4C" href="#user-content-0C4C" color="#6e7781" class="line-number">$0C4C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-read_keys_buffer" class="hljs-variable" color="#005cc5">read_keys_buffer</a></span>
<a name="user-content-0C4F" href="#user-content-0C4F" color="#6e7781" class="line-number">$0C4F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span class="hljs-variable language_" color="#d73a49">A</span></span>
<a name="user-content-0C50" href="#user-content-0C50" color="#6e7781" class="line-number">$0C50</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[KeyHistory]</span>                  <span class="hljs-comment" color="#6a737d">; update key history with newly pressed keys</span></span>
<a name="user-content-0C54" href="#user-content-0C54" color="#6e7781" class="line-number">$0C54</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                             <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0C55" href="#user-content-0C55" color="#6e7781" class="line-number">$0C55</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[KeyHistory]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                  <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0C59" href="#user-content-0C59" color="#6e7781" class="line-number">$0C59</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">EX</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                             <span class="hljs-comment" color="#6a737d">; (after EX) A=new keys, B=updated key history</span></span>
<a name="user-content-0C5A" href="#user-content-0C5A" color="#6e7781" class="line-number">$0C5A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                             <span class="hljs-comment" color="#6a737d">; if any new keys were pressed</span></span>
<a name="user-content-0C5B" href="#user-content-0C5B" color="#6e7781" class="line-number">$0C5B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-gss__ml__no_new_keys" class="hljs-variable" color="#005cc5">gss__ml__no_new_keys</a></span>
<a name="user-content-0C5D" href="#user-content-0C5D" color="#6e7781" class="line-number">$0C5D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[IY]</span>, <span class="hljs-number" color="#005cc5">#13</span>                        <span class="hljs-comment" color="#6a737d">; start cooldown at 13 frames</span></span>
<a name="user-content-0C5F" href="#user-content-0C5F" color="#6e7781" class="line-number">$0C5F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <a href="#user-content-gss__ml__continue" class="hljs-variable" color="#005cc5">gss__ml__continue</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-gss__ml__no_new_keys"><a href="#user-content-gss__ml__no_new_keys" class="hljs-symbol" color="#e36209">gss__ml__no_new_keys</a>:</span>
<a name="user-content-0C61" href="#user-content-0C61" color="#6e7781" class="line-number">$0C61</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">H</span>                             <span class="hljs-comment" color="#6a737d">; if we&#x27;re still pressing a key we&#x27;ve (ever) pressed before</span></span>
<a name="user-content-0C62" href="#user-content-0C62" color="#6e7781" class="line-number">$0C62</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                            <span class="hljs-comment" color="#6a737d">; (including any pressed this frame),</span></span>
<a name="user-content-0C63" href="#user-content-0C63" color="#6e7781" class="line-number">$0C63</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-gss__ml__wait_for_keyup" class="hljs-variable" color="#005cc5">gss__ml__wait_for_keyup</a></span>
<a name="user-content-0C65" href="#user-content-0C65" color="#6e7781" class="line-number">$0C65</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span>[IY]</span>                          <span class="hljs-comment" color="#6a737d">; decrement cooldown</span></span>
<a name="user-content-0C66" href="#user-content-0C66" color="#6e7781" class="line-number">$0C66</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DEC</span> <span class="hljs-variable language_" color="#d73a49">B</span>                               <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0C67" href="#user-content-0C67" color="#6e7781" class="line-number">$0C67</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[IY]</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                          <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0C68" href="#user-content-0C68" color="#6e7781" class="line-number">$0C68</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-gss__ml__wait_for_keyup" class="hljs-variable" color="#005cc5">gss__ml__wait_for_keyup</a>     <span class="hljs-comment" color="#6a737d">; and wait until we&#x27;re not</span></span>
<a name="user-content-0C6A" href="#user-content-0C6A" color="#6e7781" class="line-number">$0C6A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[IY]</span>, <span class="hljs-number" color="#005cc5">#5</span>                         <span class="hljs-comment" color="#6a737d">; reset cooldown to 5 frames</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-gss__ml__continue"><a href="#user-content-gss__ml__continue" class="hljs-symbol" color="#e36209">gss__ml__continue</a>:</span>
<a name="user-content-0C6C" href="#user-content-0C6C" color="#6e7781" class="line-number">$0C6C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-gss__check_keys" class="hljs-variable" color="#005cc5">gss__check_keys</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-gss__ml__wait_for_keyup"><a href="#user-content-gss__ml__wait_for_keyup" class="hljs-symbol" color="#e36209">gss__ml__wait_for_keyup</a>:</span>
<a name="user-content-0C6F" href="#user-content-0C6F" color="#6e7781" class="line-number">$0C6F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <a href="#user-content-gss__main_loop" class="hljs-variable" color="#005cc5">gss__main_loop</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-gss__check_keys"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-gss__check_keys" class="hljs-symbol" color="#e36209">gss__check_keys</a>:</span>
<a name="user-content-0C71" href="#user-content-0C71" color="#6e7781" class="line-number">$0C71</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#05h</span>                         <span class="hljs-comment" color="#6a737d">; check if A or C was pressed</span></span>
<a name="user-content-0C73" href="#user-content-0C73" color="#6e7781" class="line-number">$0C73</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-gss__ck__back" class="hljs-variable" color="#005cc5">gss__ck__back</a></span>
<a name="user-content-0C75" href="#user-content-0C75" color="#6e7781" class="line-number">$0C75</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">H</span>, <span class="hljs-number" color="#005cc5">#0</span>                            <span class="hljs-comment" color="#6a737d">; divide selected row tile index</span></span>
<a name="user-content-0C77" href="#user-content-0C77" color="#6e7781" class="line-number">$0C77</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#12</span>                           <span class="hljs-comment" color="#6a737d">; ...by the screen width</span></span>
<a name="user-content-0C79" href="#user-content-0C79" color="#6e7781" class="line-number">$0C79</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DIV</span>                                <span class="hljs-comment" color="#6a737d">; ...to get the game index</span></span>
<a name="user-content-0C7B" href="#user-content-0C7B" color="#6e7781" class="line-number">$0C7B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">L</span>                             <span class="hljs-comment" color="#6a737d">; ...and store it in A</span></span>
<a name="user-content-0C7C" href="#user-content-0C7C" color="#6e7781" class="line-number">$0C7C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:80h]</span>, <span class="hljs-number" color="#005cc5">#~08h</span>                 <span class="hljs-comment" color="#6a737d">; disable LCD controller</span></span>
<a name="user-content-0C7F" href="#user-content-0C7F" color="#6e7781" class="line-number">$0C7F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IY</span>, <span class="hljs-number" color="#005cc5">#BlankTilemap</span>                <span class="hljs-comment" color="#6a737d">; load the blank tilemap</span></span>
<a name="user-content-0C82" href="#user-content-0C82" color="#6e7781" class="line-number">$0C82</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-load_tilemap" class="hljs-variable" color="#005cc5">load_tilemap</a>                   <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0C85" href="#user-content-0C85" color="#6e7781" class="line-number">$0C85</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-copy_one_frame" class="hljs-variable" color="#005cc5">copy_one_frame</a>                 <span class="hljs-comment" color="#6a737d">; draw it to screen</span></span>
<a name="user-content-0C88" href="#user-content-0C88" color="#6e7781" class="line-number">$0C88</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <a href="#user-content-run_selected_game" class="hljs-variable" color="#005cc5">run_selected_game</a>               <span class="hljs-comment" color="#6a737d">; boot the game</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-gss__ck__back"><a href="#user-content-gss__ck__back" class="hljs-symbol" color="#e36209">gss__ck__back</a>:</span>
<a name="user-content-0C8B" href="#user-content-0C8B" color="#6e7781" class="line-number">$0C8B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#82h</span>                         <span class="hljs-comment" color="#6a737d">; check if power or B button was pressed</span></span>
<a name="user-content-0C8D" href="#user-content-0C8D" color="#6e7781" class="line-number">$0C8D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-gss__ck__up" class="hljs-variable" color="#005cc5">gss__ck__up</a></span>
<a name="user-content-0C8F" href="#user-content-0C8F" color="#6e7781" class="line-number">$0C8F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <a href="#user-content-shutdown" class="hljs-variable" color="#005cc5">shutdown</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-gss__ck__up"><a href="#user-content-gss__ck__up" class="hljs-symbol" color="#e36209">gss__ck__up</a>:</span>
<a name="user-content-0C92" href="#user-content-0C92" color="#6e7781" class="line-number">$0C92</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#08h</span>                         <span class="hljs-comment" color="#6a737d">; check if up button was pressed</span></span>
<a name="user-content-0C94" href="#user-content-0C94" color="#6e7781" class="line-number">$0C94</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-gss__ck__down" class="hljs-variable" color="#005cc5">gss__ck__down</a></span>
<a name="user-content-0C96" href="#user-content-0C96" color="#6e7781" class="line-number">$0C96</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">L</span>                             <span class="hljs-comment" color="#6a737d">; if selected row tile index</span></span>
<a name="user-content-0C97" href="#user-content-0C97" color="#6e7781" class="line-number">$0C97</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                             <span class="hljs-comment" color="#6a737d">; ...is not the first row,</span></span>
<a name="user-content-0C98" href="#user-content-0C98" color="#6e7781" class="line-number">$0C98</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-gss__ck__return" class="hljs-variable" color="#005cc5">gss__ck__return</a></span>
<a name="user-content-0C9A" href="#user-content-0C9A" color="#6e7781" class="line-number">$0C9A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">SUB</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#12</span>                          <span class="hljs-comment" color="#6a737d">; then move the cursor up 1 row (12 tiles)</span></span>
<a name="user-content-0C9C" href="#user-content-0C9C" color="#6e7781" class="line-number">$0C9C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">L</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                             <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0C9D" href="#user-content-0C9D" color="#6e7781" class="line-number">$0C9D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                             <span class="hljs-comment" color="#6a737d">; if it&#x27;s the first now,</span></span>
<a name="user-content-0C9E" href="#user-content-0C9E" color="#6e7781" class="line-number">$0C9E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[IX]</span>                          <span class="hljs-comment" color="#6a737d">; (A = CurrentRowStart)</span></span>
<a name="user-content-0C9F" href="#user-content-0C9F" color="#6e7781" class="line-number">$0C9F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-gss__ck__redraw2" class="hljs-variable" color="#005cc5">gss__ck__redraw2</a>             <span class="hljs-comment" color="#6a737d">; then redraw</span></span>
<a name="user-content-0CA1" href="#user-content-0CA1" color="#6e7781" class="line-number">$0CA1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span class="hljs-variable language_" color="#d73a49">L</span>                             <span class="hljs-comment" color="#6a737d">; if the top visible row changed,</span></span>
<a name="user-content-0CA2" href="#user-content-0CA2" color="#6e7781" class="line-number">$0CA2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                             <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0CA3" href="#user-content-0CA3" color="#6e7781" class="line-number">$0CA3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-gss__ck__redraw2" class="hljs-variable" color="#005cc5">gss__ck__redraw2</a>            <span class="hljs-comment" color="#6a737d">; then redraw</span></span>
<a name="user-content-0CA5" href="#user-content-0CA5" color="#6e7781" class="line-number">$0CA5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">SUB</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#12</span>                          <span class="hljs-comment" color="#6a737d">; otherwise, move the top up one</span></span>
<a name="user-content-0CA7" href="#user-content-0CA7" color="#6e7781" class="line-number">$0CA7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[IX]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                          <span class="hljs-comment" color="#6a737d">; ...</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-gss__ck__redraw2"><a href="#user-content-gss__ck__redraw2" class="hljs-symbol" color="#e36209">gss__ck__redraw2</a>:</span>
<a name="user-content-0CA8" href="#user-content-0CA8" color="#6e7781" class="line-number">$0CA8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <a href="#user-content-gss__ck__redraw" class="hljs-variable" color="#005cc5">gss__ck__redraw</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-gss__ck__down"><a href="#user-content-gss__ck__down" class="hljs-symbol" color="#e36209">gss__ck__down</a>:</span>
<a name="user-content-0CAA" href="#user-content-0CAA" color="#6e7781" class="line-number">$0CAA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#10h</span>                         <span class="hljs-comment" color="#6a737d">; check if down button was pressed</span></span>
<a name="user-content-0CAC" href="#user-content-0CAC" color="#6e7781" class="line-number">$0CAC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-gss__ck__return" class="hljs-variable" color="#005cc5">gss__ck__return</a></span>
<a name="user-content-0CAE" href="#user-content-0CAE" color="#6e7781" class="line-number">$0CAE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">L</span>                             <span class="hljs-comment" color="#6a737d">; if the selected row</span></span>
<a name="user-content-0CAF" href="#user-content-0CAF" color="#6e7781" class="line-number">$0CAF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span>[FinalNameRowStart]</span>           <span class="hljs-comment" color="#6a737d">; ...is not the final row,</span></span>
<a name="user-content-0CB3" href="#user-content-0CB3" color="#6e7781" class="line-number">$0CB3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                             <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0CB4" href="#user-content-0CB4" color="#6e7781" class="line-number">$0CB4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-gss__ck__return" class="hljs-variable" color="#005cc5">gss__ck__return</a></span>
<a name="user-content-0CB6" href="#user-content-0CB6" color="#6e7781" class="line-number">$0CB6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">ADD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#12</span>                          <span class="hljs-comment" color="#6a737d">; then move the cursor down 1 row (12 tiles)</span></span>
<a name="user-content-0CB8" href="#user-content-0CB8" color="#6e7781" class="line-number">$0CB8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">L</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                             <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0CB9" href="#user-content-0CB9" color="#6e7781" class="line-number">$0CB9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                             <span class="hljs-comment" color="#6a737d">; if it&#x27;s now the final row,</span></span>
<a name="user-content-0CBA" href="#user-content-0CBA" color="#6e7781" class="line-number">$0CBA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[IX]</span>                          <span class="hljs-comment" color="#6a737d">; (A = CurrentRowStart)</span></span>
<a name="user-content-0CBB" href="#user-content-0CBB" color="#6e7781" class="line-number">$0CBB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-gss__ck__redraw" class="hljs-variable" color="#005cc5">gss__ck__redraw</a>              <span class="hljs-comment" color="#6a737d">; then redraw</span></span>
<a name="user-content-0CBD" href="#user-content-0CBD" color="#6e7781" class="line-number">$0CBD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">ADD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[FinalNameRowStartMin48]</span>     <span class="hljs-comment" color="#6a737d">; otherwise if it&#x27;s at the bottom of the list,</span></span>
<a name="user-content-0CC0" href="#user-content-0CC0" color="#6e7781" class="line-number">$0CC0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span class="hljs-variable language_" color="#d73a49">L</span>                             <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0CC1" href="#user-content-0CC1" color="#6e7781" class="line-number">$0CC1</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                             <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0CC2" href="#user-content-0CC2" color="#6e7781" class="line-number">$0CC2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[IX]</span>                          <span class="hljs-comment" color="#6a737d">; (A = CurrentRowStart)</span></span>
<a name="user-content-0CC3" href="#user-content-0CC3" color="#6e7781" class="line-number">$0CC3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-gss__ck__redraw" class="hljs-variable" color="#005cc5">gss__ck__redraw</a></span>
<a name="user-content-0CC5" href="#user-content-0CC5" color="#6e7781" class="line-number">$0CC5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">ADD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#12</span>                          <span class="hljs-comment" color="#6a737d">; then move the top down 1 row</span></span>
<a name="user-content-0CC7" href="#user-content-0CC7" color="#6e7781" class="line-number">$0CC7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[IX]</span>, <span class="hljs-variable language_" color="#d73a49">A</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-gss__ck__redraw"><a href="#user-content-gss__ck__redraw" class="hljs-symbol" color="#e36209">gss__ck__redraw</a>:</span>
<a name="user-content-0CC8" href="#user-content-0CC8" color="#6e7781" class="line-number">$0CC8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-draw_game_names" class="hljs-variable" color="#005cc5">draw_game_names</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-gss__ck__return"><a href="#user-content-gss__ck__return" class="hljs-symbol" color="#e36209">gss__ck__return</a>:</span>
<a name="user-content-0CCB" href="#user-content-0CCB" color="#6e7781" class="line-number">$0CCB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-draw_game_names"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Arguments</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   L: selected row in tiles from absolute top of names</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   A: top of visible names as tile index</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-draw_game_names" class="hljs-symbol" color="#e36209">draw_game_names</a>:</span>
<a name="user-content-0CCC" href="#user-content-0CCC" color="#6e7781" class="line-number">$0CCC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-0CCD" href="#user-content-0CCD" color="#6e7781" class="line-number">$0CCD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">IX</span></span>
<a name="user-content-0CCE" href="#user-content-0CCE" color="#6e7781" class="line-number">$0CCE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">IY</span></span>
<a name="user-content-0CCF" href="#user-content-0CCF" color="#6e7781" class="line-number">$0CCF</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">H</span>, <span class="hljs-variable language_" color="#d73a49">L</span></span>
<a name="user-content-0CD0" href="#user-content-0CD0" color="#6e7781" class="line-number">$0CD0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IY</span>, <span class="hljs-number" color="#005cc5">#GameNamesMap</span>                <span class="hljs-comment" color="#6a737d">; game select tilemap, names section</span></span>
<a name="user-content-0CD3" href="#user-content-0CD3" color="#6e7781" class="line-number">$0CD3</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span class="hljs-number" color="#005cc5">#00h</span></span>
<a name="user-content-0CD5" href="#user-content-0CD5" color="#6e7781" class="line-number">$0CD5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">ADD</span> <span class="hljs-variable language_" color="#d73a49">IY</span>, <span class="hljs-variable language_" color="#d73a49">BA</span>                          <span class="hljs-comment" color="#6a737d">; scroll to top of screen</span></span>
<a name="user-content-0CD7" href="#user-content-0CD7" color="#6e7781" class="line-number">$0CD7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-load_middle_5_tilemap" class="hljs-variable" color="#005cc5">load_middle_5_tilemap</a>          <span class="hljs-comment" color="#6a737d">; draw names</span></span>
<a name="user-content-0CDA" href="#user-content-0CDA" color="#6e7781" class="line-number">$0CDA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IY</span>, <span class="hljs-number" color="#005cc5">#1372h</span>                       <span class="hljs-comment" color="#6a737d">; tile 18 (6,1)</span></span>
<a name="user-content-0CDD" href="#user-content-0CDD" color="#6e7781" class="line-number">$0CDD</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                             <span class="hljs-comment" color="#6a737d">; if a is at the top,</span></span>
<a name="user-content-0CDE" href="#user-content-0CDE" color="#6e7781" class="line-number">$0CDE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-dgn__list_is_at_top" class="hljs-variable" color="#005cc5">dgn__list_is_at_top</a>          <span class="hljs-comment" color="#6a737d">; don&#x27;t show an up arrow</span></span>
<a name="user-content-0CE0" href="#user-content-0CE0" color="#6e7781" class="line-number">$0CE0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[IY]</span>, <span class="hljs-number" color="#005cc5">#21h</span>                       <span class="hljs-comment" color="#6a737d">; draw &quot;up arrow with line above&quot; tile</span></span>
<a name="user-content-0CE2" href="#user-content-0CE2" color="#6e7781" class="line-number">$0CE2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <a href="#user-content-dgn__check_list_bottom" class="hljs-variable" color="#005cc5">dgn__check_list_bottom</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-dgn__list_is_at_top"><a href="#user-content-dgn__list_is_at_top" class="hljs-symbol" color="#e36209">dgn__list_is_at_top</a>:</span>
<a name="user-content-0CE4" href="#user-content-0CE4" color="#6e7781" class="line-number">$0CE4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[IY]</span>, <span class="hljs-number" color="#005cc5">#1Fh</span>                       <span class="hljs-comment" color="#6a737d">; draw &quot;line above without arrow&quot; tile</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-dgn__check_list_bottom"><a href="#user-content-dgn__check_list_bottom" class="hljs-symbol" color="#e36209">dgn__check_list_bottom</a>:</span>
<a name="user-content-0CE6" href="#user-content-0CE6" color="#6e7781" class="line-number">$0CE6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span class="hljs-variable language_" color="#d73a49">A</span></span>
<a name="user-content-0CE7" href="#user-content-0CE7" color="#6e7781" class="line-number">$0CE7</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">ADD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[FinalNameRowStartMin48]</span>     <span class="hljs-comment" color="#6a737d">; add visible rows (up to 12*4=48)</span></span>
<a name="user-content-0CEA" href="#user-content-0CEA" color="#6e7781" class="line-number">$0CEA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IY</span>, <span class="hljs-number" color="#005cc5">#13BAh</span>                       <span class="hljs-comment" color="#6a737d">; tile 90 (6,7)</span></span>
<a name="user-content-0CED" href="#user-content-0CED" color="#6e7781" class="line-number">$0CED</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[FinalNameRowStart]</span>           <span class="hljs-comment" color="#6a737d">; if that is the last row,</span></span>
<a name="user-content-0CF0" href="#user-content-0CF0" color="#6e7781" class="line-number">$0CF0</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-dgn__list_is_at_bottom" class="hljs-variable" color="#005cc5">dgn__list_is_at_bottom</a>       <span class="hljs-comment" color="#6a737d">; don&#x27;t show a down arrow</span></span>
<a name="user-content-0CF2" href="#user-content-0CF2" color="#6e7781" class="line-number">$0CF2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[IY]</span>, <span class="hljs-number" color="#005cc5">#2Ch</span>                       <span class="hljs-comment" color="#6a737d">; draw &quot;down arrow with line below&quot; tile</span></span>
<a name="user-content-0CF4" href="#user-content-0CF4" color="#6e7781" class="line-number">$0CF4</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <a href="#user-content-dgn__draw_cursor" class="hljs-variable" color="#005cc5">dgn__draw_cursor</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-dgn__list_is_at_bottom"><a href="#user-content-dgn__list_is_at_bottom" class="hljs-symbol" color="#e36209">dgn__list_is_at_bottom</a>:</span>
<a name="user-content-0CF6" href="#user-content-0CF6" color="#6e7781" class="line-number">$0CF6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[IY]</span>, <span class="hljs-number" color="#005cc5">#2Ah</span>                       <span class="hljs-comment" color="#6a737d">; draw &quot;line below without arrow&quot; tile</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-dgn__draw_cursor"><a href="#user-content-dgn__draw_cursor" class="hljs-symbol" color="#e36209">dgn__draw_cursor</a>:</span>
<a name="user-content-0CF8" href="#user-content-0CF8" color="#6e7781" class="line-number">$0CF8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">H</span>                             <span class="hljs-comment" color="#6a737d">; calculate position of selection arrow</span></span>
<a name="user-content-0CF9" href="#user-content-0CF9" color="#6e7781" class="line-number">$0CF9</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">SUB</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                            <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0CFA" href="#user-content-0CFA" color="#6e7781" class="line-number">$0CFA</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">ADD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#01h</span>                         <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0CFC" href="#user-content-0CFC" color="#6e7781" class="line-number">$0CFC</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span class="hljs-number" color="#005cc5">#00h</span>                          <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0CFE" href="#user-content-0CFE" color="#6e7781" class="line-number">$0CFE</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">ADD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-variable language_" color="#d73a49">BA</span>                          <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0D00" href="#user-content-0D00" color="#6e7781" class="line-number">$0D00</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[IX]</span>, <span class="hljs-number" color="#005cc5">#0Bh</span>                       <span class="hljs-comment" color="#6a737d">; draw selection arrow tile</span></span>
<a name="user-content-0D02" href="#user-content-0D02" color="#6e7781" class="line-number">$0D02</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:80h]</span>, <span class="hljs-number" color="#005cc5">#08h</span>                   <span class="hljs-comment" color="#6a737d">; re-enable frame copy</span></span>
<a name="user-content-0D05" href="#user-content-0D05" color="#6e7781" class="line-number">$0D05</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">IY</span></span>
<a name="user-content-0D06" href="#user-content-0D06" color="#6e7781" class="line-number">$0D06</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">IX</span></span>
<a name="user-content-0D07" href="#user-content-0D07" color="#6e7781" class="line-number">$0D07</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-0D08" href="#user-content-0D08" color="#6e7781" class="line-number">$0D08</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-play_animation"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Arguments:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   IX: start of animation footer</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   IY: start of animation data</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Returns:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   Z: 0=animation ended, 1=key pressed</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   A: 0=animation ended, otherwise keys that were pressed</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Clobbers: B, HL</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-play_animation" class="hljs-symbol" color="#e36209">play_animation</a>:</span>
<a name="user-content-0D09" href="#user-content-0D09" color="#6e7781" class="line-number">$0D09</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">IX</span></span>
<a name="user-content-0D0A" href="#user-content-0D0A" color="#6e7781" class="line-number">$0D0A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">IY</span></span>
<a name="user-content-0D0B" href="#user-content-0D0B" color="#6e7781" class="line-number">$0D0B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IY</span>, <span class="hljs-number" color="#005cc5">#BlankTilemap</span></span>
<a name="user-content-0D0E" href="#user-content-0D0E" color="#6e7781" class="line-number">$0D0E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-load_tilemap" class="hljs-variable" color="#005cc5">load_tilemap</a></span>
<a name="user-content-0D11" href="#user-content-0D11" color="#6e7781" class="line-number">$0D11</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">IY</span></span>
<a name="user-content-0D12" href="#user-content-0D12" color="#6e7781" class="line-number">$0D12</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">IX</span>                              <span class="hljs-comment" color="#6a737d">; read in the footer</span></span>
<a name="user-content-0D13" href="#user-content-0D13" color="#6e7781" class="line-number">$0D13</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[IX]</span>                          <span class="hljs-comment" color="#6a737d">; length in rendered frames (lo byte)</span></span>
<a name="user-content-0D14" href="#user-content-0D14" color="#6e7781" class="line-number">$0D14</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">IX</span>                              <span class="hljs-comment" color="#6a737d">; size in bytes of animation info</span></span>
<a name="user-content-0D15" href="#user-content-0D15" color="#6e7781" class="line-number">$0D15</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span>[IX]</span>                          <span class="hljs-comment" color="#6a737d">; and 1 hi bit for length</span></span>
<a name="user-content-0D16" href="#user-content-0D16" color="#6e7781" class="line-number">$0D16</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">SRL</span> <span class="hljs-variable language_" color="#d73a49">B</span>                               <span class="hljs-comment" color="#6a737d">; put length&#x27;s hi bit in C</span></span>
<a name="user-content-0D18" href="#user-content-0D18" color="#6e7781" class="line-number">$0D18</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">L</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                             <span class="hljs-comment" color="#6a737d">; store the size in L</span></span>
<a name="user-content-0D19" href="#user-content-0D19" color="#6e7781" class="line-number">$0D19</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span class="hljs-number" color="#005cc5">#00h</span>                          <span class="hljs-comment" color="#6a737d">; put hi bit of total frame count back into b</span></span>
<a name="user-content-0D1B" href="#user-content-0D1B" color="#6e7781" class="line-number">$0D1B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RL</span> <span class="hljs-variable language_" color="#d73a49">B</span>                                <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0D1D" href="#user-content-0D1D" color="#6e7781" class="line-number">$0D1D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-number" color="#005cc5">#TotalAnimFrames</span>             <span class="hljs-comment" color="#6a737d">; store total frame count</span></span>
<a name="user-content-0D20" href="#user-content-0D20" color="#6e7781" class="line-number">$0D20</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[IX]</span>, <span class="hljs-variable language_" color="#d73a49">BA</span>                         <span class="hljs-comment" color="#6a737d">; ...as remaining frames to render</span></span>
<a name="user-content-0D22" href="#user-content-0D22" color="#6e7781" class="line-number">$0D22</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:27h]</span>, <span class="hljs-number" color="#005cc5">#40h</span>                   <span class="hljs-comment" color="#6a737d">; clear frame divider overflow</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-pa__wait_for_framediv_overflow"><a href="#user-content-pa__wait_for_framediv_overflow" class="hljs-symbol" color="#e36209">pa__wait_for_framediv_overflow</a>:</span>
<a name="user-content-0D25" href="#user-content-0D25" color="#6e7781" class="line-number">$0D25</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:27h]</span>, <span class="hljs-number" color="#005cc5">#40h</span></span>
<a name="user-content-0D28" href="#user-content-0D28" color="#6e7781" class="line-number">$0D28</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-pa__wait_for_framediv_overflow" class="hljs-variable" color="#005cc5">pa__wait_for_framediv_overflow</a></span>
<a name="user-content-0D2A" href="#user-content-0D2A" color="#6e7781" class="line-number">$0D2A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:27h]</span>, <span class="hljs-number" color="#005cc5">#40h</span>                   <span class="hljs-comment" color="#6a737d">; clear frame divider overflow</span></span>
<a name="user-content-0D2D" href="#user-content-0D2D" color="#6e7781" class="line-number">$0D2D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[BR:52h]</span>                      <span class="hljs-comment" color="#6a737d">; take cpl of keymap (so 1=pressed)</span></span>
<a name="user-content-0D2F" href="#user-content-0D2F" color="#6e7781" class="line-number">$0D2F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CPL</span> <span class="hljs-variable language_" color="#d73a49">A</span>                               <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0D31" href="#user-content-0D31" color="#6e7781" class="line-number">$0D31</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">H</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                             <span class="hljs-comment" color="#6a737d">; ...into H</span></span>
<a name="user-content-0D32" href="#user-content-0D32" color="#6e7781" class="line-number">$0D32</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">L</span>                              <span class="hljs-comment" color="#6a737d">; backup size of animation data</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-pa__read_loop"><a href="#user-content-pa__read_loop" class="hljs-symbol" color="#e36209">pa__read_loop</a>:</span>
<a name="user-content-0D34" href="#user-content-0D34" color="#6e7781" class="line-number">$0D34</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DEC</span> <span class="hljs-variable language_" color="#d73a49">L</span>                               <span class="hljs-comment" color="#6a737d">; reading bytes right-to-left</span></span>
<a name="user-content-0D35" href="#user-content-0D35" color="#6e7781" class="line-number">$0D35</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span>[IY+L]</span>                        <span class="hljs-comment" color="#6a737d">; frame count + hi bit of addr</span></span>
<a name="user-content-0D37" href="#user-content-0D37" color="#6e7781" class="line-number">$0D37</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DEC</span> <span class="hljs-variable language_" color="#d73a49">L</span></span>
<a name="user-content-0D38" href="#user-content-0D38" color="#6e7781" class="line-number">$0D38</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[IY+L]</span>                        <span class="hljs-comment" color="#6a737d">; map address offset (lo)</span></span>
<a name="user-content-0D3A" href="#user-content-0D3A" color="#6e7781" class="line-number">$0D3A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-pa__not_done_reading" class="hljs-variable" color="#005cc5">pa__not_done_reading</a></span>
<a name="user-content-0D3C" href="#user-content-0D3C" color="#6e7781" class="line-number">$0D3C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">L</span>                               <span class="hljs-comment" color="#6a737d">; return to first frame if we finished reading</span></span>
<a name="user-content-0D3E" href="#user-content-0D3E" color="#6e7781" class="line-number">$0D3E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">L</span>                              <span class="hljs-comment" color="#6a737d">; ...</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-pa__not_done_reading"><a href="#user-content-pa__not_done_reading" class="hljs-symbol" color="#e36209">pa__not_done_reading</a>:</span>
<a name="user-content-0D40" href="#user-content-0D40" color="#6e7781" class="line-number">$0D40</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">SRL</span> <span class="hljs-variable language_" color="#d73a49">B</span></span>
<a name="user-content-0D42" href="#user-content-0D42" color="#6e7781" class="line-number">$0D42</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[FramesRemaining]</span>, <span class="hljs-variable language_" color="#d73a49">B</span>             <span class="hljs-comment" color="#6a737d">; store frame count here</span></span>
<a name="user-content-0D46" href="#user-content-0D46" color="#6e7781" class="line-number">$0D46</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span class="hljs-number" color="#005cc5">#00h</span>                          <span class="hljs-comment" color="#6a737d">; map address offset hi bit back into b</span></span>
<a name="user-content-0D48" href="#user-content-0D48" color="#6e7781" class="line-number">$0D48</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RL</span> <span class="hljs-variable language_" color="#d73a49">B</span>                                <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0D4A" href="#user-content-0D4A" color="#6e7781" class="line-number">$0D4A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<a name="user-content-0D4B" href="#user-content-0D4B" color="#6e7781" class="line-number">$0D4B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">IX</span></span>
<a name="user-content-0D4C" href="#user-content-0D4C" color="#6e7781" class="line-number">$0D4C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">IY</span></span>
<a name="user-content-0D4D" href="#user-content-0D4D" color="#6e7781" class="line-number">$0D4D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IY</span>, <span class="hljs-number" color="#005cc5">#InsertCartMaps</span>              <span class="hljs-comment" color="#6a737d">; load selected frame</span></span>
<a name="user-content-0D50" href="#user-content-0D50" color="#6e7781" class="line-number">$0D50</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">ADD</span> <span class="hljs-variable language_" color="#d73a49">IY</span>, <span class="hljs-variable language_" color="#d73a49">BA</span>                          <span class="hljs-comment" color="#6a737d">; offset from the base address</span></span>
<a name="user-content-0D52" href="#user-content-0D52" color="#6e7781" class="line-number">$0D52</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-load_middle_5_tilemap" class="hljs-variable" color="#005cc5">load_middle_5_tilemap</a></span>
<a name="user-content-0D55" href="#user-content-0D55" color="#6e7781" class="line-number">$0D55</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:80h]</span>, <span class="hljs-number" color="#005cc5">#08h</span>                   <span class="hljs-comment" color="#6a737d">; enable LCD controller</span></span>
<a name="user-content-0D58" href="#user-content-0D58" color="#6e7781" class="line-number">$0D58</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">IY</span></span>
<a name="user-content-0D59" href="#user-content-0D59" color="#6e7781" class="line-number">$0D59</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">IX</span></span>
<a name="user-content-0D5A" href="#user-content-0D5A" color="#6e7781" class="line-number">$0D5A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">HL</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-pa__draw_again"><a href="#user-content-pa__draw_again" class="hljs-symbol" color="#e36209">pa__draw_again</a>:</span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-pa__wait_for_framediv_overflow2"><a href="#user-content-pa__wait_for_framediv_overflow2" class="hljs-symbol" color="#e36209">pa__wait_for_framediv_overflow2</a>:</span>
<a name="user-content-0D5B" href="#user-content-0D5B" color="#6e7781" class="line-number">$0D5B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:27h]</span>, <span class="hljs-number" color="#005cc5">#40h</span></span>
<a name="user-content-0D5E" href="#user-content-0D5E" color="#6e7781" class="line-number">$0D5E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-pa__wait_for_framediv_overflow2" class="hljs-variable" color="#005cc5">pa__wait_for_framediv_overflow2</a></span>
<a name="user-content-0D60" href="#user-content-0D60" color="#6e7781" class="line-number">$0D60</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[BR:27h]</span>, <span class="hljs-number" color="#005cc5">#40h</span>                   <span class="hljs-comment" color="#6a737d">; clear frame divider overflow</span></span>
<a name="user-content-0D63" href="#user-content-0D63" color="#6e7781" class="line-number">$0D63</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-init_display_without_wait" class="hljs-variable" color="#005cc5">init_display_without_wait</a></span>
<a name="user-content-0D66" href="#user-content-0D66" color="#6e7781" class="line-number">$0D66</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-apply_default_contrast1" class="hljs-variable" color="#005cc5">apply_default_contrast1</a></span>
<a name="user-content-0D69" href="#user-content-0D69" color="#6e7781" class="line-number">$0D69</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-read_keys_buffer" class="hljs-variable" color="#005cc5">read_keys_buffer</a>               <span class="hljs-comment" color="#6a737d">; read keys excluding anything pressed down since before animation started</span></span>
<a name="user-content-0D6C" href="#user-content-0D6C" color="#6e7781" class="line-number">$0D6C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#87h</span>                         <span class="hljs-comment" color="#6a737d">; if power, A, B, or C is being pressed,</span></span>
<a name="user-content-0D6E" href="#user-content-0D6E" color="#6e7781" class="line-number">$0D6E</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-pa__return" class="hljs-variable" color="#005cc5">pa__return</a>                  <span class="hljs-comment" color="#6a737d">; break</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-pa__continue_playing"><a href="#user-content-pa__continue_playing" class="hljs-symbol" color="#e36209">pa__continue_playing</a>:</span>
<a name="user-content-0D70" href="#user-content-0D70" color="#6e7781" class="line-number">$0D70</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">BA</span>, <span>[IX]</span>                         <span class="hljs-comment" color="#6a737d">; decrement total rendered frames remaining</span></span>
<a name="user-content-0D72" href="#user-content-0D72" color="#6e7781" class="line-number">$0D72</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DEC</span> <span class="hljs-variable language_" color="#d73a49">BA</span>                              <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0D73" href="#user-content-0D73" color="#6e7781" class="line-number">$0D73</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[IX]</span>, <span class="hljs-variable language_" color="#d73a49">BA</span>                         <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0D75" href="#user-content-0D75" color="#6e7781" class="line-number">$0D75</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-pa__return" class="hljs-variable" color="#005cc5">pa__return</a>                   <span class="hljs-comment" color="#6a737d">; break if none left</span></span>
<a name="user-content-0D77" href="#user-content-0D77" color="#6e7781" class="line-number">$0D77</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[FramesRemaining]</span>             <span class="hljs-comment" color="#6a737d">; decrement rendered frames remaining for this image</span></span>
<a name="user-content-0D7B" href="#user-content-0D7B" color="#6e7781" class="line-number">$0D7B</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DEC</span> <span class="hljs-variable language_" color="#d73a49">A</span>                               <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0D7C" href="#user-content-0D7C" color="#6e7781" class="line-number">$0D7C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[FramesRemaining]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>             <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0D80" href="#user-content-0D80" color="#6e7781" class="line-number">$0D80</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-pa__draw_again" class="hljs-variable" color="#005cc5">pa__draw_again</a>              <span class="hljs-comment" color="#6a737d">; if there&#x27;s more to render, keep drawing</span></span>
<a name="user-content-0D82" href="#user-content-0D82" color="#6e7781" class="line-number">$0D82</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <a href="#user-content-pa__read_loop" class="hljs-variable" color="#005cc5">pa__read_loop</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-pa__return"><a href="#user-content-pa__return" class="hljs-symbol" color="#e36209">pa__return</a>:</span>
<a name="user-content-0D84" href="#user-content-0D84" color="#6e7781" class="line-number">$0D84</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">POP</span> <span class="hljs-variable language_" color="#d73a49">B</span>                               <span class="hljs-comment" color="#6a737d">; first frame&#x27;s source addr offset</span></span>
<a name="user-content-0D86" href="#user-content-0D86" color="#6e7781" class="line-number">$0D86</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-low_battery_screen"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Play low battery animation and check key presses.</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; A/C -&gt; skip shutdown, play software anyway</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; B/Power -&gt; shutdown early</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Assumes XP/YP = $00</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Clobbers: BA, HL, IX, IY</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-low_battery_screen" class="hljs-symbol" color="#e36209">low_battery_screen</a>:</span>
<a name="user-content-0D87" href="#user-content-0D87" color="#6e7781" class="line-number">$0D87</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-number" color="#005cc5">#low_battery_animation_footer</span></span>
<a name="user-content-0D8A" href="#user-content-0D8A" color="#6e7781" class="line-number">$0D8A</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IY</span>, <span class="hljs-number" color="#005cc5">#low_battery_animation</span></span>
<a name="user-content-0D8D" href="#user-content-0D8D" color="#6e7781" class="line-number">$0D8D</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-play_animation" class="hljs-variable" color="#005cc5">play_animation</a></span>
<a name="user-content-0D90" href="#user-content-0D90" color="#6e7781" class="line-number">$0D90</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-lbs__skip_shutdown" class="hljs-variable" color="#005cc5">lbs__skip_shutdown</a>           <span class="hljs-comment" color="#6a737d">; if animation finished, don&#x27;t shutdown</span></span>
<a name="user-content-0D92" href="#user-content-0D92" color="#6e7781" class="line-number">$0D92</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#82h</span>                         <span class="hljs-comment" color="#6a737d">; if A or C was pressed,</span></span>
<a name="user-content-0D94" href="#user-content-0D94" color="#6e7781" class="line-number">$0D94</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-lbs__skip_shutdown" class="hljs-variable" color="#005cc5">lbs__skip_shutdown</a>           <span class="hljs-comment" color="#6a737d">; don&#x27;t shutdown</span></span>
<a name="user-content-0D96" href="#user-content-0D96" color="#6e7781" class="line-number">$0D96</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <a href="#user-content-shutdown" class="hljs-variable" color="#005cc5">shutdown</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-lbs__skip_shutdown"><a href="#user-content-lbs__skip_shutdown" class="hljs-symbol" color="#e36209">lbs__skip_shutdown</a>:</span>
<a name="user-content-0D99" href="#user-content-0D99" color="#6e7781" class="line-number">$0D99</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">AND</span> <span>[BR:80h]</span>, <span class="hljs-number" color="#005cc5">#~08h</span>                 <span class="hljs-comment" color="#6a737d">; disable LCD controller</span></span>
<a name="user-content-0D9C" href="#user-content-0D9C" color="#6e7781" class="line-number">$0D9C</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IY</span>, <span class="hljs-number" color="#005cc5">#BlankTilemap</span>                <span class="hljs-comment" color="#6a737d">; load blank screen for one frame</span></span>
<a name="user-content-0D9F" href="#user-content-0D9F" color="#6e7781" class="line-number">$0D9F</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-load_tilemap" class="hljs-variable" color="#005cc5">load_tilemap</a>                   <span class="hljs-comment" color="#6a737d">; ...</span></span>
<a name="user-content-0DA2" href="#user-content-0DA2" color="#6e7781" class="line-number">$0DA2</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-copy_one_frame" class="hljs-variable" color="#005cc5">copy_one_frame</a>                 <span class="hljs-comment" color="#6a737d">; ...force draws it despite the shutoff</span></span>
<a name="user-content-0DA5" href="#user-content-0DA5" color="#6e7781" class="line-number">$0DA5</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-insert_cart_screen"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Play low battery animation and check key presses.</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; A/C -&gt; check for cartridge again</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; B/Power -&gt; shutdown early</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Assumes XP/YP = $00</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Clobbers: any</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-insert_cart_screen" class="hljs-symbol" color="#e36209">insert_cart_screen</a>:</span>
<a name="user-content-0DA6" href="#user-content-0DA6" color="#6e7781" class="line-number">$0DA6</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">SC</span>, <span class="hljs-number" color="#005cc5">#0C0h</span>                        <span class="hljs-comment" color="#6a737d">; interrupt flags to NMI-only</span></span>
<a name="user-content-0DA8" href="#user-content-0DA8" color="#6e7781" class="line-number">$0DA8</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">OR</span> <span>[BR:71h]</span>, <span class="hljs-number" color="#005cc5">#04h</span>                   <span class="hljs-comment" color="#6a737d">; cart power off</span></span>
<a name="user-content-0DAB" href="#user-content-0DAB" color="#6e7781" class="line-number">$0DAB</a>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <a href="#user-content-insert_cart_animation_footer" class="hljs-variable" color="#005cc5">insert_cart_animation_footer</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IY</span>, <a href="#user-content-insert_cart_animation" class="hljs-variable" color="#005cc5">insert_cart_animation</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARL</span> <a href="#user-content-play_animation" class="hljs-variable" color="#005cc5">play_animation</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-ics__check_loop"><a href="#user-content-ics__check_loop" class="hljs-symbol" color="#e36209">ics__check_loop</a>:</span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-ics__shutdown" class="hljs-variable" color="#005cc5">ics__shutdown</a>                <span class="hljs-comment" color="#6a737d">; if animation finished, shutdown</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#82h</span>                         <span class="hljs-comment" color="#6a737d">; if power or B key was pressed,</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-ics__shutdown" class="hljs-variable" color="#005cc5">ics__shutdown</a>               <span class="hljs-comment" color="#6a737d">; shutdown</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">BIT</span> <span>[BR:53h]</span>, <span class="hljs-number" color="#005cc5">#02h</span>                  <span class="hljs-comment" color="#6a737d">; if card was inserted,</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <span class="hljs-literal" color="#005cc5">Z</span>, <a href="#user-content-_reset2" class="hljs-variable" color="#005cc5">_reset2</a>                      <span class="hljs-comment" color="#6a737d">; reset to boot it</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CARS</span> <a href="#user-content-ics__continue_playing" class="hljs-variable" color="#005cc5">ics__continue_playing</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <a href="#user-content-ics__check_loop" class="hljs-variable" color="#005cc5">ics__check_loop</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-ics__shutdown"><a href="#user-content-ics__shutdown" class="hljs-symbol" color="#e36209">ics__shutdown</a>:</span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <a href="#user-content-shutdown" class="hljs-variable" color="#005cc5">shutdown</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-ics__continue_playing"><a href="#user-content-ics__continue_playing" class="hljs-symbol" color="#e36209">ics__continue_playing</a>:</span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">PUSH</span> <span class="hljs-variable language_" color="#d73a49">B</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRL</span> <a href="#user-content-pa__continue_playing" class="hljs-variable" color="#005cc5">pa__continue_playing</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-decode_picture"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Decode encoded maps and graphics from imgdata to RAM</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Clobbers: BA, L, IX, IY</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-decode_picture" class="hljs-symbol" color="#e36209">decode_picture</a>:</span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IY</span>, <span class="hljs-number" color="#005cc5">#imgdata</span>                     <span class="hljs-comment" color="#6a737d">; source</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-number" color="#005cc5">#BlankTilemap</span>                <span class="hljs-comment" color="#6a737d">; destination</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-dp__loop"><a href="#user-content-dp__loop" class="hljs-symbol" color="#e36209">dp__loop</a>:</span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[IY]</span>                          <span class="hljs-comment" color="#6a737d">; read encoded byte</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">IY</span>                              <span class="hljs-comment" color="#6a737d">; increment offset</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#0F9h</span>                         <span class="hljs-comment" color="#6a737d">; compare value to 0xF9</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-dp__checkFB" class="hljs-variable" color="#005cc5">dp__checkFB</a>                 <span class="hljs-comment" color="#6a737d">; if it isn&#x27;t, jump</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span>[IY]</span>                          <span class="hljs-comment" color="#6a737d">; value after F9 is number of 0s to fill - 1</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">IY</span>                              <span class="hljs-comment" color="#6a737d">; inc offset</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">B</span>                               <span class="hljs-comment" color="#6a737d">; add 1 to find actual number of 0s</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">XOR</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                            <span class="hljs-comment" color="#6a737d">; set A to 0</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-dp__zero_fill_loop"><a href="#user-content-dp__zero_fill_loop" class="hljs-symbol" color="#e36209">dp__zero_fill_loop</a>:</span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[IX]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                          <span class="hljs-comment" color="#6a737d">; store 0 in destination offset</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">IX</span>                              <span class="hljs-comment" color="#6a737d">; inc dest offset</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DJR</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-dp__zero_fill_loop" class="hljs-variable" color="#005cc5">dp__zero_fill_loop</a>          <span class="hljs-comment" color="#6a737d">; dec B and loop if not 0</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <a href="#user-content-dp__continue" class="hljs-variable" color="#005cc5">dp__continue</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-dp__checkFB"><a href="#user-content-dp__checkFB" class="hljs-symbol" color="#e36209">dp__checkFB</a>:</span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span class="hljs-number" color="#005cc5">#0FBh</span>                         <span class="hljs-comment" color="#6a737d">; compare value to 0xFB</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-dp__raw_byte" class="hljs-variable" color="#005cc5">dp__raw_byte</a>                <span class="hljs-comment" color="#6a737d">; if it&#x27;s not, continue as normal byte to write</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[IY]</span>                          <span class="hljs-comment" color="#6a737d">; otherwise, store next source byte in A</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">IY</span>                              <span class="hljs-comment" color="#6a737d">; inc offset</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">B</span>, <span>[IY]</span>                          <span class="hljs-comment" color="#6a737d">; next source byte into B</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">IY</span>                              <span class="hljs-comment" color="#6a737d">; increment source offset</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">B</span>                               <span class="hljs-comment" color="#6a737d">; and B</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-dp__fill_loop"><a href="#user-content-dp__fill_loop" class="hljs-symbol" color="#e36209">dp__fill_loop</a>:</span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[IX]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                          <span class="hljs-comment" color="#6a737d">; store A in destination offset</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">IX</span>                              <span class="hljs-comment" color="#6a737d">; increment destination</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DJR</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-dp__fill_loop" class="hljs-variable" color="#005cc5">dp__fill_loop</a>               <span class="hljs-comment" color="#6a737d">; dec B and loop if not 0</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <a href="#user-content-dp__continue" class="hljs-variable" color="#005cc5">dp__continue</a>                    <span class="hljs-comment" color="#6a737d">; end of fill section</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-dp__raw_byte"><a href="#user-content-dp__raw_byte" class="hljs-symbol" color="#e36209">dp__raw_byte</a>:</span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[IX]</span>, <span class="hljs-variable language_" color="#d73a49">A</span>                          <span class="hljs-comment" color="#6a737d">; store A in destination offset</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">IX</span>                              <span class="hljs-comment" color="#6a737d">; increment destination offset</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-dp__continue"><a href="#user-content-dp__continue" class="hljs-symbol" color="#e36209">dp__continue</a>:</span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">IY</span>, <span class="hljs-number" color="#005cc5">#1000h</span>                       <span class="hljs-comment" color="#6a737d">; if not all 0x1C0 bytes have been decoded yet,</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-dp__loop" class="hljs-variable" color="#005cc5">dp__loop</a>                    <span class="hljs-comment" color="#6a737d">; go back to the decode loop</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-number" color="#005cc5">#VFlipStart</span>                  <span class="hljs-comment" color="#6a737d">; tile gfx for top left corner of game select border</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">IY</span>, <span class="hljs-number" color="#005cc5">#VFlippedTiles</span>               <span class="hljs-comment" color="#6a737d">; the first byte after the decoded data</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-dp__vflip_loop">    <span class="hljs-comment" color="#6a737d">; v-flip and append last 11 tiles</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-dp__vflip_loop" class="hljs-symbol" color="#e36209">dp__vflip_loop</a>:</span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">A</span>, <span>[IX]</span>                          <span class="hljs-comment" color="#6a737d">; load one byte of tile data</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span class="hljs-variable language_" color="#d73a49">L</span>, <span class="hljs-number" color="#005cc5">#8</span>                            <span class="hljs-comment" color="#6a737d">; 8 bits</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-dp__vflip_byte"><a href="#user-content-dp__vflip_byte" class="hljs-symbol" color="#e36209">dp__vflip_byte</a>:</span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RL</span> <span class="hljs-variable language_" color="#d73a49">A</span>                                <span class="hljs-comment" color="#6a737d">; pop top bit of tile data</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RR</span> <span class="hljs-variable language_" color="#d73a49">B</span>                                <span class="hljs-comment" color="#6a737d">; pushed onto top bit of B</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">DEC</span> <span class="hljs-variable language_" color="#d73a49">L</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-dp__vflip_byte" class="hljs-variable" color="#005cc5">dp__vflip_byte</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">LD</span> <span>[IY]</span>, <span class="hljs-variable language_" color="#d73a49">B</span>                          <span class="hljs-comment" color="#6a737d">; store flipped data</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">IX</span>                              <span class="hljs-comment" color="#6a737d">; next source addr</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">INC</span> <span class="hljs-variable language_" color="#d73a49">IY</span>                              <span class="hljs-comment" color="#6a737d">; next destination addr</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">CP</span> <span class="hljs-variable language_" color="#d73a49">IX</span>, <span class="hljs-number" color="#005cc5">#VFlippedTiles</span>               <span class="hljs-comment" color="#6a737d">; since they&#x27;re sequential, if IX makes it here we&#x27;re done flipping</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">JRS</span> <span class="hljs-literal" color="#005cc5">NZ</span>, <a href="#user-content-dp__vflip_loop" class="hljs-variable" color="#005cc5">dp__vflip_loop</a></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-keyword" color="#d73a49">RET</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-nintendo_string"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0FFh</span>, <span class="hljs-number" color="#005cc5">0FFh</span>, <span class="hljs-number" color="#005cc5">0FFh</span>, <span class="hljs-number" color="#005cc5">0FFh</span>, <span class="hljs-number" color="#005cc5">0FFh</span>, <span class="hljs-number" color="#005cc5">0FFh</span>, <span class="hljs-number" color="#005cc5">0FFh</span>, <span class="hljs-number" color="#005cc5">0FFh</span>, <span class="hljs-number" color="#005cc5">0FFh</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-nintendo_string" class="hljs-symbol" color="#e36209">nintendo_string</a>:</span>
<a name="user-content-0008" href="#user-content-0008" color="#6e7781" class="line-number">$0008</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">ASCII</span> <span class="hljs-string" color="#032f62">&quot;NINTENDO&quot;</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-low_battery_animation"><span class="hljs-comment" color="#6a737d">; ----------------------</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Format is backwards, starting at the right and going left.</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; Each image of the animation is two bytes of the form:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   map address (lo), 0bLLLLLLLH</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   L = length in rendered frames</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   H = map address (hi)</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; The map address is an offset from $1650</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; The footer is two bytes of the form:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   length (lo), 0bNNNNNNNH</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   N = number of bytes in the animation info</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">;   H = length (hi)</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-low_battery_animation" class="hljs-symbol" color="#e36209">low_battery_animation</a>:</span>
<a name="user-content-0010" href="#user-content-0010" color="#6e7781" class="line-number">$0010</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">68h</span>, <span class="hljs-number" color="#005cc5">6Fh</span>, <span class="hljs-number" color="#005cc5">0A4h</span>, <span class="hljs-number" color="#005cc5">13h</span>, <span class="hljs-number" color="#005cc5">68h</span>, <span class="hljs-number" color="#005cc5">13h</span>, <span class="hljs-number" color="#005cc5">0A4h</span>, <span class="hljs-number" color="#005cc5">13h</span>, <span class="hljs-number" color="#005cc5">68h</span>, <span class="hljs-number" color="#005cc5">13h</span>, <span class="hljs-number" color="#005cc5">0A4h</span>, <span class="hljs-number" color="#005cc5">13h</span>, <span class="hljs-number" color="#005cc5">68h</span>, <span class="hljs-number" color="#005cc5">13h</span>, <span class="hljs-number" color="#005cc5">2Ch</span>, <span class="hljs-number" color="#005cc5">13h</span></span>
<a name="user-content-0020" href="#user-content-0020" color="#6e7781" class="line-number">$0020</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0F0h</span>, <span class="hljs-number" color="#005cc5">12h</span>, <span class="hljs-number" color="#005cc5">0B4h</span>, <span class="hljs-number" color="#005cc5">12h</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-low_battery_animation_footer"><a href="#user-content-low_battery_animation_footer" class="hljs-symbol" color="#e36209">low_battery_animation_footer</a>:</span>
<a name="user-content-0024" href="#user-content-0024" color="#6e7781" class="line-number">$0024</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">98h</span>, <span class="hljs-number" color="#005cc5">29h</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-insert_cart_animation"><a href="#user-content-insert_cart_animation" class="hljs-symbol" color="#e36209">insert_cart_animation</a>:</span>
<a name="user-content-0026" href="#user-content-0026" color="#6e7781" class="line-number">$0026</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">78h</span>, <span class="hljs-number" color="#005cc5">0Ch</span>, <span class="hljs-number" color="#005cc5">3Ch</span>, <span class="hljs-number" color="#005cc5">18h</span>, <span class="hljs-number" color="#005cc5">00h</span>, <span class="hljs-number" color="#005cc5">3Ch</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-insert_cart_animation_footer"><a href="#user-content-insert_cart_animation_footer" class="hljs-symbol" color="#e36209">insert_cart_animation_footer</a>:</span>
<a name="user-content-002C" href="#user-content-002C" color="#6e7781" class="line-number">$002C</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">20h</span>, <span class="hljs-number" color="#005cc5">0Dh</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content" id="user-content-imgdata"><span class="hljs-comment" color="#6a737d">; Simple RLE compression algorithm:</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; 0xF9LL inserts LL+1 zeroes</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; 0xFBXXLL inserts the byte 0xXX LL+1 times</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><span class="hljs-comment" color="#6a737d">; otherwise it copies the raw byte</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"><a href="#user-content-imgdata" class="hljs-symbol" color="#e36209">imgdata</a>:</span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-comment" color="#6a737d">; Blank tilemap starting at $1530</span></span>
<a name="user-content-002E" href="#user-content-002E" color="#6e7781" class="line-number">$002E</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0F9h</span>, <span class="hljs-number" color="#005cc5">60h</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-comment" color="#6a737d">; Including one zero byte from above, the GAME SELECT screen&#x27;s rows 0,1,7</span></span>
<a name="user-content-0030" href="#user-content-0030" color="#6e7781" class="line-number">$0030</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span>        <span class="hljs-number" color="#005cc5">01h</span>, <span class="hljs-number" color="#005cc5">02h</span>, <span class="hljs-number" color="#005cc5">03h</span>, <span class="hljs-number" color="#005cc5">04h</span>, <span class="hljs-number" color="#005cc5">05h</span>, <span class="hljs-number" color="#005cc5">06h</span>, <span class="hljs-number" color="#005cc5">07h</span>, <span class="hljs-number" color="#005cc5">08h</span>, <span class="hljs-number" color="#005cc5">09h</span>, <span class="hljs-number" color="#005cc5">0Ah</span>, <span class="hljs-number" color="#005cc5">00h</span></span>
<a name="user-content-003B" href="#user-content-003B" color="#6e7781" class="line-number">$003B</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span>  <span class="hljs-number" color="#005cc5">1Eh</span>, <span class="hljs-number" color="#005cc5">0FBh</span>, <span class="hljs-number" color="#005cc5">1Fh</span>, <span class="hljs-number" color="#005cc5">09h</span>,                                    <span class="hljs-number" color="#005cc5">20h</span></span>
<a name="user-content-0040" href="#user-content-0040" color="#6e7781" class="line-number">$0040</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0F9h</span>,  <span class="hljs-number" color="#005cc5">3Bh</span></span>
<a name="user-content-0042" href="#user-content-0042" color="#6e7781" class="line-number">$0042</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span>  <span class="hljs-number" color="#005cc5">29h</span>, <span class="hljs-number" color="#005cc5">0FBh</span>, <span class="hljs-number" color="#005cc5">2Ah</span>, <span class="hljs-number" color="#005cc5">09h</span>,                                    <span class="hljs-number" color="#005cc5">2Bh</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-comment" color="#6a737d">; The GAME SELECT screen&#x27;s middle 5 rows (two pages?)</span></span>
<a name="user-content-0047" href="#user-content-0047" color="#6e7781" class="line-number">$0047</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0Ch</span>, <span class="hljs-number" color="#005cc5">00h</span>, <span class="hljs-number" color="#005cc5">34h</span>, <span class="hljs-number" color="#005cc5">35h</span>, <span class="hljs-number" color="#005cc5">36h</span>, <span class="hljs-number" color="#005cc5">37h</span>, <span class="hljs-number" color="#005cc5">38h</span>, <span class="hljs-number" color="#005cc5">39h</span>, <span class="hljs-number" color="#005cc5">3Ah</span>, <span class="hljs-number" color="#005cc5">3Bh</span>, <span class="hljs-number" color="#005cc5">3Ch</span>, <span class="hljs-number" color="#005cc5">0Dh</span></span>
<a name="user-content-0053" href="#user-content-0053" color="#6e7781" class="line-number">$0053</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0Ch</span>, <span class="hljs-number" color="#005cc5">00h</span>, <span class="hljs-number" color="#005cc5">3Dh</span>, <span class="hljs-number" color="#005cc5">3Eh</span>, <span class="hljs-number" color="#005cc5">3Fh</span>, <span class="hljs-number" color="#005cc5">40h</span>, <span class="hljs-number" color="#005cc5">41h</span>, <span class="hljs-number" color="#005cc5">42h</span>, <span class="hljs-number" color="#005cc5">43h</span>, <span class="hljs-number" color="#005cc5">44h</span>, <span class="hljs-number" color="#005cc5">45h</span>, <span class="hljs-number" color="#005cc5">0Dh</span></span>
<a name="user-content-005F" href="#user-content-005F" color="#6e7781" class="line-number">$005F</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0Ch</span>, <span class="hljs-number" color="#005cc5">00h</span>, <span class="hljs-number" color="#005cc5">46h</span>, <span class="hljs-number" color="#005cc5">47h</span>, <span class="hljs-number" color="#005cc5">48h</span>, <span class="hljs-number" color="#005cc5">49h</span>, <span class="hljs-number" color="#005cc5">4Ah</span>, <span class="hljs-number" color="#005cc5">4Bh</span>, <span class="hljs-number" color="#005cc5">4Ch</span>, <span class="hljs-number" color="#005cc5">4Dh</span>, <span class="hljs-number" color="#005cc5">4Eh</span>, <span class="hljs-number" color="#005cc5">0Dh</span></span>
<a name="user-content-006B" href="#user-content-006B" color="#6e7781" class="line-number">$006B</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0Ch</span>, <span class="hljs-number" color="#005cc5">00h</span>, <span class="hljs-number" color="#005cc5">4Fh</span>, <span class="hljs-number" color="#005cc5">50h</span>, <span class="hljs-number" color="#005cc5">51h</span>, <span class="hljs-number" color="#005cc5">52h</span>, <span class="hljs-number" color="#005cc5">53h</span>, <span class="hljs-number" color="#005cc5">54h</span>, <span class="hljs-number" color="#005cc5">55h</span>, <span class="hljs-number" color="#005cc5">56h</span>, <span class="hljs-number" color="#005cc5">57h</span>, <span class="hljs-number" color="#005cc5">0Dh</span></span>
<a name="user-content-0077" href="#user-content-0077" color="#6e7781" class="line-number">$0077</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0Ch</span>, <span class="hljs-number" color="#005cc5">00h</span>, <span class="hljs-number" color="#005cc5">58h</span>, <span class="hljs-number" color="#005cc5">59h</span>, <span class="hljs-number" color="#005cc5">5Ah</span>, <span class="hljs-number" color="#005cc5">5Bh</span>, <span class="hljs-number" color="#005cc5">5Ch</span>, <span class="hljs-number" color="#005cc5">5Dh</span>, <span class="hljs-number" color="#005cc5">5Eh</span>, <span class="hljs-number" color="#005cc5">5Fh</span>, <span class="hljs-number" color="#005cc5">60h</span>, <span class="hljs-number" color="#005cc5">0Dh</span></span>
<a name="user-content-0083" href="#user-content-0083" color="#6e7781" class="line-number">$0083</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0Ch</span>, <span class="hljs-number" color="#005cc5">00h</span>, <span class="hljs-number" color="#005cc5">61h</span>, <span class="hljs-number" color="#005cc5">62h</span>, <span class="hljs-number" color="#005cc5">63h</span>, <span class="hljs-number" color="#005cc5">64h</span>, <span class="hljs-number" color="#005cc5">65h</span>, <span class="hljs-number" color="#005cc5">66h</span>, <span class="hljs-number" color="#005cc5">67h</span>, <span class="hljs-number" color="#005cc5">68h</span>, <span class="hljs-number" color="#005cc5">69h</span>, <span class="hljs-number" color="#005cc5">0Dh</span></span>
<a name="user-content-008F" href="#user-content-008F" color="#6e7781" class="line-number">$008F</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0Ch</span>, <span class="hljs-number" color="#005cc5">00h</span>, <span class="hljs-number" color="#005cc5">6Ah</span>, <span class="hljs-number" color="#005cc5">6Bh</span>, <span class="hljs-number" color="#005cc5">6Ch</span>, <span class="hljs-number" color="#005cc5">6Dh</span>, <span class="hljs-number" color="#005cc5">6Eh</span>, <span class="hljs-number" color="#005cc5">6Fh</span>, <span class="hljs-number" color="#005cc5">70h</span>, <span class="hljs-number" color="#005cc5">71h</span>, <span class="hljs-number" color="#005cc5">72h</span>, <span class="hljs-number" color="#005cc5">0Dh</span></span>
<a name="user-content-009B" href="#user-content-009B" color="#6e7781" class="line-number">$009B</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0Ch</span>, <span class="hljs-number" color="#005cc5">00h</span>, <span class="hljs-number" color="#005cc5">73h</span>, <span class="hljs-number" color="#005cc5">74h</span>, <span class="hljs-number" color="#005cc5">75h</span>, <span class="hljs-number" color="#005cc5">76h</span>, <span class="hljs-number" color="#005cc5">77h</span>, <span class="hljs-number" color="#005cc5">78h</span>, <span class="hljs-number" color="#005cc5">79h</span>, <span class="hljs-number" color="#005cc5">7Ah</span>, <span class="hljs-number" color="#005cc5">7Bh</span>, <span class="hljs-number" color="#005cc5">0Dh</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-comment" color="#6a737d">; Insert cart animation maps</span></span>
<a name="user-content-00A7" href="#user-content-00A7" color="#6e7781" class="line-number">$00A7</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0F9h</span>, <span class="hljs-number" color="#005cc5">0Fh</span>, <span class="hljs-number" color="#005cc5">12h</span>, <span class="hljs-number" color="#005cc5">13h</span>, <span class="hljs-number" color="#005cc5">14h</span>, <span class="hljs-number" color="#005cc5">15h</span> <span class="hljs-comment" color="#6a737d">; Frame 1</span></span>
<a name="user-content-00AD" href="#user-content-00AD" color="#6e7781" class="line-number">$00AD</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0F9h</span>, <span class="hljs-number" color="#005cc5">07h</span>, <span class="hljs-number" color="#005cc5">16h</span>, <span class="hljs-number" color="#005cc5">17h</span>, <span class="hljs-number" color="#005cc5">18h</span>, <span class="hljs-number" color="#005cc5">19h</span></span>
<a name="user-content-00B3" href="#user-content-00B3" color="#6e7781" class="line-number">$00B3</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0F9h</span>, <span class="hljs-number" color="#005cc5">07h</span>, <span class="hljs-number" color="#005cc5">1Ah</span>, <span class="hljs-number" color="#005cc5">1Bh</span>, <span class="hljs-number" color="#005cc5">1Ch</span>, <span class="hljs-number" color="#005cc5">1Dh</span></span>
<a name="user-content-00B9" href="#user-content-00B9" color="#6e7781" class="line-number">$00B9</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0F9h</span>, <span class="hljs-number" color="#005cc5">14h</span>, <span class="hljs-number" color="#005cc5">0Eh</span>, <span class="hljs-number" color="#005cc5">0Fh</span>           <span class="hljs-comment" color="#6a737d">; Frame 2</span></span>
<a name="user-content-00BD" href="#user-content-00BD" color="#6e7781" class="line-number">$00BD</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0F9h</span>, <span class="hljs-number" color="#005cc5">08h</span>, <span class="hljs-number" color="#005cc5">12h</span>, <span class="hljs-number" color="#005cc5">13h</span>, <span class="hljs-number" color="#005cc5">14h</span>, <span class="hljs-number" color="#005cc5">15h</span></span>
<a name="user-content-00C3" href="#user-content-00C3" color="#6e7781" class="line-number">$00C3</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0F9h</span>, <span class="hljs-number" color="#005cc5">07h</span>, <span class="hljs-number" color="#005cc5">16h</span>, <span class="hljs-number" color="#005cc5">17h</span>, <span class="hljs-number" color="#005cc5">18h</span>, <span class="hljs-number" color="#005cc5">19h</span></span>
<a name="user-content-00C9" href="#user-content-00C9" color="#6e7781" class="line-number">$00C9</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0F9h</span>, <span class="hljs-number" color="#005cc5">07h</span>, <span class="hljs-number" color="#005cc5">1Ah</span>, <span class="hljs-number" color="#005cc5">1Bh</span>, <span class="hljs-number" color="#005cc5">1Ch</span>, <span class="hljs-number" color="#005cc5">1Dh</span></span>
<a name="user-content-00CF" href="#user-content-00CF" color="#6e7781" class="line-number">$00CF</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0F9h</span>, <span class="hljs-number" color="#005cc5">14h</span>, <span class="hljs-number" color="#005cc5">10h</span>, <span class="hljs-number" color="#005cc5">11h</span>           <span class="hljs-comment" color="#6a737d">; Frame 3</span></span>
<a name="user-content-00D3" href="#user-content-00D3" color="#6e7781" class="line-number">$00D3</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0F9h</span>, <span class="hljs-number" color="#005cc5">08h</span>, <span class="hljs-number" color="#005cc5">12h</span>, <span class="hljs-number" color="#005cc5">13h</span>, <span class="hljs-number" color="#005cc5">14h</span>, <span class="hljs-number" color="#005cc5">15h</span></span>
<a name="user-content-00D9" href="#user-content-00D9" color="#6e7781" class="line-number">$00D9</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0F9h</span>, <span class="hljs-number" color="#005cc5">07h</span>, <span class="hljs-number" color="#005cc5">16h</span>, <span class="hljs-number" color="#005cc5">17h</span>, <span class="hljs-number" color="#005cc5">18h</span>, <span class="hljs-number" color="#005cc5">19h</span></span>
<a name="user-content-00DF" href="#user-content-00DF" color="#6e7781" class="line-number">$00DF</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0F9h</span>, <span class="hljs-number" color="#005cc5">07h</span>, <span class="hljs-number" color="#005cc5">1Ah</span>, <span class="hljs-number" color="#005cc5">1Bh</span>, <span class="hljs-number" color="#005cc5">1Ch</span>, <span class="hljs-number" color="#005cc5">1Dh</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-comment" color="#6a737d">; Low battery animation maps</span></span>
<a name="user-content-00E5" href="#user-content-00E5" color="#6e7781" class="line-number">$00E5</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0F9h</span>, <span class="hljs-number" color="#005cc5">1Fh</span>, <span class="hljs-number" color="#005cc5">22h</span>, <span class="hljs-number" color="#005cc5">23h</span>, <span class="hljs-number" color="#005cc5">23h</span>, <span class="hljs-number" color="#005cc5">24h</span> <span class="hljs-comment" color="#6a737d">; Frame 1</span></span>
<a name="user-content-00EB" href="#user-content-00EB" color="#6e7781" class="line-number">$00EB</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0F9h</span>, <span class="hljs-number" color="#005cc5">07h</span>, <span class="hljs-number" color="#005cc5">2Dh</span>, <span class="hljs-number" color="#005cc5">2Eh</span>, <span class="hljs-number" color="#005cc5">2Eh</span>, <span class="hljs-number" color="#005cc5">2Fh</span></span>
<a name="user-content-00F1" href="#user-content-00F1" color="#6e7781" class="line-number">$00F1</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0F9h</span>, <span class="hljs-number" color="#005cc5">2Bh</span>, <span class="hljs-number" color="#005cc5">25h</span>, <span class="hljs-number" color="#005cc5">26h</span>, <span class="hljs-number" color="#005cc5">23h</span>, <span class="hljs-number" color="#005cc5">24h</span> <span class="hljs-comment" color="#6a737d">; Frame 2</span></span>
<a name="user-content-00F7" href="#user-content-00F7" color="#6e7781" class="line-number">$00F7</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0F9h</span>, <span class="hljs-number" color="#005cc5">07h</span>, <span class="hljs-number" color="#005cc5">30h</span>, <span class="hljs-number" color="#005cc5">31h</span>, <span class="hljs-number" color="#005cc5">2Eh</span>, <span class="hljs-number" color="#005cc5">2Fh</span></span>
<a name="user-content-00FD" href="#user-content-00FD" color="#6e7781" class="line-number">$00FD</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0F9h</span>, <span class="hljs-number" color="#005cc5">2Bh</span>, <span class="hljs-number" color="#005cc5">25h</span>, <span class="hljs-number" color="#005cc5">27h</span>, <span class="hljs-number" color="#005cc5">26h</span>, <span class="hljs-number" color="#005cc5">24h</span> <span class="hljs-comment" color="#6a737d">; Frame 3</span></span>
<a name="user-content-0103" href="#user-content-0103" color="#6e7781" class="line-number">$0103</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0F9h</span>, <span class="hljs-number" color="#005cc5">07h</span>, <span class="hljs-number" color="#005cc5">30h</span>, <span class="hljs-number" color="#005cc5">32h</span>, <span class="hljs-number" color="#005cc5">31h</span>, <span class="hljs-number" color="#005cc5">2Fh</span></span>
<a name="user-content-0109" href="#user-content-0109" color="#6e7781" class="line-number">$0109</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0F9h</span>, <span class="hljs-number" color="#005cc5">2Bh</span>, <span class="hljs-number" color="#005cc5">25h</span>, <span class="hljs-number" color="#005cc5">27h</span>, <span class="hljs-number" color="#005cc5">27h</span>, <span class="hljs-number" color="#005cc5">28h</span> <span class="hljs-comment" color="#6a737d">; Frame 4, 6, 8, 10</span></span>
<a name="user-content-010F" href="#user-content-010F" color="#6e7781" class="line-number">$010F</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0F9h</span>, <span class="hljs-number" color="#005cc5">07h</span>, <span class="hljs-number" color="#005cc5">30h</span>, <span class="hljs-number" color="#005cc5">32h</span>, <span class="hljs-number" color="#005cc5">32h</span>, <span class="hljs-number" color="#005cc5">33h</span></span>
<a name="user-content-0115" href="#user-content-0115" color="#6e7781" class="line-number">$0115</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0F9h</span>, <span class="hljs-number" color="#005cc5">65h</span>                     <span class="hljs-comment" color="#6a737d">; Frame 5, 7, 9 (+ some 0s from below)</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content"></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-comment" color="#6a737d">; Tile graphics</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-comment" color="#6a737d">;DB                                               ; tile  0: blank</span></span>
<a name="user-content-0117" href="#user-content-0117" color="#6e7781" class="line-number">$0117</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span>                                     <span class="hljs-number" color="#005cc5">07Ch</span>, <span class="hljs-number" color="#005cc5">0FEh</span> <span class="hljs-comment" color="#6a737d">; tile  1: start of G</span></span>
<a name="user-content-0119" href="#user-content-0119" color="#6e7781" class="line-number">$0119</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">082h</span>, <span class="hljs-number" color="#005cc5">092h</span>, <span class="hljs-number" color="#005cc5">0F6h</span>, <span class="hljs-number" color="#005cc5">074h</span>, <span class="hljs-number" color="#005cc5">000h</span>, <span class="hljs-number" color="#005cc5">0F0h</span>, <span class="hljs-number" color="#005cc5">0FCh</span>, <span class="hljs-number" color="#005cc5">026h</span> <span class="hljs-comment" color="#6a737d">; tile  2: GA</span></span>
<a name="user-content-0121" href="#user-content-0121" color="#6e7781" class="line-number">$0121</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">026h</span>, <span class="hljs-number" color="#005cc5">0FCh</span>, <span class="hljs-number" color="#005cc5">0F0h</span>, <span class="hljs-number" color="#005cc5">000h</span>, <span class="hljs-number" color="#005cc5">0FEh</span>, <span class="hljs-number" color="#005cc5">0FEh</span>, <span class="hljs-number" color="#005cc5">008h</span>, <span class="hljs-number" color="#005cc5">010h</span> <span class="hljs-comment" color="#6a737d">; tile  3: AM</span></span>
<a name="user-content-0129" href="#user-content-0129" color="#6e7781" class="line-number">$0129</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">008h</span>, <span class="hljs-number" color="#005cc5">0FEh</span>, <span class="hljs-number" color="#005cc5">0FEh</span>, <span class="hljs-number" color="#005cc5">000h</span>, <span class="hljs-number" color="#005cc5">0FEh</span>, <span class="hljs-number" color="#005cc5">0FEh</span>, <span class="hljs-number" color="#005cc5">092h</span>, <span class="hljs-number" color="#005cc5">092h</span> <span class="hljs-comment" color="#6a737d">; tile  4: ME</span></span>
<a name="user-content-0131" href="#user-content-0131" color="#6e7781" class="line-number">$0131</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">092h</span>, <span class="hljs-number" color="#005cc5">0F9h</span>, <span class="hljs-number" color="#005cc5">003h</span>,             <span class="hljs-number" color="#005cc5">0CCh</span>, <span class="hljs-number" color="#005cc5">0DEh</span>, <span class="hljs-number" color="#005cc5">092h</span> <span class="hljs-comment" color="#6a737d">; tile  5: ES</span></span>
<a name="user-content-0137" href="#user-content-0137" color="#6e7781" class="line-number">$0137</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0F6h</span>, <span class="hljs-number" color="#005cc5">066h</span>, <span class="hljs-number" color="#005cc5">000h</span>, <span class="hljs-number" color="#005cc5">0FEh</span>, <span class="hljs-number" color="#005cc5">0FEh</span>, <span class="hljs-number" color="#005cc5">092h</span>, <span class="hljs-number" color="#005cc5">092h</span>, <span class="hljs-number" color="#005cc5">092h</span> <span class="hljs-comment" color="#6a737d">; tile  6: SE</span></span>
<a name="user-content-013F" href="#user-content-013F" color="#6e7781" class="line-number">$013F</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">000h</span>, <span class="hljs-number" color="#005cc5">0FEh</span>, <span class="hljs-number" color="#005cc5">0FEh</span>, <span class="hljs-number" color="#005cc5">080h</span>, <span class="hljs-number" color="#005cc5">080h</span>, <span class="hljs-number" color="#005cc5">080h</span>, <span class="hljs-number" color="#005cc5">000h</span>, <span class="hljs-number" color="#005cc5">0FEh</span> <span class="hljs-comment" color="#6a737d">; tile  7: LE</span></span>
<a name="user-content-0147" href="#user-content-0147" color="#6e7781" class="line-number">$0147</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0FEh</span>, <span class="hljs-number" color="#005cc5">092h</span>, <span class="hljs-number" color="#005cc5">092h</span>, <span class="hljs-number" color="#005cc5">092h</span>, <span class="hljs-number" color="#005cc5">000h</span>, <span class="hljs-number" color="#005cc5">07Ch</span>, <span class="hljs-number" color="#005cc5">0FEh</span>, <span class="hljs-number" color="#005cc5">082h</span> <span class="hljs-comment" color="#6a737d">; tile  8: EC</span></span>
<a name="user-content-014F" href="#user-content-014F" color="#6e7781" class="line-number">$014F</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">082h</span>, <span class="hljs-number" color="#005cc5">0C6h</span>, <span class="hljs-number" color="#005cc5">044h</span>, <span class="hljs-number" color="#005cc5">000h</span>, <span class="hljs-number" color="#005cc5">002h</span>, <span class="hljs-number" color="#005cc5">002h</span>, <span class="hljs-number" color="#005cc5">0FEh</span>, <span class="hljs-number" color="#005cc5">0FEh</span> <span class="hljs-comment" color="#6a737d">; tile  9: CT</span></span>
<a name="user-content-0157" href="#user-content-0157" color="#6e7781" class="line-number">$0157</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">002h</span>, <span class="hljs-number" color="#005cc5">002h</span>, <span class="hljs-number" color="#005cc5">0F9h</span>, <span class="hljs-number" color="#005cc5">007h</span>                         <span class="hljs-comment" color="#6a737d">; tile 10: T</span></span>
<a name="user-content-015B" href="#user-content-015B" color="#6e7781" class="line-number">$015B</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span>             <span class="hljs-number" color="#005cc5">0FEh</span>, <span class="hljs-number" color="#005cc5">07Ch</span>, <span class="hljs-number" color="#005cc5">038h</span>, <span class="hljs-number" color="#005cc5">010h</span>, <span class="hljs-number" color="#005cc5">0F9h</span>, <span class="hljs-number" color="#005cc5">005h</span> <span class="hljs-comment" color="#6a737d">; tile 11: select arrow</span></span>
<a name="user-content-0161" href="#user-content-0161" color="#6e7781" class="line-number">$0161</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span>                         <span class="hljs-number" color="#005cc5">0FFh</span>, <span class="hljs-number" color="#005cc5">0F9h</span>, <span class="hljs-number" color="#005cc5">005h</span>       <span class="hljs-comment" color="#6a737d">; tile 12: left side of border</span></span>
<a name="user-content-0164" href="#user-content-0164" color="#6e7781" class="line-number">$0164</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span>                   <span class="hljs-number" color="#005cc5">0FFh</span>, <span class="hljs-number" color="#005cc5">0F9h</span>, <span class="hljs-number" color="#005cc5">004h</span>             <span class="hljs-comment" color="#6a737d">; tile 13: right side of border</span></span>
<a name="user-content-0167" href="#user-content-0167" color="#6e7781" class="line-number">$0167</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span>       <span class="hljs-number" color="#005cc5">0F0h</span>, <span class="hljs-number" color="#005cc5">0FBh</span>, <span class="hljs-number" color="#005cc5">008h</span>, <span class="hljs-number" color="#005cc5">00Bh</span>                   <span class="hljs-comment" color="#6a737d">; tile 14: extended cartridge left</span></span>
<a name="user-content-016B" href="#user-content-016B" color="#6e7781" class="line-number">$016B</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span>                                     <span class="hljs-number" color="#005cc5">0F0h</span>, <span class="hljs-number" color="#005cc5">000h</span> <span class="hljs-comment" color="#6a737d">; tile 15: extended cartridge right</span></span>
<a name="user-content-016D" href="#user-content-016D" color="#6e7781" class="line-number">$016D</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">000h</span>, <span class="hljs-number" color="#005cc5">080h</span>, <span class="hljs-number" color="#005cc5">0FBh</span>, <span class="hljs-number" color="#005cc5">040h</span>, <span class="hljs-number" color="#005cc5">00Bh</span>                   <span class="hljs-comment" color="#6a737d">; tile 16: inserted cartridge left</span></span>
<a name="user-content-0172" href="#user-content-0172" color="#6e7781" class="line-number">$0172</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span>                                     <span class="hljs-number" color="#005cc5">080h</span>, <span class="hljs-number" color="#005cc5">0F9h</span> <span class="hljs-comment" color="#6a737d">; tile 17: inserted cartridge right</span></span>
<a name="user-content-0174" href="#user-content-0174" color="#6e7781" class="line-number">$0174</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">006h</span>,                               <span class="hljs-number" color="#005cc5">0F8h</span>, <span class="hljs-number" color="#005cc5">004h</span> <span class="hljs-comment" color="#6a737d">; tile 18: PM (0,0)</span></span>
<a name="user-content-0177" href="#user-content-0177" color="#6e7781" class="line-number">$0177</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">082h</span>, <span class="hljs-number" color="#005cc5">0E1h</span>, <span class="hljs-number" color="#005cc5">0E1h</span>, <span class="hljs-number" color="#005cc5">031h</span>, <span class="hljs-number" color="#005cc5">031h</span>, <span class="hljs-number" color="#005cc5">0FBh</span>, <span class="hljs-number" color="#005cc5">039h</span>, <span class="hljs-number" color="#005cc5">005h</span> <span class="hljs-comment" color="#6a737d">; tile 19: PM (1,0)</span></span>
<a name="user-content-017F" href="#user-content-017F" color="#6e7781" class="line-number">$017F</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span>                   <span class="hljs-number" color="#005cc5">031h</span>, <span class="hljs-number" color="#005cc5">031h</span>, <span class="hljs-number" color="#005cc5">0E1h</span>, <span class="hljs-number" color="#005cc5">0E1h</span>, <span class="hljs-number" color="#005cc5">082h</span> <span class="hljs-comment" color="#6a737d">; tile 20: PM (2,0)</span></span>
<a name="user-content-0184" href="#user-content-0184" color="#6e7781" class="line-number">$0184</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">006h</span>, <span class="hljs-number" color="#005cc5">0FAh</span>, <span class="hljs-number" color="#005cc5">004h</span>, <span class="hljs-number" color="#005cc5">0F8h</span>, <span class="hljs-number" color="#005cc5">0F9h</span>, <span class="hljs-number" color="#005cc5">008h</span>             <span class="hljs-comment" color="#6a737d">; tile 21: PM (3,0)</span></span>
<a name="user-content-018A" href="#user-content-018A" color="#6e7781" class="line-number">$018A</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span>                               <span class="hljs-number" color="#005cc5">0FCh</span>, <span class="hljs-number" color="#005cc5">003h</span>, <span class="hljs-number" color="#005cc5">000h</span> <span class="hljs-comment" color="#6a737d">; tile 22: PM (0,1)</span></span>
<a name="user-content-018D" href="#user-content-018D" color="#6e7781" class="line-number">$018D</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">007h</span>, <span class="hljs-number" color="#005cc5">0DFh</span>, <span class="hljs-number" color="#005cc5">0DFh</span>, <span class="hljs-number" color="#005cc5">030h</span>, <span class="hljs-number" color="#005cc5">030h</span>, <span class="hljs-number" color="#005cc5">0FBh</span>, <span class="hljs-number" color="#005cc5">070h</span>, <span class="hljs-number" color="#005cc5">005h</span> <span class="hljs-comment" color="#6a737d">; tile 23: PM (1,1)</span></span>
<a name="user-content-0195" href="#user-content-0195" color="#6e7781" class="line-number">$0195</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span>                   <span class="hljs-number" color="#005cc5">030h</span>, <span class="hljs-number" color="#005cc5">030h</span>, <span class="hljs-number" color="#005cc5">01Fh</span>, <span class="hljs-number" color="#005cc5">09Fh</span>, <span class="hljs-number" color="#005cc5">087h</span> <span class="hljs-comment" color="#6a737d">; tile 24: PM (2,1)</span></span>
<a name="user-content-019A" href="#user-content-019A" color="#6e7781" class="line-number">$019A</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">000h</span>, <span class="hljs-number" color="#005cc5">003h</span>, <span class="hljs-number" color="#005cc5">0FDh</span>, <span class="hljs-number" color="#005cc5">0F9h</span>, <span class="hljs-number" color="#005cc5">009h</span>                   <span class="hljs-comment" color="#6a737d">; tile 25: PM (3,1)</span></span>
<a name="user-content-019F" href="#user-content-019F" color="#6e7781" class="line-number">$019F</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span>                               <span class="hljs-number" color="#005cc5">007h</span>, <span class="hljs-number" color="#005cc5">008h</span>, <span class="hljs-number" color="#005cc5">013h</span> <span class="hljs-comment" color="#6a737d">; tile 26: PM (0,2)</span></span>
<a name="user-content-01A2" href="#user-content-01A2" color="#6e7781" class="line-number">$01A2</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">013h</span>, <span class="hljs-number" color="#005cc5">02Fh</span>, <span class="hljs-number" color="#005cc5">02Fh</span>, <span class="hljs-number" color="#005cc5">023h</span>, <span class="hljs-number" color="#005cc5">023h</span>, <span class="hljs-number" color="#005cc5">0FBh</span>, <span class="hljs-number" color="#005cc5">020h</span>, <span class="hljs-number" color="#005cc5">005h</span> <span class="hljs-comment" color="#6a737d">; tile 27: PM (1,2)</span></span>
<a name="user-content-01AA" href="#user-content-01AA" color="#6e7781" class="line-number">$01AA</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span>                   <span class="hljs-number" color="#005cc5">046h</span>, <span class="hljs-number" color="#005cc5">046h</span>, <span class="hljs-number" color="#005cc5">040h</span>, <span class="hljs-number" color="#005cc5">081h</span>, <span class="hljs-number" color="#005cc5">081h</span> <span class="hljs-comment" color="#6a737d">; tile 28: PM (2,2)</span></span>
<a name="user-content-01AF" href="#user-content-01AF" color="#6e7781" class="line-number">$01AF</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">080h</span>, <span class="hljs-number" color="#005cc5">040h</span>, <span class="hljs-number" color="#005cc5">03Fh</span>, <span class="hljs-number" color="#005cc5">0F9h</span>, <span class="hljs-number" color="#005cc5">008h</span>                   <span class="hljs-comment" color="#6a737d">; tile 29: PM (3,2)</span></span>
<a name="user-content-01B4" href="#user-content-01B4" color="#6e7781" class="line-number">$01B4</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span>                         <span class="hljs-number" color="#005cc5">0FEh</span>, <span class="hljs-number" color="#005cc5">0FBh</span>, <span class="hljs-number" color="#005cc5">002h</span>, <span class="hljs-number" color="#005cc5">00Dh</span> <span class="hljs-comment" color="#6a737d">; tile 30: top left corner of border</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-comment" color="#6a737d">;DB                                               ; tile 31: top side of border</span></span>
<a name="user-content-01B8" href="#user-content-01B8" color="#6e7781" class="line-number">$01B8</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span>                   <span class="hljs-number" color="#005cc5">0FEh</span>, <span class="hljs-number" color="#005cc5">0F9h</span>, <span class="hljs-number" color="#005cc5">003h</span>             <span class="hljs-comment" color="#6a737d">; tile 32: top right corner of border</span></span>
<a name="user-content-01BB" href="#user-content-01BB" color="#6e7781" class="line-number">$01BB</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">002h</span>, <span class="hljs-number" color="#005cc5">022h</span>, <span class="hljs-number" color="#005cc5">032h</span>, <span class="hljs-number" color="#005cc5">03Ah</span>, <span class="hljs-number" color="#005cc5">03Ah</span>, <span class="hljs-number" color="#005cc5">032h</span>, <span class="hljs-number" color="#005cc5">022h</span>, <span class="hljs-number" color="#005cc5">002h</span> <span class="hljs-comment" color="#6a737d">; tile 33: more games upward arrow</span></span>
<a name="user-content-01C3" href="#user-content-01C3" color="#6e7781" class="line-number">$01C3</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0E0h</span>, <span class="hljs-number" color="#005cc5">020h</span>, <span class="hljs-number" color="#005cc5">0BCh</span>, <span class="hljs-number" color="#005cc5">084h</span>, <span class="hljs-number" color="#005cc5">0F4h</span>, <span class="hljs-number" color="#005cc5">0F4h</span>, <span class="hljs-number" color="#005cc5">004h</span>, <span class="hljs-number" color="#005cc5">0F4h</span> <span class="hljs-comment" color="#6a737d">; tile 34: full battery top left</span></span>
<a name="user-content-01CB" href="#user-content-01CB" color="#6e7781" class="line-number">$01CB</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0F4h</span>, <span class="hljs-number" color="#005cc5">0F4h</span>, <span class="hljs-number" color="#005cc5">004h</span>, <span class="hljs-number" color="#005cc5">0F4h</span>, <span class="hljs-number" color="#005cc5">0F4h</span>, <span class="hljs-number" color="#005cc5">0F4h</span>, <span class="hljs-number" color="#005cc5">004h</span>, <span class="hljs-number" color="#005cc5">0F4h</span> <span class="hljs-comment" color="#6a737d">; tile 35: full battery top middle</span></span>
<a name="user-content-01D3" href="#user-content-01D3" color="#6e7781" class="line-number">$01D3</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0F4h</span>, <span class="hljs-number" color="#005cc5">0F4h</span>, <span class="hljs-number" color="#005cc5">004h</span>, <span class="hljs-number" color="#005cc5">0F4h</span>, <span class="hljs-number" color="#005cc5">0F4h</span>, <span class="hljs-number" color="#005cc5">0F4h</span>, <span class="hljs-number" color="#005cc5">004h</span>, <span class="hljs-number" color="#005cc5">0FCh</span> <span class="hljs-comment" color="#6a737d">; tile 36: full battery top right</span></span>
<a name="user-content-01DB" href="#user-content-01DB" color="#6e7781" class="line-number">$01DB</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0E0h</span>, <span class="hljs-number" color="#005cc5">020h</span>, <span class="hljs-number" color="#005cc5">03Ch</span>, <span class="hljs-number" color="#005cc5">0FBh</span>, <span class="hljs-number" color="#005cc5">004h</span>, <span class="hljs-number" color="#005cc5">007h</span>             <span class="hljs-comment" color="#6a737d">; tile 37: empty battery top left</span></span>
<a name="user-content-01E1" href="#user-content-01E1" color="#6e7781" class="line-number">$01E1</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span>                   <span class="hljs-number" color="#005cc5">0F4h</span>, <span class="hljs-number" color="#005cc5">0F4h</span>, <span class="hljs-number" color="#005cc5">0F4h</span>, <span class="hljs-number" color="#005cc5">004h</span>, <span class="hljs-number" color="#005cc5">0F4h</span> <span class="hljs-comment" color="#6a737d">; tile 38: drained battery top middle</span></span>
<a name="user-content-01E6" href="#user-content-01E6" color="#6e7781" class="line-number">$01E6</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span> <span class="hljs-number" color="#005cc5">0FBh</span>, <span class="hljs-number" color="#005cc5">004h</span>, <span class="hljs-number" color="#005cc5">00Ah</span>                               <span class="hljs-comment" color="#6a737d">; tile 39: empty battery top middle</span></span>
<a name="user-content-01E9" href="#user-content-01E9" color="#6e7781" class="line-number">$01E9</a>  <span class="line-content">    <span class="hljs-meta" color="#005cc5">DB</span>                   <span class="hljs-number" color="#005cc5">0F4h</span>, <span class="hljs-number" color="#005cc5">0F4h</span>, <span class="hljs-number" color="#005cc5">0F4h</span>, <span class="hljs-number" color="#005cc5">004h</span>, <span class="hljs-number" color="#005cc5">0FCh</span> <span class="hljs-comment" color="#6a737d">; tile 40: drained battery top right</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-comment" color="#6a737d">; tiles 41-51 (inclusive) are v-flipped versions</span></span>
<span color="#6e7781" class="line-number">     </span>  <span class="line-content">    <span class="hljs-comment" color="#6a737d">; of 30-40 which are generated at runtime</span></span>
</code></pre>